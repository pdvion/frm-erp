# An√°lise Complementar V3 ‚Äî Diretoria de RH + Recalibra√ß√£o para Escala

> Complemento √† an√°lise principal e ao documento industrial/fiscal.
> Novas perspectivas: Diretoria de RH/DP + Recalibra√ß√£o de TODA a an√°lise para escala de dezenas de empresas (n√£o apenas 7).
> Contexto atualizado: apura√ß√£o de impostos √© interna (sem escrit√≥rio terceirizado), RH/folha internos.
> Data: 09/02/2026

---

## Parte A ‚Äî Vis√£o Diretoria de RH / DP

### A.1 Cobertura do M√≥dulo de RH

O sistema tem 27 models dedicados a RH e DP, cobrindo:

**Cadastro e Organiza√ß√£o:**
- Employee (76 campos) ‚Äî dados pessoais, documenta√ß√£o (CPF, RG, PIS, CTPS, t√≠tulo eleitor, certificado militar), endere√ßo, dados banc√°rios, PIX, foto
- Department + JobPosition ‚Äî estrutura organizacional
- Hierarquia gerencial (Employee.managerId ‚Üí self-relation)
- ContractType: CLT, PJ, TEMPORARY, INTERN, APPRENTICE

**Ponto Eletr√¥nico e Jornada:**
- TimeClockEntry ‚Äî 4 tipos (CLOCK_IN, CLOCK_OUT, BREAK_START, BREAK_END) com geolocaliza√ß√£o (lat/lng), device ID, IP, marca√ß√£o manual com justificativa e aprova√ß√£o
- TimesheetDay ‚Äî espelho de ponto di√°rio com horas programadas, trabalhadas, extras (50% e 100%), noturnas, aus√™ncias, feriado, fim de semana
- WorkSchedule + WorkShift + EmployeeSchedule ‚Äî escalas de trabalho
- HoursBank ‚Äî banco de horas com cr√©dito, d√©bito, compensa√ß√£o, expira√ß√£o, ajuste
- TimeClockAdjustment ‚Äî ajustes com fluxo de aprova√ß√£o
- Holiday ‚Äî feriados

**Folha de Pagamento:**
- Payroll ‚Äî folha mensal por empresa com totais bruto/dedu√ß√µes/l√≠quido, fluxo DRAFT ‚Üí processada ‚Üí aprovada ‚Üí paga
- PayrollItem ‚Äî contracheque individual com sal√°rio base, horas trabalhadas/extras/noturnas, INSS, IRRF, FGTS
- PayrollEvent ‚Äî eventos da folha (SALARY, OVERTIME, BONUS, COMMISSION, ALLOWANCE, DEDUCTION, TAX, BENEFIT) com c√≥digo, descri√ß√£o, valor, flag de dedu√ß√£o. Estrutura aberta tipo "holerite customiz√°vel"

**Obriga√ß√µes CLT:**
- Vacation ‚Äî f√©rias com per√≠odo aquisitivo/concessivo, abono pecuni√°rio (dias vendidos), 1/3 constitucional, dedu√ß√µes INSS/IRRF, f√©rias coletivas, aviso, aprova√ß√£o
- ThirteenthSalary ‚Äî 13¬∫ com 1¬™ parcela, 2¬™ parcela, integral, proporcional. Meses trabalhados, m√©dia vari√°vel, dedu√ß√µes
- Termination ‚Äî rescis√£o completa com 7 tipos (pedido, justa causa, sem justa causa, acordo m√∫tuo, fim contrato, aposentadoria, √≥bito). 50 campos: saldo sal√°rio, aviso pr√©vio (trabalhado/indenizado), f√©rias vencidas/proporcionais + 1/3, 13¬∫ proporcional, FGTS saldo + multa 40%, GRRF, seguro-desemprego (eligibilidade + n¬∫ guias), homologa√ß√£o, TRCT

**Admiss√£o:**
- AdmissionProcess ‚Äî pipeline com etapas, documentos obrigat√≥rios, exames admissionais, respons√°veis (recrutador, gestor). 5 steps configur√°veis.

**Benef√≠cios:**
- BenefitType ‚Äî tipos com c√°lculo FIXED/percentual, desconto funcion√°rio, flags de incid√™ncia (affectsInss, affectsIrrf, affectsFgts)
- EmployeeBenefit ‚Äî v√≠nculo funcion√°rio √ó benef√≠cio com valor, desconto, contribui√ß√£o empresa
- TransportVoucher ‚Äî vale transporte

**Desenvolvimento:**
- Training ‚Äî cadastro de treinamentos com dura√ß√£o, instrutor, custo, validade em meses, flag obrigat√≥rio
- EmployeeTraining ‚Äî v√≠nculo com status, nota, certificado URL, data de expira√ß√£o
- SkillMatrix ‚Äî compet√™ncias por funcion√°rio com n√≠vel (0-4), certifica√ß√£o, expira√ß√£o

**Portal do Colaborador:** Router `employeePortal` existe ‚Äî self-service para consulta de holerites, solicita√ß√£o de f√©rias, etc.

### A.2 Pontos Fortes para RH

**Rescis√£o √© o ponto alto.** O model Termination tem profundidade impressionante: 7 tipos de rescis√£o, aviso pr√©vio trabalhado vs indenizado, c√°lculo completo de verbas (saldo, f√©rias vencidas + proporcionais + 1/3, 13¬∫ proporcional), FGTS saldo + multa 40%, GRRF, seguro-desemprego, homologa√ß√£o, TRCT. Isso √© n√≠vel de software especializado de DP.

**F√©rias bem modeladas.** Per√≠odo aquisitivo/concessivo, abono pecuni√°rio, f√©rias coletivas com groupId, 1/3 constitucional, dedu√ß√µes. Cobre as principais regras da CLT.

**Ponto com geolocaliza√ß√£o.** TimeClockEntry com lat/lng, deviceId, IP ‚Äî preparado para ponto mobile/remoto. Ajustes com justificativa e aprova√ß√£o. TimesheetDay consolida com overtime 50% e 100% separados.

**Benef√≠cios com incid√™ncia tribut√°ria.** BenefitType tem flags `affectsInss`, `affectsIrrf`, `affectsFgts` ‚Äî essencial para o c√°lculo correto da folha. Saber que o vale alimenta√ß√£o n√£o incide INSS (regra PAT) mas o pr√™mio de produ√ß√£o incide √© a diferen√ßa entre acertar e errar a folha.

### A.3 Gaps Cr√≠ticos para RH/DP

#### üî¥ Sem eSocial

Zero refer√™ncias a eSocial no schema. Para uma empresa com folha interna (n√£o terceirizada), o eSocial √© obriga√ß√£o legal desde 2018. Eventos obrigat√≥rios:

- **S-1200:** Remunera√ß√£o do trabalhador (mensal, sincronizado com folha)
- **S-1210:** Pagamentos de rendimentos do trabalho
- **S-2200:** Admiss√£o do trabalhador (prazo: at√© o dia anterior ao in√≠cio)
- **S-2206:** Altera√ß√£o de contrato de trabalho
- **S-2299:** Desligamento (prazo: 10 dias)
- **S-2230:** Afastamento tempor√°rio
- **S-2300:** Trabalhador sem v√≠nculo (PJ, estagi√°rio)
- **S-1000 a S-1080:** Tabelas do empregador (rubricas, lota√ß√µes, cargos)

Sem integra√ß√£o eSocial, o DP precisa lan√ßar esses eventos em outro sistema (provavelmente o antigo, ou um DCTF-Web manual). Com dezenas de empresas, isso √© insustent√°vel.

**Recomenda√ß√£o:** Este √© provavelmente o gap funcional mais impactante para opera√ß√£o real. Precisa de: tabela de rubricas eSocial (S-1010), mapeamento PayrollEvent.code ‚Üí rubrica eSocial, gera√ß√£o de XML dos eventos, fila de envio, log de retorno (protocolo, erros), reenvio. √â um m√≥dulo completo.

#### üî¥ Float em TODA a Folha de Pagamento

PayrollItem: baseSalary, grossSalary, netSalary, INSS, IRRF, FGTS ‚Äî todos Float. PayrollEvent.value ‚Äî Float. Vacation: vacationPay, oneThirdBonus, todas as dedu√ß√µes ‚Äî Float. ThirteenthSalary: todos os valores ‚Äî Float. Termination: TODOS os 16 campos de valores ‚Äî Float.

Num cen√°rio de dezenas de empresas com centenas de funcion√°rios cada, o erro acumulado de Float no fechamento de FGTS (GFIP/SEFIP) e IRRF (DIRF/EFD-Reinf) vai gerar diverg√™ncias com a Receita Federal e com a Caixa Econ√¥mica.

**Cen√°rio concreto:** FGTS mensal de 500 funcion√°rios a R$ 2.000 m√©dio = 500 √ó R$ 160 = R$ 80.000/m√™s. Float pode introduzir R$ 0,01 de erro por c√°lculo √ó 500 = R$ 5,00 de diverg√™ncia mensal por empresa. Com 30 empresas √ó 12 meses = R$ 1.800/ano de diferen√ßa acumulada com a CEF. Parece pouco, mas gera notifica√ß√£o e demanda concilia√ß√£o manual.

#### üü° Sem Tabelas de INSS e IRRF Progressivas

O sistema calcula INSS e IRRF, mas n√£o h√° model para as faixas progressivas (tabela INSS com 4 faixas, tabela IRRF com 5 faixas + dedu√ß√£o por dependente). Essas tabelas mudam anualmente. Sem um model, as al√≠quotas est√£o hardcoded ou em SystemSetting ‚Äî que funciona, mas √© fr√°gil e n√£o audita o hist√≥rico de tabelas usadas em cada compet√™ncia.

**Recomenda√ß√£o:** Criar `TaxBracket` (taxType: INSS/IRRF, year, startRange, endRange, rate, deduction, effectiveDate). Quando rodar folha de 01/2026, usar a tabela vigente em 01/2026, n√£o a atual.

#### üü° Sem Controle de Dependentes

O Employee tem `dependentsCount` mas n√£o tem model de dependentes. Para IRRF, cada dependente d√° R$ 189,59 de dedu√ß√£o (valor 2024). Para plano de sa√∫de, vale alimenta√ß√£o proporcional, etc., precisa saber quem s√£o os dependentes (nome, CPF, data nascimento, grau parentesco). O eSocial evento S-2200 exige a lista completa de dependentes.

**Recomenda√ß√£o:** Criar `EmployeeDependent` (employeeId, name, cpf, birthDate, relationship, isIrrfDependent, isHealthPlanDependent, startDate, endDate).

#### üü° Sem Afastamentos Estruturados

O Employee tem status LEAVE, mas n√£o h√° model para afastamentos (licen√ßa m√©dica, acidente trabalho, licen√ßa maternidade/paternidade, aux√≠lio-doen√ßa). Afastamentos t√™m impacto em: dias trabalhados na folha, FGTS (afastamento por acidente = FGTS depositado pela empresa), 13¬∫ proporcional, f√©rias (afastamento > 6 meses = perde per√≠odo aquisitivo), eSocial S-2230.

**Recomenda√ß√£o:** Criar `EmployeeLeave` (employeeId, type: MEDICAL/ACCIDENT/MATERNITY/PATERNITY/OTHER, startDate, endDate, inssProtocol, hasFgtsDeposit, medicalCertificate, cid10Code).

#### üü° Sem Sindicato e Conven√ß√£o Coletiva

N√£o h√° model para sindicato, conven√ß√£o coletiva, pisos salariais, adicionais por conven√ß√£o. Para ind√∫stria metal√∫rgica, a conven√ß√£o coletiva define: piso salarial, adicional de insalubridade, adicional de periculosidade, PLR. O Employee tem `insalubrityDegree` e `hasDangerousness`, mas n√£o h√° v√≠nculo com a conven√ß√£o que define os percentuais.

Com dezenas de empresas potencialmente em estados diferentes (PR, SC, SP), cada uma pode estar sob uma conven√ß√£o diferente. Sem isso modelado, os c√°lculos de adicional s√£o manuais.

#### üü° Sem SST (Sa√∫de e Seguran√ßa do Trabalho)

Campos de insalubridade/periculosidade existem no Employee, mas falta: PPRA/PGR, PCMSO, LTCAT, ASOs (admissional, peri√≥dico, demissional, retorno, mudan√ßa de fun√ß√£o), CIPA, treinamentos NR obrigat√≥rios (NR-10, NR-12, NR-33, NR-35). Esses s√£o obrigat√≥rios por lei e reportados via eSocial (S-2220 para ASOs, S-2210 para CAT).

Para uma f√°brica de rolamentos, h√° riscos de ru√≠do (ret√≠fica), calor (tratamento t√©rmico), produtos qu√≠micos (lubrificantes), e ergon√¥micos. O controle de ASOs e EPI √© obrigat√≥rio.

### A.4 Maturidade RH/DP ‚Äî Resumo

| Capacidade | Status | Nota |
|-----------|--------|------|
| Cadastro de funcion√°rios | ‚úÖ Completo | Docs CLT, banc√°rio, PIX |
| Ponto eletr√¥nico | ‚úÖ Completo | Geolocaliza√ß√£o, ajustes, banco de horas |
| Folha de pagamento | ‚úÖ Funcional | Eventos customiz√°veis, aprova√ß√£o |
| F√©rias | ‚úÖ Completo | Aquisitivo/concessivo, coletivas, abono |
| 13¬∫ Sal√°rio | ‚úÖ Funcional | 1¬™/2¬™ parcela, proporcional |
| Rescis√£o | ‚úÖ Completo | 7 tipos, TRCT, GRRF, seguro-desemprego |
| Admiss√£o | ‚úÖ Funcional | Pipeline com etapas, docs, exames |
| Benef√≠cios | ‚úÖ Funcional | Incid√™ncia tribut√°ria configur√°vel |
| Treinamentos + Skills | ‚úÖ Funcional | Validade, obrigatoriedade, matriz |
| Portal do colaborador | ‚úÖ Existe | Self-service |
| eSocial | ‚ùå Ausente | Nenhuma refer√™ncia no schema |
| Dependentes | ‚ùå Ausente | S√≥ contagem, sem cadastro |
| Afastamentos | ‚ùå Ausente | Sem model estruturado |
| Tabelas INSS/IRRF progressivas | ‚ùå Ausente | Provavelmente hardcoded |
| Sindicato/Conven√ß√£o Coletiva | ‚ùå Ausente | Sem v√≠nculo com piso/adicionais |
| SST (ASO, EPI, NRs) | ‚ùå Ausente | S√≥ insalubridade/periculosidade no Employee |
| SEFIP/GFIP/GRRF automatizado | ‚ùå Ausente | Prov√°vel gera√ß√£o manual |
| Precis√£o num√©rica (Decimal) | ‚ùå Float | Todo o m√≥dulo |

---

## Parte B ‚Äî Recalibra√ß√£o para Escala de Dezenas de Empresas

O sistema foi desenhado para 7 empresas do Grupo FRM, mas a vis√£o √© dezenas. Isso muda fundamentalmente v√°rias premissas.

### B.1 Multi-Tenant: de "Funciona" para "Precisa Ser Robusto"

**Hoje:** companyId como campo em cada tabela, queries filtram por empresa. 74 backrelations no model Company.

**Problema em escala:**

Com 7 empresas, o `Company` carrega 74 arrays de backrelations ‚Äî mas o Prisma n√£o carrega tudo de uma vez, ent√£o isso √© cosm√©tico. O problema real s√£o as queries:

1. **Sem RLS (Row Level Security).** Apenas 2 models t√™m RLS (import_documents e nfe_queue_jobs ‚Äî provavelmente vindos do Supabase). Os outros 171 dependem do c√≥digo da aplica√ß√£o para filtrar por companyId. Um bug ou query esquecida em qualquer um dos 81 routers exp√µe dados de outra empresa. Com 7 empresas do mesmo grupo, isso √© toler√°vel (s√£o do mesmo dono). Com dezenas de empresas de terceiros, √© uma viola√ß√£o de dados.

2. **companyId nullable em 66 models transacionais.** Isso foi mencionado antes, mas em escala agrava: um registro sem companyId √© um registro que pode aparecer para qualquer empresa. Com dezenas de tenants, isso precisa ser intolerado em models transacionais.

3. **Sem conceito de Grupo/Holding.** O model Company n√£o tem `parentId` ou `groupId`. Hoje, as 7 empresas s√£o "peers" ‚Äî todas no mesmo n√≠vel. Para dezenas de empresas, provavelmente haver√° grupos: "Grupo FRM" com 7 empresas, "Grupo XYZ" com 3, etc. Funcionalidades como consolida√ß√£o financeira, transfer√™ncia intercompany, e sharing de dados dependem de saber quem pertence ao mesmo grupo.

**Recomenda√ß√µes para escala:**

| A√ß√£o | Prioridade |
|------|-----------|
| Implementar RLS no Supabase para TODOS os models com companyId | P0 |
| Tornar companyId NOT NULL em models transacionais | P0 |
| Adicionar `groupId` (ou `parentCompanyId`) no Company para hierarquia de grupos | P1 |
| Criar middleware Prisma que injeta `companyId` automaticamente em toda query | P1 |
| Audit trail de qual companyId foi usado em cada request (JWT claim) | P1 |

### B.2 Performance em Escala

**Hoje (7 empresas):** Se cada empresa tem ~10.000 materiais, ~5.000 OPs/ano, ~500 NF-es/m√™s, ~100 funcion√°rios ‚Üí total: ~70.000 materiais, ~35.000 OPs, ~42.000 NF-es/ano, ~700 funcion√°rios. Manej√°vel em PostgreSQL single-node.

**Com dezenas (30 empresas):** ~300.000 materiais, ~150.000 OPs, ~180.000 NF-es/ano, ~3.000 funcion√°rios. Ainda manej√°vel, mas:

- **Indexes compostos com companyId s√£o cr√≠ticos.** Toda query principal precisa de index que comece com companyId. Os 497 indexes existentes precisam ser auditados: quantos come√ßam com companyId? Os que n√£o come√ßam far√£o full table scan filtrado no aplicativo.

- **Particionamento por companyId.** Para tabelas de alto volume (InventoryMovement, AuditLog, ProductionLog, TimeClockEntry), considerar particionamento por companyId quando ultrapassar 10M rows.

- **Connection pooling.** Supabase tem limites de conex√µes. Com dezenas de empresas acessando simultaneamente, o pool precisa ser dimensionado (PgBouncer/Supavisor).

### B.3 Impacto em M√≥dulos Espec√≠ficos

**RH/DP com dezenas de empresas:** Cada empresa com folha interna = cada empresa precisa: gerar folha, emitir eSocial, calcular FGTS, IRRF, f√©rias, 13¬∫, rescis√£o. Se o DP √© centralizado (time de DP da holding processa todas), o sistema precisa de: vis√£o consolidada de folhas por grupo, comparativo de headcount/custo entre empresas, calend√°rio de obriga√ß√µes por empresa.

**Fiscal com dezenas de empresas:** Cada empresa com CNPJ pr√≥prio = cada uma tem: SEFAZ sync independente, manifesta√ß√£o de NF-e independente, SPED independente, apura√ß√£o de ICMS/IPI/PIS/COFINS independente. O `SefazSyncConfig` j√° √© por empresa (companyId unique) ‚Äî mas n√£o h√° vis√£o consolidada "quantas NF-es pendentes de manifesta√ß√£o tem no grupo todo?".

**Financeiro com dezenas de empresas:** Consolida√ß√£o de caixa do grupo. Hoje n√£o h√° conceito de "caixa consolidado" ou "posi√ß√£o de caixa do grupo". Cada empresa tem seus BankAccounts, mas o CFO/Controller precisa ver: posi√ß√£o consolidada, movimenta√ß√£o intercompany, empr√©stimos entre empresas.

### B.4 Opera√ß√µes entre Empresas (Intercompany)

Isso √© o gap mais relevante para escala. Opera√ß√µes entre CNPJs do mesmo grupo:

| Opera√ß√£o | Necessidade | Status |
|----------|-------------|--------|
| Transfer√™ncia de estoque entre empresas | NF-e de transfer√™ncia, CFOP 5.152/6.152 | ‚ùå Ausente |
| Venda entre empresas do grupo | NF-e de venda, pre√ßo de transfer√™ncia | ‚ùå Ausente |
| Rateio de custos da holding | Compartilhamento de custos administrativos | ‚ùå Ausente |
| Empr√©stimo intercompany | M√∫tuo entre empresas do grupo | ‚ùå Ausente |
| Consolida√ß√£o de demonstra√ß√µes | Elimina√ß√£o de saldos intercompany | ‚ùå Ausente |

Para 7 empresas com poucas transa√ß√µes entre si, isso √© feito manualmente. Para dezenas, √© invi√°vel sem automa√ß√£o.

### B.5 Configura√ß√£o e Parametriza√ß√£o por Empresa

Com dezenas de empresas, a configura√ß√£o precisa ser mais granular:

| Configura√ß√£o | Hoje | Necess√°rio para escala |
|-------------|------|----------------------|
| Regime tribut√°rio | N√£o modelado | Por empresa (LP, LR, SN) |
| Tabelas de impostos | Provavelmente hardcoded | Por regime √ó ano |
| Conven√ß√£o coletiva | N√£o modelado | Por empresa √ó sindicato |
| Feriados | Por empresa | Por empresa + por munic√≠pio |
| Fluxo de aprova√ß√£o | Por workflow | Por empresa √ó m√≥dulo |
| Numera√ß√£o de documentos | `code` com autoincrement | Por empresa (j√° √©: @@unique([code, companyId])) ‚úÖ |
| isShared data | companyId null | Precisa de groupId para sharing entre empresas do mesmo grupo |

### B.6 Licenciamento e Billing

Se dezenas de empresas significa clientes externos (n√£o s√≥ empresas do Grupo FRM), o sistema precisa de mecanismos de SaaS:

- **Billing por empresa/plano** ‚Äî o model n√£o existe
- **Feature flags por plano** ‚Äî quais m√≥dulos cada empresa tem acesso
- **Quotas** ‚Äî n√∫mero de usu√°rios, de NF-es/m√™s, de funcion√°rios
- **Onboarding automatizado** ‚Äî o `CompanyOnboarding` e `CloneLog` sugerem que isso j√° est√° sendo pensado

O router `billing` j√° existe ‚Äî provavelmente h√° l√≥gica implementada que n√£o aparece no schema.

---

## Parte C ‚Äî Matriz de Prioridades Recalibrada (Vers√£o Final)

Consolidando TODAS as perspectivas (CTO, CDO, COO, CFO, Industrial, Fiscal, RH, Escala):

### TIER 0 ‚Äî Bloqueantes para Produ√ß√£o (qualquer empresa)

| # | A√ß√£o | Impacto | Esfor√ßo |
|---|------|---------|---------|
| 1 | **Float ‚Üí Decimal em TUDO que √© valor financeiro** | Financeiro, fiscal, folha, rescis√£o, f√©rias, 13¬∫, NF-e entrada | ALTO ‚Äî √© a maior migration do sistema |
| 2 | **RLS no Supabase para todos os models com companyId** | Seguran√ßa multi-tenant obrigat√≥ria para dezenas de empresas | ALTO |
| 3 | **companyId NOT NULL em models transacionais** | Complemento do RLS, previne dados √≥rf√£os | M√âDIO |

### TIER 1 ‚Äî Go-live Opera√ß√£o Core (Financeiro + Compras + Fiscal)

| # | A√ß√£o | Impacto | Esfor√ßo |
|---|------|---------|---------|
| 4 | Soft delete em models fiscais e cont√°beis | Compliance fiscal ‚Äî NF-e n√£o pode ser exclu√≠da | M√âDIO |
| 5 | Auditoria autom√°tica via Prisma middleware | Rastreabilidade obrigat√≥ria | M√âDIO |
| 6 | Regime tribut√°rio por empresa (config model) | Base para c√°lculos fiscais corretos | BAIXO |
| 7 | legacyId para migra√ß√£o Delphi | Habilita rollback e reconcilia√ß√£o | BAIXO |
| 8 | CST persistido no ReceivedInvoiceItem | SPED correto | BAIXO |

### TIER 2 ‚Äî Go-live RH/DP

| # | A√ß√£o | Impacto | Esfor√ßo |
|---|------|---------|---------|
| 9 | **eSocial (rubricas, XML, envio, retorno)** | Obriga√ß√£o legal, invi√°vel sem para folha interna | MUITO ALTO |
| 10 | Tabelas INSS/IRRF progressivas como model | Corre√ß√£o de c√°lculo e auditabilidade | M√âDIO |
| 11 | Cadastro de dependentes (EmployeeDependent) | IRRF correto + eSocial S-2200 | BAIXO |
| 12 | Afastamentos (EmployeeLeave) | Impacto em folha + f√©rias + 13¬∫ + eSocial | M√âDIO |

### TIER 3 ‚Äî Go-live Produ√ß√£o

| # | A√ß√£o | Impacto | Esfor√ßo |
|---|------|---------|---------|
| 13 | FK workCenterId na ProductionOrderOperation | Integridade | BAIXO |
| 14 | Rastreabilidade de lote (InventoryLot) | Requisito industrial e de qualidade | MUITO ALTO |
| 15 | Roteiro de fabrica√ß√£o (ProductionRouting) | Padroniza√ß√£o de opera√ß√µes | ALTO |

### TIER 4 ‚Äî Escala (de 7 para dezenas de empresas)

| # | A√ß√£o | Impacto | Esfor√ßo |
|---|------|---------|---------|
| 16 | groupId/parentCompanyId no Company | Hierarquia de grupos, consolida√ß√£o | M√âDIO |
| 17 | Middleware Prisma de inje√ß√£o autom√°tica de companyId | Seguran√ßa sist√™mica | M√âDIO |
| 18 | Transfer√™ncia intercompany (fiscal + estoque) | Opera√ß√£o do grupo | ALTO |
| 19 | Consolida√ß√£o financeira (caixa do grupo, elimina√ß√£o intercompany) | Vis√£o CFO/Controller | ALTO |
| 20 | Feature flags / billing por empresa-plano | Monetiza√ß√£o SaaS | ALTO |

### TIER 5 ‚Äî Diferencia√ß√£o (Produto de Mercado)

| # | A√ß√£o | Impacto | Esfor√ßo |
|---|------|---------|---------|
| 21 | Cat√°logo de produtos (spec v2.1) | Diferencial comercial | ALTO |
| 22 | Cadastro CFOP + NCM/TIPI estruturado | Automatiza√ß√£o fiscal | M√âDIO |
| 23 | SST (ASO, EPI, NRs) | Compliance trabalhista | ALTO |
| 24 | CMMS / Manuten√ß√£o industrial | Gest√£o de ativos | ALTO |
| 25 | Sindicato/Conven√ß√£o Coletiva | Piso salarial, adicionais | M√âDIO |
| 26 | Modulariza√ß√£o do mon√≥lito (bounded contexts) | Escalabilidade de equipe | MUITO ALTO |

---

## Parte D ‚Äî Nota sobre Valora√ß√£o Atualizada

Com a recalibra√ß√£o para dezenas de empresas, o sistema muda de categoria:

**De:** ERP interno multi-empresa (7 CNPJs, uso pr√≥prio)
**Para:** Plataforma ERP industrial multi-tenant com potencial SaaS

O custo de reposi√ß√£o estimado sobe significativamente quando consideramos:
- 173 models √ó 40h + m√≥dulo eSocial (~800h) + RLS/seguran√ßa (~400h) + intercompany (~600h) = **~9.700h ‚Üí ~R$ 2,5M** de desenvolvimento
- Mais o conhecimento de dom√≠nio industrial + fiscal brasileiro incorporado

A escala muda o pitch para investidores: n√£o √© "um ERP para uso interno", √© "uma plataforma que j√° opera 7 empresas e est√° preparada para dezenas". Os gaps identificados (eSocial, lote, intercompany) s√£o o roadmap de produto, n√£o d√©bito t√©cnico ‚Äî s√£o features que nenhum competitor mid-market brasileiro entrega bem.
