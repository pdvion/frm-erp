generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Company {
  id                   String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                 Int                     @unique
  name                 String
  tradeName            String?
  cnpj                 String?                 @unique
  ie                   String?
  address              String?
  city                 String?
  state                String?
  zipCode              String?
  phone                String?
  email                String?
  isActive             Boolean                 @default(true)
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @default(now()) @updatedAt
  accountsPayable      AccountsPayable[]
  accountsReceivable   AccountsReceivable[]
  actionPlans          ActionPlan[]
  aiUsageLogs          AiUsageLog[]
  approvalLevels       ApprovalLevel[]
  approvalThresholds   ApprovalThreshold[]
  bankAccounts         BankAccount[]
  budgetAccounts       BudgetAccount[]
  budgetActuals        BudgetActual[]
  budgetAlerts         BudgetAlert[]
  budgetVersions       BudgetVersion[]
  categories           Category[]
  cloneLogsSource      CloneLog[]              @relation("CloneSource")
  cloneLogsTarget      CloneLog[]              @relation("CloneTarget")
  collectionRules      CollectionRule[]
  costCenters          CostCenter[]
  customers            Customer[]
  dashboards           Dashboard[]
  dda_boletos          DdaBoleto[]
  dda_config           DdaConfig[]
  dda_sync_log         DdaSyncLog[]
  departments          Department[]
  employees            Employee[]
  goalIndicators       GoalIndicator[]
  holidays             Holiday[]
  inventory            Inventory[]
  jobPositions         JobPosition[]
  kpiValues            KpiValue[]
  kpis                 Kpi[]
  leads                Lead[]
  materialReceivings   MaterialReceiving[]
  materialRequisitions MaterialRequisition[]
  materials            Material[]
  mrpRuns              MrpRun[]
  notificationGroups   NotificationGroup[]
  notifications        Notification[]
  oeeTargets           OeeTarget[]
  paymentRequests      PaymentRequest[]
  payrolls             Payroll[]
  physicalInventories  PhysicalInventory[]
  pickingLists         PickingList[]
  pixTransactions      PixTransaction[]
  productCategories    ProductCategory[]
  productionOrders     ProductionOrder[]
  products             Product[]
  purchaseOrders       PurchaseOrder[]
  receivedInvoices     ReceivedInvoice[]
  salesOrders          SalesOrder[]
  salesQuotes          SalesQuote[]
  savedReports         SavedReport[]
  sefazPendingNfes     SefazPendingNfe[]
  sefazSyncConfig      SefazSyncConfig?
  sefazSyncLogs        SefazSyncLog[]
  stockLocations       StockLocation[]
  stockReservations    StockReservation[]
  stockTransfers       StockTransfer[]
  strategicGoals       StrategicGoal[]
  supplierReturns      SupplierReturn[]
  suppliers            Supplier[]
  systemLogs           SystemLog[]
  systemSettings       SystemSetting[]
  tasks                Task[]
  terminations         Termination[]
  thirteenthSalaries   ThirteenthSalary[]
  userCompanies        UserCompany[]
  permissions          UserCompanyPermission[]
  userGroups           UserGroup[]
  users                User[]
  vacations            Vacation[]
  workCenters          WorkCenter[]
  workSchedules        WorkSchedule[]
  workflowDefinitions  WorkflowDefinition[]
  workflowInstances    WorkflowInstance[]

  @@map("companies")
}

model User {
  id                                            String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                                          Int?
  email                                         String                      @unique
  name                                          String
  password                                      String?
  isActive                                      Boolean                     @default(true)
  companyId                                     String?                     @db.Uuid
  createdAt                                     DateTime                    @default(now())
  updatedAt                                     DateTime                    @default(now()) @updatedAt
  actionPlanTasks                               ActionPlanTask[]
  actionPlansCreated                            ActionPlan[]                @relation("ActionPlanCreator")
  actionPlansResponsible                        ActionPlan[]                @relation("ActionPlanResponsible")
  approvalLevelApprovers                        ApprovalLevelApprover[]
  approverThresholds                            ApprovalThresholdApprover[]
  auditLogs                                     AuditLog[]
  budgetAlertsResolved                          BudgetAlert[]
  budgetVersionsApproved                        BudgetVersion[]             @relation("BudgetApprover")
  budgetVersionsCreated                         BudgetVersion[]             @relation("BudgetCreator")
  cloneLogs                                     CloneLog[]
  dashboardsCreated                             Dashboard[]
  dda_boletos_dda_boletos_aprovado_porTousers   DdaBoleto[]                 @relation("dda_boletos_aprovado_porTousers")
  dda_boletos_dda_boletos_created_byTousers     DdaBoleto[]                 @relation("dda_boletos_created_byTousers")
  employeeProfile                               Employee[]
  inventoryMovements                            InventoryMovement[]
  assignedLeads                                 Lead[]
  addedGroupMembers                             NotificationGroupMember[]   @relation("GroupMemberAddedBy")
  notificationGroupMemberships                  NotificationGroupMember[]
  notificationPreferences                       NotificationPreference[]
  notifications                                 Notification[]
  payableApprovals                              PayableApproval[]
  paymentApprovalsGiven                         PaymentApproval[]           @relation("PaymentApprover")
  paymentApprovalsDelegated                     PaymentApproval[]           @relation("PaymentDelegate")
  paymentRequestsCreated                        PaymentRequest[]            @relation("PaymentRequester")
  pickingItemsPicked                            PickingListItem[]
  pickingListsAssigned                          PickingList[]               @relation("PickingAssignee")
  pickingListsCreated                           PickingList[]               @relation("PickingCreator")
  pickingVerifications                          PickingVerification[]
  requisitionApprovals                          RequisitionApproval[]
  savedReports                                  SavedReport[]
  transfersApproved                             StockTransfer[]             @relation("TransferApproved")
  transfersReceived                             StockTransfer[]             @relation("TransferReceived")
  transfersRequested                            StockTransfer[]             @relation("TransferRequested")
  transfersShipped                              StockTransfer[]             @relation("TransferShipped")
  strategicGoalsOwned                           StrategicGoal[]
  systemLogs                                    SystemLog[]
  settingsUpdated                               SystemSetting[]
  task_history_task_history_new_owner_idTousers TaskHistory[]               @relation("task_history_new_owner_idTousers")
  task_history_task_history_old_owner_idTousers TaskHistory[]               @relation("task_history_old_owner_idTousers")
  taskHistory                                   TaskHistory[]
  tasksCreated                                  Task[]                      @relation("TaskCreatedBy")
  tasksOwned                                    Task[]                      @relation("TaskOwner")
  tasksTargeted                                 Task[]                      @relation("TaskTargetUser")
  time_clock_entries                            TimeClockEntry[]
  tutorials                                     Tutorial[]
  userCompanies                                 UserCompany[]
  permissions                                   UserCompanyPermission[]
  addedToGroups                                 UserGroupMember[]           @relation("AddedByUser")
  groupMemberships                              UserGroupMember[]
  company                                       Company?                    @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  workflowDefinitionsCreated                    WorkflowDefinition[]
  workflowInstancesCancelled                    WorkflowInstance[]          @relation("WorkflowCanceller")
  workflowInstancesStarted                      WorkflowInstance[]          @relation("WorkflowStarter")
  workflowStepsAssigned                         WorkflowStepHistory[]       @relation("StepAssignee")
  workflowStepsCompleted                        WorkflowStepHistory[]       @relation("StepCompleter")
  workflowStepEscalations                       WorkflowStep[]              @relation("StepEscalation")

  @@index([companyId])
  @@map("users")
}

model UserCompany {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @db.Uuid
  companyId String   @db.Uuid
  isDefault Boolean  @default(false)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userId, companyId])
  @@index([companyId], map: "idx_user_companies_company")
  @@index([companyId], map: "idx_user_companies_companyId")
  @@index([userId], map: "idx_user_companies_user")
  @@index([userId])
  @@map("user_companies")
}

model UserCompanyPermission {
  id         String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId     String          @db.Uuid
  companyId  String          @db.Uuid
  module     SystemModule
  permission PermissionLevel @default(NONE)
  canShare   Boolean         @default(false)
  canClone   Boolean         @default(false)
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @default(now()) @updatedAt
  company    Company         @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user       User            @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userId, companyId, module])
  @@index([companyId], map: "idx_user_company_permissions_companyId")
  @@index([userId])
  @@map("user_company_permissions")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model SystemSetting {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  key           String   @db.VarChar(100)
  value         Json
  category      String   @default("general") @db.VarChar(50)
  companyId     String?  @db.Uuid
  description   String?
  updatedBy     String?  @db.Uuid
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt
  company       Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)
  updatedByUser User?    @relation(fields: [updatedBy], references: [id])

  @@index([category])
  @@index([companyId])
  @@index([updatedBy])
  @@map("system_settings")
}

model UserGroup {
  id          String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String            @db.VarChar(100)
  description String?
  companyId   String?           @db.Uuid
  permissions Json              @default("[]")
  isSystem    Boolean           @default(false)
  isActive    Boolean           @default(true)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @default(now()) @updatedAt
  members     UserGroupMember[]
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId], map: "idx_user_groups_companyId")
  @@map("user_groups")
}

model UserGroupMember {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String    @db.Uuid
  groupId     String    @db.Uuid
  addedBy     String?   @db.Uuid
  addedAt     DateTime  @default(now())
  addedByUser User?     @relation("AddedByUser", fields: [addedBy], references: [id])
  group       UserGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, groupId])
  @@index([groupId], map: "idx_user_group_members_groupId")
  @@index([addedBy])
  @@index([userId])
  @@map("user_group_members")
}

model CloneLog {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sourceCompanyId String   @db.Uuid
  targetCompanyId String   @db.Uuid
  entityType      String
  entityId        String   @db.Uuid
  clonedEntityId  String   @db.Uuid
  clonedBy        String   @db.Uuid
  createdAt       DateTime @default(now())
  clonedByUser    User     @relation(fields: [clonedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sourceCompany   Company  @relation("CloneSource", fields: [sourceCompanyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  targetCompany   Company  @relation("CloneTarget", fields: [targetCompanyId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([clonedBy])
  @@index([sourceCompanyId])
  @@index([targetCompanyId])
  @@map("clone_logs")
}

model Category {
  id        String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code      Int?
  name      String
  parentId  String?    @db.Uuid
  isActive  Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @default(now()) @updatedAt
  isShared  Boolean    @default(false)
  companyId String?    @db.Uuid
  company   Company?   @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  parent    Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children  Category[] @relation("CategoryHierarchy")
  materials Material[]

  @@index([companyId])
  @@index([parentId])
  @@map("categories")
}

model Material {
  id                          String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                        Int                       @unique
  internalCode                String?
  description                 String
  categoryId                  String?                   @db.Uuid
  unit                        String                    @default("UN")
  location                    String?
  minQuantity                 Float                     @default(0)
  maxQuantity                 Float?
  monthlyAverage              Float                     @default(0)
  lastPurchasePrice           Float?
  lastPurchaseDate            DateTime?
  ncm                         String?
  status                      MaterialStatus            @default(ACTIVE)
  requiresQualityCheck        Boolean                   @default(false)
  companyId                   String?                   @db.Uuid
  createdAt                   DateTime                  @default(now())
  updatedAt                   DateTime                  @default(now()) @updatedAt
  isShared                    Boolean                   @default(false)
  purchaseUnit                String?                   @map("purchase_unit")
  unitConversionFactor        Float?                    @default(1) @map("unit_conversion_factor")
  subCategoryId               String?                   @map("sub_category_id") @db.Uuid
  writeOffCode                String?                   @map("write_off_code")
  isEpi                       Boolean?                  @default(false) @map("is_epi")
  isOfficeSupply              Boolean?                  @default(false) @map("is_office_supply")
  notes                       String?
  ipiRate                     Float?                    @default(0) @map("ipi_rate")
  icmsRate                    Float?                    @default(0) @map("icms_rate")
  avgDeliveryDays             Float?                    @default(0) @map("avg_delivery_days")
  calculatedMinQuantity       Float?                    @default(0) @map("calculated_min_quantity")
  minQuantityCalcType         String?                   @default("MANUAL") @map("min_quantity_calc_type")
  minQuantityAlarmDate        DateTime?                 @map("min_quantity_alarm_date") @db.Timestamp(6)
  minQuantityCalcDate         DateTime?                 @map("min_quantity_calc_date") @db.Timestamp(6)
  adjustMaxConsumptionManual  Boolean?                  @default(false) @map("adjust_max_consumption_manual")
  maxMonthlyConsumption       Float?                    @default(0) @map("max_monthly_consumption")
  reservedQuantity            Float?                    @default(0) @map("reserved_quantity")
  peak12Months                Float?                    @default(0) @map("peak_12_months")
  lastPurchasePriceAvg        Float?                    @default(0) @map("last_purchase_unit_price_avg")
  lastPurchaseQuantity        Float?                    @default(0) @map("last_purchase_quantity")
  lastSupplierId              String?                   @map("last_supplier_id") @db.Uuid
  costCenterFrm               String?                   @map("cost_center_frm")
  costCenterFnd               String?                   @map("cost_center_fnd")
  financialAccount            String?                   @map("financial_account")
  requiredBrand               String?                   @map("required_brand")
  requiredBrandReason         String?                   @map("required_brand_reason")
  stockLocationId             String?                   @map("stock_location_id") @db.Uuid
  requiresQualityInspection   Boolean?                  @default(false) @map("requires_quality_inspection")
  requiresMaterialCertificate Boolean?                  @default(false) @map("requires_material_certificate")
  requiresControlSheets       Boolean?                  @default(false) @map("requires_control_sheets")
  requiresReturn              Boolean?                  @default(false) @map("requires_return")
  requiresFiscalEntry         Boolean?                  @default(false) @map("requires_fiscal_entry")
  parentProductId             String?                   @map("parent_product_id") @db.Uuid
  assetId                     String?                   @map("asset_id") @db.Uuid
  weight                      Float?                    @default(0)
  weightUnit                  String?                   @default("KG") @map("weight_unit")
  barcode                     String?
  manufacturer                String?
  manufacturerCode            String?                   @map("manufacturer_code")
  epiCaCode                   String?                   @map("epi_ca_code")
  financialValidated          Boolean                   @default(false) @map("financial_validated")
  financialValidatedCc        Boolean                   @default(false) @map("financial_validated_cc")
  bomAsChild                  BomItem[]                 @relation("BomChild")
  bomAsParent                 BomItem[]                 @relation("BomParent")
  import_process_items        ImportProcessItem[]
  inventory                   Inventory[]
  inventoryCounts             InventoryCount[]
  issuedInvoiceItems          IssuedInvoiceItem[]
  locationInventory           LocationInventory[]
  receivingItems              MaterialReceivingItem[]
  requisitionItems            MaterialRequisitionItem[]
  category                    Category?                 @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  company                     Company?                  @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  mrpParameter                MrpParameter?
  mrpSuggestions              MrpSuggestion[]
  pickingListItems            PickingListItem[]
  productionOrderMaterials    ProductionOrderMaterial[] @relation("ProductionMaterial")
  productionOrdersAsProduct   ProductionOrder[]         @relation("ProductionProduct")
  catalogProducts             Product[]
  purchaseOrderItems          PurchaseOrderItem[]
  quoteItems                  QuoteItem[]
  receivedInvoiceItems        ReceivedInvoiceItem[]
  salesOrderItems             SalesOrderItem[]
  salesQuoteItems             SalesQuoteItem[]
  stockReservations           StockReservation[]
  stockTransferItems          StockTransferItem[]
  supplierMaterials           SupplierMaterial[]
  supplierReturnItems         SupplierReturnItem[]
  qualityInspections          QualityInspection[]
  nonConformities             NonConformity[]

  @@index([companyId], map: "idx_materials_companyId")
  @@index([categoryId])
  @@map("materials")
}

model Supplier {
  id                      String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                    Int                          @unique
  companyName             String
  tradeName               String?
  cnpj                    String?                      @unique
  cpf                     String?
  ie                      String?
  im                      String?
  address                 String?
  number                  String?
  complement              String?
  neighborhood            String?
  city                    String?
  state                   String?
  zipCode                 String?
  country                 String                       @default("Brasil")
  phone                   String?
  mobile                  String?
  email                   String?
  website                 String?
  contactName             String?
  paymentTerms            String?
  notes                   String?
  status                  SupplierStatus               @default(ACTIVE)
  qualityIndex            Float?
  companyId               String?                      @db.Uuid
  createdAt               DateTime                     @default(now())
  updatedAt               DateTime                     @default(now()) @updatedAt
  isShared                Boolean                      @default(false)
  cat01Embalagens         Boolean?                     @default(false) @map("cat01_embalagens")
  cat02Tintas             Boolean?                     @default(false) @map("cat02_tintas")
  cat03OleosGraxas        Boolean?                     @default(false) @map("cat03_oleos_graxas")
  cat04Dispositivos       Boolean?                     @default(false) @map("cat04_dispositivos")
  cat05Acessorios         Boolean?                     @default(false) @map("cat05_acessorios")
  cat06Manutencao         Boolean?                     @default(false) @map("cat06_manutencao")
  cat07Servicos           Boolean?                     @default(false) @map("cat07_servicos")
  cat08Escritorio         Boolean?                     @default(false) @map("cat08_escritorio")
  isWholesaler            Boolean?                     @default(false) @map("is_wholesaler")
  isRetailer              Boolean?                     @default(false) @map("is_retailer")
  isIndustry              Boolean?                     @default(false) @map("is_industry")
  isService               Boolean?                     @default(false) @map("is_service")
  activityTypeId          String?                      @map("activity_type_id")
  cnae                    String?
  certificationType       supplier_certification_type? @map("certification_type")
  certificationExpiryDate DateTime?                    @map("certification_expiry_date") @db.Timestamptz(6)
  certificationFileName   String?                      @map("certification_file_name")
  overallQualityPercent   Float?                       @map("overall_quality_percent")
  iqfPercent              Float?                       @map("iqf_percent")
  qualityCalcDate         DateTime?                    @map("quality_calc_date") @db.Timestamptz(6)
  iqfStatus               supplier_iqf_status?         @map("iqf_status")
  taxRegime               String?                      @map("tax_regime")
  sefazQueryDate          DateTime?                    @map("sefaz_query_date") @db.Timestamptz(6)
  hasFinancialContract    Boolean?                     @default(false) @map("has_financial_contract")
  accountsPayable         AccountsPayable[]
  dda_boletos             DdaBoleto[]
  import_processes        ImportProcess[]
  inventoryMovements      InventoryMovement[]
  materialReceivings      MaterialReceiving[]
  purchaseOrders          PurchaseOrder[]
  quotes                  Quote[]
  receivedInvoices        ReceivedInvoice[]
  supplierMaterials       SupplierMaterial[]
  supplierReturns         SupplierReturn[]
  company                 Company?                     @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([companyId], map: "idx_suppliers_companyId")
  @@map("suppliers")
}

model SupplierMaterial {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  supplierId    String    @db.Uuid
  materialId    String    @db.Uuid
  supplierCode  String?
  lastPrice     Float?
  lastPriceDate DateTime?
  leadTimeDays  Int?
  minOrderQty   Float?
  isPreferred   Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now()) @updatedAt
  material      Material  @relation(fields: [materialId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  supplier      Supplier  @relation(fields: [supplierId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([supplierId, materialId])
  @@index([materialId])
  @@map("supplier_materials")
}

model Inventory {
  id                       String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  materialId               String              @db.Uuid
  companyId                String?             @db.Uuid
  inventoryType            InventoryType       @default(RAW_MATERIAL)
  quantity                 Float               @default(0)
  reservedQty              Float               @default(0)
  availableQty             Float               @default(0)
  unitCost                 Float               @default(0)
  totalCost                Float               @default(0)
  lastMovementAt           DateTime?
  createdAt                DateTime            @default(now())
  updatedAt                DateTime            @default(now()) @updatedAt
  location                 String?
  quantitySemiFinished     Float?              @default(0) @map("quantity_semi_finished")
  quantityFinished         Float?              @default(0) @map("quantity_finished")
  quantityCritical         Float?              @default(0) @map("quantity_critical")
  quantityScrap            Float?              @default(0) @map("quantity_scrap")
  quantityDead             Float?              @default(0) @map("quantity_dead")
  quantityAccountingInd    Float?              @default(0) @map("quantity_accounting_ind")
  quantityAccountingResale Float?              @default(0) @map("quantity_accounting_resale")
  quantityOnOrder          Float?              @default(0) @map("quantity_on_order")
  expectedDeliveryDate     DateTime?           @map("expected_delivery_date") @db.Timestamptz(6)
  consumptionRuleId        String?             @map("consumption_rule_id")
  consumeByFormula         Boolean?            @default(false) @map("consume_by_formula")
  legacyProductCode        Int?                @map("legacy_product_code")
  version                  Int                 @default(1)
  company                  Company?            @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  material                 Material            @relation(fields: [materialId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  movements                InventoryMovement[]
  reservations             StockReservation[]

  @@unique([materialId, companyId, inventoryType])
  @@index([companyId], map: "idx_inventory_companyId")
  @@index([id, version], map: "idx_inventory_version")
  @@map("inventory")
}

model InventoryMovement {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  inventoryId    String       @db.Uuid
  movementType   MovementType
  quantity       Float
  unitCost       Float        @default(0)
  totalCost      Float        @default(0)
  balanceAfter   Float        @default(0)
  documentType   String?
  documentNumber String?
  documentId     String?
  supplierId     String?      @db.Uuid
  notes          String?
  userId         String?      @db.Uuid
  movementDate   DateTime     @default(now())
  createdAt      DateTime     @default(now())
  inventory      Inventory    @relation(fields: [inventoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  supplier       Supplier?    @relation(fields: [supplierId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user           User?        @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([inventoryId, movementDate])
  @@index([supplierId])
  @@index([userId])
  @@map("inventory_movements")
}

model StockReservation {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code           Int
  companyId      String?   @db.Uuid
  inventoryId    String    @db.Uuid
  materialId     String    @db.Uuid
  quantity       Float
  consumedQty    Float     @default(0)
  documentType   String
  documentId     String
  documentNumber String?
  status         String    @default("ACTIVE")
  expiresAt      DateTime?
  notes          String?
  createdBy      String?
  createdAt      DateTime  @default(now())
  releasedAt     DateTime?
  releasedBy     String?
  releaseReason  String?
  consumedAt     DateTime?
  company        Company?  @relation(fields: [companyId], references: [id])
  inventory      Inventory @relation(fields: [inventoryId], references: [id])
  material       Material  @relation(fields: [materialId], references: [id])

  @@unique([companyId, code])
  @@index([materialId, status])
  @@index([documentType, documentId])
  @@index([inventoryId], map: "idx_stock_reservations_inventory")
  @@map("stock_reservations")
}

model Quote {
  id                    String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                  Int             @unique
  supplierId            String          @db.Uuid
  status                QuoteStatus     @default(DRAFT)
  requestDate           DateTime        @default(now())
  responseDate          DateTime?
  validUntil            DateTime?
  paymentTerms          String?
  deliveryTerms         String?
  freightValue          Float           @default(0)
  discountPercent       Float           @default(0)
  totalValue            Float           @default(0)
  notes                 String?
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @default(now()) @updatedAt
  revision              Int?            @default(1)
  preApprovedById       String?         @map("pre_approved_by_id")
  preApprovedAt         DateTime?       @map("pre_approved_at") @db.Timestamptz(6)
  approvedById          String?         @map("approved_by_id")
  approvedAt            DateTime?       @map("approved_at") @db.Timestamptz(6)
  materialsModifiedById String?         @map("materials_modified_by_id")
  materialsModifiedAt   DateTime?       @map("materials_modified_at") @db.Timestamptz(6)
  suppliersModifiedById String?         @map("suppliers_modified_by_id")
  suppliersModifiedAt   DateTime?       @map("suppliers_modified_at") @db.Timestamptz(6)
  quotePdfName          String?         @map("quote_pdf_name")
  quotePrintedAt        DateTime?       @map("quote_printed_at") @db.Timestamptz(6)
  attachment1           String?
  attachment2           String?
  attachment3           String?
  analysisExecuted      Boolean?        @default(false) @map("analysis_executed")
  conversationHistory   String?         @map("conversation_history")
  ownerCompanyId        String?         @map("owner_company_id")
  costCenterGroup       Int?            @map("cost_center_group")
  requisitionId         String?         @map("requisition_id")
  requesterName         String?         @map("requester_name")
  approverName          String?         @map("approver_name")
  completionPercent     Int?            @default(0) @map("completion_percent")
  purchaseOrders        PurchaseOrder[]
  items                 QuoteItem[]
  supplier              Supplier        @relation(fields: [supplierId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([supplierId], map: "idx_quotes_supplierId")
  @@map("quotes")
}

model QuoteItem {
  id                 String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  quoteId            String              @db.Uuid
  materialId         String              @db.Uuid
  quantity           Float
  unitPrice          Float               @default(0)
  totalPrice         Float               @default(0)
  deliveryDays       Int?
  notes              String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @default(now()) @updatedAt
  purchaseOrderItems PurchaseOrderItem[]
  material           Material            @relation(fields: [materialId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  quote              Quote               @relation(fields: [quoteId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([materialId], map: "idx_quote_items_materialId")
  @@index([quoteId], map: "idx_quote_items_quoteId")
  @@map("quote_items")
}

model PurchaseOrder {
  id                    String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                  Int                 @unique
  supplierId            String              @db.Uuid
  quoteId               String?             @db.Uuid
  status                PurchaseOrderStatus @default(DRAFT)
  orderDate             DateTime            @default(now())
  expectedDeliveryDate  DateTime?
  actualDeliveryDate    DateTime?
  paymentTerms          String?
  deliveryTerms         String?
  freightValue          Float               @default(0)
  discountPercent       Float               @default(0)
  totalValue            Float               @default(0)
  notes                 String?
  companyId             String?             @db.Uuid
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @default(now()) @updatedAt
  application           String?
  quoteSupplierCode     Int?                @map("quote_supplier_code")
  billingCompanyId      String?             @map("billing_company_id")
  costCenterGroup       Int?                @map("cost_center_group")
  carrier               String?
  deliveryAddress       String?             @map("delivery_address")
  deliveryPhone         String?             @map("delivery_phone")
  operationNature       operation_nature?   @map("operation_nature")
  paymentConditionId    String?             @map("payment_condition_id")
  paymentConditionDesc  String?             @map("payment_condition_desc")
  freightType           freight_type?       @map("freight_type")
  fobFreightValue       Float?              @default(0) @map("fob_freight_value")
  pickupKm              Float?              @map("pickup_km")
  pickupValue           Float?              @map("pickup_value")
  cancellationReason    String?             @map("cancellation_reason")
  financialApproved     Boolean?            @default(false) @map("financial_approved")
  financialApprovedById String?             @map("financial_approved_by_id")
  financialApprovedAt   DateTime?           @map("financial_approved_at") @db.Timestamptz(6)
  analysisApprovedById  String?             @map("analysis_approved_by_id")
  analysisApprovedAt    DateTime?           @map("analysis_approved_at") @db.Timestamptz(6)
  import_process_items  ImportProcessItem[]
  materialReceivings    MaterialReceiving[]
  items                 PurchaseOrderItem[]
  company               Company?            @relation(fields: [companyId], references: [id])
  quote                 Quote?              @relation(fields: [quoteId], references: [id])
  supplier              Supplier            @relation(fields: [supplierId], references: [id])
  receivedInvoices      ReceivedInvoice[]

  @@index([status])
  @@index([companyId], map: "idx_purchase_orders_companyId")
  @@index([supplierId], map: "idx_purchase_orders_supplierId")
  @@index([quoteId])
  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id                     String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  purchaseOrderId        String                  @db.Uuid
  materialId             String                  @db.Uuid
  quoteItemId            String?                 @db.Uuid
  quantity               Float
  unitPrice              Float                   @default(0)
  totalPrice             Float                   @default(0)
  receivedQty            Float                   @default(0)
  deliveryDays           Int?
  notes                  String?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @default(now()) @updatedAt
  materialReceivingItems MaterialReceivingItem[]
  material               Material                @relation(fields: [materialId], references: [id])
  purchaseOrder          PurchaseOrder           @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  quoteItem              QuoteItem?              @relation(fields: [quoteItemId], references: [id])
  receivedInvoiceItems   ReceivedInvoiceItem[]

  @@index([materialId], map: "idx_purchase_order_items_materialId")
  @@index([purchaseOrderId], map: "idx_purchase_order_items_purchaseOrderId")
  @@index([quoteItemId])
  @@map("purchase_order_items")
}

model AuditLog {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId        String?     @db.Uuid
  userEmail     String?
  userName      String?
  companyId     String?     @db.Uuid
  companyName   String?
  action        AuditAction
  entityType    String
  entityId      String?
  entityCode    String?
  description   String?
  oldValues     Json?
  newValues     Json?
  changedFields String[]    @default([])
  ipAddress     String?
  userAgent     String?
  requestPath   String?
  requestMethod String?
  createdAt     DateTime    @default(now())
  user          User?       @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([companyId])
  @@map("audit_logs")
}

model ReceivedInvoice {
  id                          String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  accessKey                   String                @unique @db.VarChar(44)
  invoiceNumber               Int
  series                      Int                   @default(1)
  issueDate                   DateTime
  supplierId                  String?               @db.Uuid
  supplierCnpj                String                @db.VarChar(18)
  supplierName                String                @db.VarChar(255)
  totalProducts               Float                 @default(0)
  totalInvoice                Float                 @default(0)
  freightValue                Float                 @default(0)
  discountValue               Float                 @default(0)
  icmsBase                    Float                 @default(0)
  icmsValue                   Float                 @default(0)
  ipiValue                    Float                 @default(0)
  pisValue                    Float                 @default(0)
  cofinsValue                 Float                 @default(0)
  status                      String                @default("PENDING") @db.VarChar(20)
  purchaseOrderId             String?               @db.Uuid
  receivedAt                  DateTime?
  receivedBy                  String?               @db.Uuid
  approvedAt                  DateTime?
  approvedBy                  String?               @db.Uuid
  rejectedAt                  DateTime?
  rejectedBy                  String?               @db.Uuid
  rejectionReason             String?
  companyId                   String?               @db.Uuid
  xmlContent                  String?
  createdAt                   DateTime              @default(now())
  updatedAt                   DateTime              @default(now()) @updatedAt
  icms_st_base                Float?                @default(0)
  icms_st_value               Float?                @default(0)
  insurance_value             Float?                @default(0)
  other_expenses              Float?                @default(0)
  icms_credit                 Float?                @default(0)
  icms_st_credit              Float?                @default(0)
  icms_sn_credit              Float?                @default(0)
  ipi_credit                  Float?                @default(0)
  pis_credit                  Float?                @default(0)
  cofins_credit               Float?                @default(0)
  cost_center_group           Int?
  cost_center_confirmed_by_id String?
  payment_condition_id        String?
  installments_calculated     Boolean?              @default(false)
  payment_date                DateTime?             @db.Timestamptz(6)
  additional_info             String?
  xml_supplier_id             String?
  accountsPayable             AccountsPayable[]
  materialReceivings          MaterialReceiving[]
  items                       ReceivedInvoiceItem[]
  company                     Company?              @relation(fields: [companyId], references: [id], onUpdate: NoAction)
  purchaseOrder               PurchaseOrder?        @relation(fields: [purchaseOrderId], references: [id], onUpdate: NoAction)
  supplier                    Supplier?             @relation(fields: [supplierId], references: [id], onUpdate: NoAction)
  sefazPendingNfes            SefazPendingNfe[]
  supplierReturns             SupplierReturn[]

  @@index([companyId], map: "idx_received_invoices_companyId")
  @@index([supplierId], map: "idx_received_invoices_supplierId")
  @@index([purchaseOrderId])
  @@map("received_invoices")
}

model ReceivedInvoiceItem {
  id                    String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  invoiceId             String               @db.Uuid
  itemNumber            Int
  productCode           String               @db.VarChar(60)
  productName           String               @db.VarChar(255)
  ncm                   String?              @db.VarChar(10)
  cfop                  Int
  quantity              Float
  unit                  String               @db.VarChar(10)
  unitPrice             Float
  totalPrice            Float
  icmsRate              Float                @default(0)
  icmsValue             Float                @default(0)
  ipiRate               Float                @default(0)
  ipiValue              Float                @default(0)
  materialId            String?              @db.Uuid
  purchaseOrderItemId   String?              @db.Uuid
  matchStatus           String               @default("PENDING") @db.VarChar(20)
  divergenceType        String?              @db.VarChar(20)
  divergenceNote        String?
  receivedQty           Float                @default(0)
  createdAt             DateTime             @default(now())
  invoice               ReceivedInvoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  material              Material?            @relation(fields: [materialId], references: [id], onUpdate: NoAction)
  purchaseOrderItem     PurchaseOrderItem?   @relation(fields: [purchaseOrderItemId], references: [id], onUpdate: NoAction)
  supplier_return_items SupplierReturnItem[]

  @@index([invoiceId], map: "idx_received_invoice_items_invoiceId")
  @@index([materialId], map: "idx_received_invoice_items_materialId")
  @@index([purchaseOrderItemId])
  @@map("received_invoice_items")
}

model AccountsPayable {
  id                      String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                    Int
  companyId               String?                 @db.Uuid
  supplierId              String                  @db.Uuid
  documentType            PayableType             @default(INVOICE)
  documentNumber          String?                 @db.VarChar(50)
  documentId              String?                 @db.Uuid
  invoiceId               String?                 @db.Uuid
  description             String
  dueDate                 DateTime
  issueDate               DateTime                @default(now())
  originalValue           Float
  discountValue           Float                   @default(0)
  interestValue           Float                   @default(0)
  fineValue               Float                   @default(0)
  paidValue               Float                   @default(0)
  netValue                Float
  status                  PayableStatus           @default(PENDING)
  paidAt                  DateTime?
  installmentNumber       Int                     @default(1)
  totalInstallments       Int                     @default(1)
  categoryId              String?                 @db.Uuid
  costCenterId            String?                 @db.Uuid
  notes                   String?
  barcode                 String?                 @db.VarChar(100)
  createdBy               String?                 @db.Uuid
  createdAt               DateTime                @default(now())
  updatedAt               DateTime                @default(now()) @updatedAt
  bankAccountId           String?                 @db.Uuid
  approvalStatus          ApprovalStatus?         @default(PENDING)
  scheduledPaymentDate    DateTime?
  additionalInfo          String?                 @map("additional_info")
  hasWithholding          Boolean?                @default(false) @map("has_withholding")
  withholdingIr           Float?                  @default(0) @map("withholding_ir")
  withholdingIss          Float?                  @default(0) @map("withholding_iss")
  withholdingInss         Float?                  @default(0) @map("withholding_inss")
  withholdingPis          Float?                  @default(0) @map("withholding_pis")
  withholdingCofins       Float?                  @default(0) @map("withholding_cofins")
  withholdingCsll         Float?                  @default(0) @map("withholding_csll")
  supplierAlphaCode       String?                 @map("supplier_alpha_code")
  supplierCnpj            String?                 @map("supplier_cnpj")
  supplierIe              String?                 @map("supplier_ie")
  supplierStateCode       Int?                    @map("supplier_state_code")
  costCenterGroup         Int?                    @map("cost_center_group")
  costCenterCode          String?                 @map("cost_center_code")
  costCenterNotes         String?                 @map("cost_center_notes")
  sectorConfirmedAt       DateTime?               @map("sector_confirmed_at") @db.Timestamptz(6)
  sectorConfirmedById     String?                 @map("sector_confirmed_by_id")
  physicalDeliveryAt      DateTime?               @map("physical_delivery_at") @db.Timestamptz(6)
  physicalDeliveryById    String?                 @map("physical_delivery_by_id")
  paymentReleasedAt       DateTime?               @map("payment_released_at") @db.Timestamptz(6)
  paymentReleasedById     String?                 @map("payment_released_by_id")
  paymentBankId           String?                 @map("payment_bank_id")
  pdfFileName             String?                 @map("pdf_file_name")
  contractType            payable_contract_type?  @map("contract_type")
  bankAccount             BankAccount?            @relation(fields: [bankAccountId], references: [id], onUpdate: NoAction, map: "accounts_payable_bankaccount_fkey")
  company                 Company?                @relation(fields: [companyId], references: [id])
  costCenter              CostCenter?             @relation(fields: [costCenterId], references: [id], onUpdate: NoAction, map: "accounts_payable_costcenter_fkey")
  invoice                 ReceivedInvoice?        @relation(fields: [invoiceId], references: [id])
  supplier                Supplier                @relation(fields: [supplierId], references: [id])
  bankTransactions        BankTransaction[]
  dda_boletos             DdaBoleto[]
  approvals               PayableApproval[]
  attachments             PayableAttachment[]
  costAllocations         PayableCostAllocation[]
  payments                PayablePayment[]
  paymentRequests         PaymentRequest[]

  @@unique([companyId, code])
  @@index([invoiceId])
  @@index([bankAccountId], map: "idx_accounts_payable_bankaccount")
  @@index([companyId], map: "idx_accounts_payable_companyId")
  @@index([costCenterId], map: "idx_accounts_payable_costcenter")
  @@index([supplierId], map: "idx_accounts_payable_supplierId")
  @@map("accounts_payable")
}

model PayablePayment {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  payableId         String          @db.Uuid
  paymentDate       DateTime
  value             Float
  discountValue     Float           @default(0)
  interestValue     Float           @default(0)
  fineValue         Float           @default(0)
  paymentMethod     String?         @db.VarChar(50)
  bankAccountId     String?         @db.Uuid
  notes             String?
  createdBy         String?         @db.Uuid
  createdAt         DateTime        @default(now())
  bankTransactionId String?         @db.Uuid
  payable           AccountsPayable @relation(fields: [payableId], references: [id], onDelete: Cascade)

  @@index([payableId])
  @@index([paymentDate])
  @@map("payable_payments")
}

model MaterialRequisition {
  id          String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code        Int
  companyId   String?                   @db.Uuid
  type        RequisitionType           @default(PRODUCTION)
  costCenter  String?                   @db.VarChar(50)
  projectCode String?                   @db.VarChar(50)
  orderNumber String?                   @db.VarChar(50)
  requestedBy String?                   @db.Uuid
  requestedAt DateTime                  @default(now())
  department  String?                   @db.VarChar(100)
  status      RequisitionStatus         @default(DRAFT)
  approvedBy  String?                   @db.Uuid
  approvedAt  DateTime?
  separatedBy String?                   @db.Uuid
  separatedAt DateTime?
  notes       String?
  priority    Int                       @default(3)
  createdBy   String?                   @db.Uuid
  createdAt   DateTime                  @default(now())
  updatedAt   DateTime                  @default(now()) @updatedAt
  items       MaterialRequisitionItem[]
  company     Company?                  @relation(fields: [companyId], references: [id])
  approvals   RequisitionApproval[]

  @@unique([companyId, code])
  @@index([companyId])
  @@index([status])
  @@index([requestedAt])
  @@index([type])
  @@map("material_requisitions")
}

model MaterialRequisitionItem {
  id            String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  requisitionId String              @db.Uuid
  materialId    String              @db.Uuid
  requestedQty  Float
  approvedQty   Float?
  separatedQty  Float               @default(0)
  unitCost      Float               @default(0)
  totalCost     Float               @default(0)
  notes         String?
  createdAt     DateTime            @default(now())
  material      Material            @relation(fields: [materialId], references: [id])
  requisition   MaterialRequisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)

  @@index([requisitionId])
  @@index([materialId])
  @@map("material_requisition_items")
}

model ProductionOrder {
  id                      String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                    Int
  companyId               String?                    @db.Uuid
  productId               String                     @db.Uuid
  quantity                Float
  producedQty             Float                      @default(0)
  plannedStart            DateTime?
  plannedEnd              DateTime?
  actualStart             DateTime?
  actualEnd               DateTime?
  dueDate                 DateTime?
  status                  ProductionOrderStatus      @default(PLANNED)
  priority                Int                        @default(3)
  salesOrderNumber        String?                    @db.VarChar(50)
  customerName            String?                    @db.VarChar(200)
  notes                   String?
  createdBy               String?                    @db.Uuid
  createdAt               DateTime                   @default(now())
  updatedAt               DateTime                   @default(now()) @updatedAt
  request_type            production_request_type?
  execution_type          production_execution_type?
  customer_id             String?
  delivery_date           DateTime?                  @db.Timestamptz(6)
  delivery_type           production_delivery_type?
  suggested_delivery_date DateTime?                  @db.Timestamptz(6)
  delivery_date_changed   Boolean?                   @default(false)
  responsible_employee_id String?
  delivery_user_id        String?
  finished_quantity       Int?                       @default(0)
  painted_quantity        Int?                       @default(0)
  raw_material_origin     raw_material_origin?
  export_code             Int?
  grouped_order_id        String?
  type_before_urgency     Int?
  date_before_urgency     DateTime?                  @db.Timestamptz(6)
  printed                 Boolean?                   @default(false)
  production_costs        ProductionCost[]
  productionLogs          ProductionLog[]
  materials               ProductionOrderMaterial[]
  operations              ProductionOrderOperation[]
  company                 Company?                   @relation(fields: [companyId], references: [id])
  product                 Material                   @relation("ProductionProduct", fields: [productId], references: [id])
  salesOrderItems         SalesOrderItem[]
  qualityInspections      QualityInspection[]
  nonConformities         NonConformity[]

  @@unique([companyId, code])
  @@index([dueDate])
  @@index([companyId], map: "idx_production_orders_companyId")
  @@index([productId], map: "idx_production_orders_product")
  @@map("production_orders")
}

model ProductionOrderMaterial {
  id          String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderId     String          @db.Uuid
  materialId  String          @db.Uuid
  requiredQty Float
  consumedQty Float           @default(0)
  unitCost    Float           @default(0)
  totalCost   Float           @default(0)
  notes       String?
  createdAt   DateTime        @default(now())
  material    Material        @relation("ProductionMaterial", fields: [materialId], references: [id])
  order       ProductionOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([materialId])
  @@index([materialId], map: "idx_production_order_materials_material")
  @@index([orderId], map: "idx_production_order_materials_order")
  @@map("production_order_materials")
}

model ProductionOrderOperation {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderId         String          @db.Uuid
  sequence        Int
  name            String          @db.VarChar(200)
  workCenter      String?         @db.VarChar(100)
  setupTime       Float           @default(0)
  runTime         Float           @default(0)
  actualSetupTime Float           @default(0)
  actualRunTime   Float           @default(0)
  plannedQty      Float
  completedQty    Float           @default(0)
  scrapQty        Float           @default(0)
  startedAt       DateTime?
  completedAt     DateTime?
  notes           String?
  createdAt       DateTime        @default(now())
  order           ProductionOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId], map: "idx_production_order_operations_orderId")
  @@map("production_order_operations")
}

model CostCenter {
  id                 String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code               String
  name               String
  description        String?
  parentId           String?                 @db.Uuid
  companyId          String?                 @db.Uuid
  isActive           Boolean                 @default(true)
  budget             Float?                  @default(0)
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @default(now()) @updatedAt
  accounts_payable   AccountsPayable[]
  receivables        AccountsReceivable[]
  budgetActuals      BudgetActual[]
  budgetAlerts       BudgetAlert[]
  budgetEntries      BudgetEntry[]
  company            Company?                @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "cost_centers_company_fkey")
  parent             CostCenter?             @relation("CostCenterHierarchy", fields: [parentId], references: [id], onUpdate: NoAction, map: "cost_centers_parent_fkey")
  children           CostCenter[]            @relation("CostCenterHierarchy")
  departments        Department[]
  payableAllocations PayableCostAllocation[]

  @@unique([code, companyId])
  @@index([companyId])
  @@index([parentId])
  @@map("cost_centers")
}

model BankAccount {
  id                                                                     String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                                                                   String
  name                                                                   String
  bankCode                                                               String?
  bankName                                                               String?
  agency                                                                 String?
  agencyDigit                                                            String?
  accountNumber                                                          String?
  accountDigit                                                           String?
  accountType                                                            BankAccountType      @default(CHECKING)
  companyId                                                              String?              @db.Uuid
  initialBalance                                                         Float                @default(0)
  currentBalance                                                         Float                @default(0)
  creditLimit                                                            Float?               @default(0)
  isActive                                                               Boolean              @default(true)
  isDefault                                                              Boolean              @default(false)
  notes                                                                  String?
  createdAt                                                              DateTime             @default(now())
  updatedAt                                                              DateTime             @default(now()) @updatedAt
  accounts_payable                                                       AccountsPayable[]
  receivables                                                            AccountsReceivable[]
  company                                                                Company?             @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "bank_accounts_company_fkey")
  transactions                                                           BankTransaction[]
  bank_transactions_bank_transactions_transferToAccountIdTobank_accounts BankTransaction[]    @relation("bank_transactions_transferToAccountIdTobank_accounts")
  exchange_contracts                                                     ExchangeContract[]
  pixTransactions                                                        PixTransaction[]
  receivablePayments                                                     ReceivablePayment[]

  @@unique([code, companyId])
  @@index([companyId], map: "idx_bank_accounts_companyId")
  @@map("bank_accounts")
}

model BankTransaction {
  id                                                                 String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  bankAccountId                                                      String              @db.Uuid
  transactionDate                                                    DateTime
  type                                                               BankTransactionType
  description                                                        String
  value                                                              Float
  balanceAfter                                                       Float
  documentNumber                                                     String?
  payableId                                                          String?             @db.Uuid
  receivableId                                                       String?             @db.Uuid
  transferToAccountId                                                String?             @db.Uuid
  reconciled                                                         Boolean             @default(false)
  reconciledAt                                                       DateTime?
  reconciledBy                                                       String?             @db.Uuid
  externalId                                                         String?
  notes                                                              String?
  createdBy                                                          String?             @db.Uuid
  createdAt                                                          DateTime            @default(now())
  bankAccount                                                        BankAccount         @relation(fields: [bankAccountId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "bank_transactions_account_fkey")
  payable                                                            AccountsPayable?    @relation(fields: [payableId], references: [id], onUpdate: NoAction, map: "bank_transactions_payable_fkey")
  receivable                                                         AccountsReceivable? @relation(fields: [receivableId], references: [id], onUpdate: NoAction, map: "bank_transactions_receivable_fkey")
  bank_accounts_bank_transactions_transferToAccountIdTobank_accounts BankAccount?        @relation("bank_transactions_transferToAccountIdTobank_accounts", fields: [transferToAccountId], references: [id], onUpdate: NoAction, map: "bank_transactions_transfer_fkey")
  receivablePayments                                                 ReceivablePayment[]

  @@index([payableId])
  @@index([receivableId])
  @@index([reconciled])
  @@index([bankAccountId], map: "idx_bank_transactions_bankAccountId")
  @@index([transferToAccountId], map: "idx_bank_transactions_transfer")
  @@map("bank_transactions")
}

model PixTransaction {
  id                String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  transactionId     String       @unique
  e2eId             String?
  type              String       @default("PAYMENT")
  status            String       @default("PENDING")
  pixKeyType        String
  pixKey            String
  value             Float
  fee               Float        @default(0)
  recipientName     String
  recipientDocument String?
  recipientBank     String?
  recipientAgency   String?
  recipientAccount  String?
  description       String?
  bankAccountId     String?      @db.Uuid
  payableId         String?      @db.Uuid
  scheduledAt       DateTime?
  completedAt       DateTime?
  cancelledAt       DateTime?
  errorCode         String?
  errorMessage      String?
  companyId         String?      @db.Uuid
  createdBy         String?      @db.Uuid
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @default(now()) @updatedAt
  bankAccount       BankAccount? @relation(fields: [bankAccountId], references: [id])
  company           Company?     @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@index([status])
  @@index([createdAt])
  @@index([pixKey])
  @@index([bankAccountId])
  @@map("pix_transactions")
}

model Customer {
  id                      String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                    String
  companyId               String?              @db.Uuid
  type                    String               @default("COMPANY")
  companyName             String
  tradeName               String?
  cnpj                    String?
  cpf                     String?
  stateRegistration       String?
  municipalRegistration   String?
  email                   String?
  phone                   String?
  mobile                  String?
  website                 String?
  contactName             String?
  addressStreet           String?
  addressNumber           String?
  addressComplement       String?
  addressNeighborhood     String?
  addressCity             String?
  addressState            String?
  addressZipCode          String?
  creditLimit             Float?               @default(0)
  paymentTermDays         Int?                 @default(30)
  status                  String               @default("ACTIVE")
  notes                   String?
  isShared                Boolean              @default(false)
  createdBy               String?              @db.Uuid
  createdAt               DateTime             @default(now())
  updatedAt               DateTime             @default(now()) @updatedAt
  customerGroupId         String?              @map("customer_group_id")
  customerTypeId          String?              @map("customer_type_id")
  alphaCode               String?              @map("alpha_code")
  salesRepId              String?              @map("sales_rep_id")
  externalSalesRepId      String?              @map("external_sales_rep_id")
  mainContactId           String?              @map("main_contact_id")
  lastVisitDate           DateTime?            @map("last_visit_date") @db.Timestamptz(6)
  relationshipStartDate   DateTime?            @map("relationship_start_date") @db.Timestamptz(6)
  visitFrequency          Int?                 @map("visit_frequency")
  generatePeriodicVisit   Boolean?             @default(false) @map("generate_periodic_visit")
  minInvoiceValue         Float?               @map("min_invoice_value")
  defaultMessage          String?              @map("default_message")
  defaultPaymentCondition String?              @map("default_payment_condition")
  applySt                 Boolean?             @default(false) @map("apply_st")
  defaultOrderNotes       String?              @map("default_order_notes")
  receivables             AccountsReceivable[]
  company                 Company?             @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "customers_company_fkey")
  issuedInvoices          IssuedInvoice[]
  leads                   Lead[]
  salesOrders             SalesOrder[]
  salesQuotes             SalesQuote[]

  @@unique([code, companyId])
  @@index([cnpj])
  @@index([status])
  @@index([companyId], map: "idx_customers_companyId")
  @@map("customers")
}

model AccountsReceivable {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code              Int
  companyId         String?             @db.Uuid
  customerId        String              @db.Uuid
  documentType      ReceivableType      @default(INVOICE)
  documentNumber    String?
  documentId        String?             @db.Uuid
  description       String
  dueDate           DateTime
  issueDate         DateTime            @default(now())
  originalValue     Float
  discountValue     Float               @default(0)
  interestValue     Float               @default(0)
  fineValue         Float               @default(0)
  paidValue         Float               @default(0)
  netValue          Float
  status            ReceivableStatus    @default(PENDING)
  paidAt            DateTime?
  installmentNumber Int                 @default(1)
  totalInstallments Int                 @default(1)
  categoryId        String?             @db.Uuid
  costCenterId      String?             @db.Uuid
  bankAccountId     String?             @db.Uuid
  boletoNumber      String?
  boletoBarcode     String?
  boletoUrl         String?
  pixCode           String?
  notes             String?
  createdBy         String?             @db.Uuid
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @default(now()) @updatedAt
  issuedInvoiceId   String?             @db.Uuid
  bankAccount       BankAccount?        @relation(fields: [bankAccountId], references: [id], onUpdate: NoAction, map: "accounts_receivable_bankaccount_fkey")
  company           Company?            @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "accounts_receivable_company_fkey")
  costCenter        CostCenter?         @relation(fields: [costCenterId], references: [id], onUpdate: NoAction, map: "accounts_receivable_costcenter_fkey")
  customer          Customer            @relation(fields: [customerId], references: [id], onUpdate: NoAction, map: "accounts_receivable_customer_fkey")
  issuedInvoice     IssuedInvoice?      @relation(fields: [issuedInvoiceId], references: [id])
  bankTransactions  BankTransaction[]
  collectionActions CollectionAction[]
  payments          ReceivablePayment[]

  @@unique([code, companyId])
  @@index([bankAccountId], map: "idx_accounts_receivable_bankaccount")
  @@index([companyId], map: "idx_accounts_receivable_companyId")
  @@index([costCenterId], map: "idx_accounts_receivable_costcenter")
  @@index([customerId], map: "idx_accounts_receivable_customerId")
  @@index([issuedInvoiceId], map: "idx_accounts_receivable_issuedinvoice")
  @@map("accounts_receivable")
}

model ReceivablePayment {
  id                String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  receivableId      String             @db.Uuid
  paymentDate       DateTime
  value             Float
  discountValue     Float              @default(0)
  interestValue     Float              @default(0)
  fineValue         Float              @default(0)
  paymentMethod     String?
  bankAccountId     String?            @db.Uuid
  bankTransactionId String?            @db.Uuid
  notes             String?
  createdBy         String?            @db.Uuid
  createdAt         DateTime           @default(now())
  bankAccount       BankAccount?       @relation(fields: [bankAccountId], references: [id], onUpdate: NoAction, map: "receivable_payments_bankaccount_fkey")
  receivable        AccountsReceivable @relation(fields: [receivableId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "receivable_payments_receivable_fkey")
  bankTransaction   BankTransaction?   @relation(fields: [bankTransactionId], references: [id], onUpdate: NoAction, map: "receivable_payments_transaction_fkey")

  @@index([receivableId])
  @@index([paymentDate])
  @@index([bankAccountId], map: "idx_receivable_payments_bank_account")
  @@index([bankTransactionId], map: "idx_receivable_payments_transaction")
  @@map("receivable_payments")
}

model PayableApproval {
  id         String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  payableId  String          @db.Uuid
  approverId String          @db.Uuid
  level      Int             @default(1)
  status     ApprovalStatus  @default(PENDING)
  approvedAt DateTime?
  comments   String?
  createdAt  DateTime        @default(now())
  approver   User            @relation(fields: [approverId], references: [id], onUpdate: NoAction, map: "payable_approvals_approver_fkey")
  payable    AccountsPayable @relation(fields: [payableId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "payable_approvals_payable_fkey")

  @@index([payableId])
  @@index([approverId])
  @@index([status])
  @@map("payable_approvals")
}

model PayableAttachment {
  id          String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  payableId   String          @db.Uuid
  fileName    String
  fileType    String
  fileSize    Int
  fileUrl     String
  description String?
  uploadedBy  String?         @db.Uuid
  createdAt   DateTime        @default(now())
  payable     AccountsPayable @relation(fields: [payableId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "payable_attachments_payable_fkey")

  @@index([payableId])
  @@map("payable_attachments")
}

model PayableCostAllocation {
  id           String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  payableId    String          @db.Uuid
  costCenterId String          @db.Uuid
  percentage   Float
  value        Float
  createdAt    DateTime        @default(now())
  costCenter   CostCenter      @relation(fields: [costCenterId], references: [id], onUpdate: NoAction, map: "payable_cost_allocations_costcenter_fkey")
  payable      AccountsPayable @relation(fields: [payableId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "payable_cost_allocations_payable_fkey")

  @@index([payableId])
  @@index([costCenterId])
  @@map("payable_cost_allocations")
}

model ApprovalThreshold {
  id                String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId         String?                     @db.Uuid
  name              String
  minValue          Float                       @default(0)
  maxValue          Float?
  requiredApprovers Int                         @default(1)
  isActive          Boolean                     @default(true)
  createdAt         DateTime                    @default(now())
  updatedAt         DateTime                    @default(now()) @updatedAt
  approvers         ApprovalThresholdApprover[]
  company           Company?                    @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "approval_thresholds_company_fkey")

  @@index([companyId])
  @@map("approval_thresholds")
}

model ApprovalThresholdApprover {
  id          String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  thresholdId String            @db.Uuid
  userId      String            @db.Uuid
  level       Int               @default(1)
  createdAt   DateTime          @default(now())
  threshold   ApprovalThreshold @relation(fields: [thresholdId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "approval_threshold_approvers_threshold_fkey")
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "approval_threshold_approvers_user_fkey")

  @@index([thresholdId])
  @@index([userId])
  @@map("approval_threshold_approvers")
}

model BomItem {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  parentMaterialId String   @db.Uuid
  childMaterialId  String   @db.Uuid
  quantity         Float
  unit             String   @default("UN")
  scrapPercentage  Float    @default(0)
  leadTimeDays     Int      @default(0)
  sequence         Int      @default(0)
  notes            String?
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @updatedAt
  childMaterial    Material @relation("BomChild", fields: [childMaterialId], references: [id], onUpdate: NoAction, map: "bom_items_child_fkey")
  parentMaterial   Material @relation("BomParent", fields: [parentMaterialId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "bom_items_parent_fkey")

  @@unique([parentMaterialId, childMaterialId], map: "bom_items_parent_child_key")
  @@index([parentMaterialId])
  @@index([childMaterialId])
  @@map("bom_items")
}

model MrpParameter {
  id                     String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  materialId             String   @unique @db.Uuid
  minLotSize             Float    @default(1)
  lotMultiple            Float    @default(1)
  safetyStock            Float    @default(0)
  productionLeadTimeDays Int      @default(1)
  purchaseLeadTimeDays   Int      @default(7)
  orderPolicy            String   @default("LOT_FOR_LOT")
  createdAt              DateTime @default(now())
  updatedAt              DateTime @default(now()) @updatedAt
  material               Material @relation(fields: [materialId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "mrp_parameters_material_fkey")

  @@index([materialId])
  @@index([materialId], map: "idx_mrp_parameters_material")
  @@map("mrp_parameters")
}

model MrpRun {
  id                    String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId             String?         @db.Uuid
  runDate               DateTime        @default(now())
  horizonDays           Int             @default(30)
  status                String          @default("RUNNING")
  totalSuggestions      Int             @default(0)
  productionSuggestions Int             @default(0)
  purchaseSuggestions   Int             @default(0)
  completedAt           DateTime?
  createdBy             String?         @db.Uuid
  notes                 String?
  company               Company?        @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "mrp_runs_company_fkey")
  suggestions           MrpSuggestion[]

  @@index([companyId])
  @@index([runDate])
  @@map("mrp_runs")
}

model MrpSuggestion {
  id               String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  runId            String              @db.Uuid
  materialId       String              @db.Uuid
  type             MrpSuggestionType
  status           MrpSuggestionStatus @default(PENDING)
  suggestedDate    DateTime
  requiredDate     DateTime
  quantity         Float
  sourceOrderId    String?             @db.Uuid
  sourceOrderType  String?
  reason           String?
  convertedOrderId String?             @db.Uuid
  convertedAt      DateTime?
  approvedBy       String?             @db.Uuid
  approvedAt       DateTime?
  rejectedBy       String?             @db.Uuid
  rejectedAt       DateTime?
  rejectionReason  String?
  createdAt        DateTime            @default(now())
  material         Material            @relation(fields: [materialId], references: [id], onUpdate: NoAction, map: "mrp_suggestions_material_fkey")
  run              MrpRun              @relation(fields: [runId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "mrp_suggestions_run_fkey")

  @@index([runId])
  @@index([materialId])
  @@index([status])
  @@index([type])
  @@index([materialId], map: "idx_mrp_suggestions_material")
  @@index([runId], map: "idx_mrp_suggestions_run")
  @@map("mrp_suggestions")
}

model WorkCenter {
  id               String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code             String
  name             String
  description      String?
  companyId        String?         @db.Uuid
  capacityPerHour  Float           @default(1)
  hoursPerDay      Float           @default(8)
  daysPerWeek      Int             @default(5)
  efficiencyTarget Float           @default(85)
  setupTimeMinutes Int             @default(0)
  costPerHour      Float           @default(0)
  isActive         Boolean         @default(true)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @default(now()) @updatedAt
  machineStops     MachineStop[]
  oeeTargets       OeeTarget[]
  productionLogs   ProductionLog[]
  company          Company?        @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "work_centers_company_fkey")

  @@unique([code, companyId])
  @@index([companyId], map: "idx_work_centers_companyId")
  @@map("work_centers")
}

model ProductionLog {
  id                    String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workCenterId          String           @db.Uuid
  productionOrderId     String?          @db.Uuid
  operatorId            String?          @db.Uuid
  shiftDate             DateTime         @db.Date
  shiftNumber           Int              @default(1)
  plannedQuantity       Float            @default(0)
  producedQuantity      Float            @default(0)
  goodQuantity          Float            @default(0)
  scrapQuantity         Float            @default(0)
  reworkQuantity        Float            @default(0)
  plannedTimeMinutes    Int              @default(0)
  actualTimeMinutes     Int              @default(0)
  setupTimeMinutes      Int              @default(0)
  runTimeMinutes        Int              @default(0)
  stopTimeMinutes       Int              @default(0)
  cycleTimeSeconds      Float?
  idealCycleTimeSeconds Float?
  notes                 String?
  createdBy             String?          @db.Uuid
  createdAt             DateTime         @default(now())
  machineStops          MachineStop[]
  productionOrder       ProductionOrder? @relation(fields: [productionOrderId], references: [id], onUpdate: NoAction, map: "production_logs_order_fkey")
  workCenter            WorkCenter       @relation(fields: [workCenterId], references: [id], onUpdate: NoAction, map: "production_logs_workcenter_fkey")

  @@index([workCenterId])
  @@index([shiftDate])
  @@index([productionOrderId])
  @@index([productionOrderId], map: "idx_production_logs_order")
  @@index([workCenterId], map: "idx_production_logs_workcenter")
  @@map("production_logs")
}

model MachineStop {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workCenterId    String         @db.Uuid
  productionLogId String?        @db.Uuid
  stopType        StopType
  startTime       DateTime
  endTime         DateTime?
  durationMinutes Int?
  reason          String
  solution        String?
  reportedBy      String?        @db.Uuid
  createdAt       DateTime       @default(now())
  productionLog   ProductionLog? @relation(fields: [productionLogId], references: [id], onUpdate: NoAction, map: "machine_stops_log_fkey")
  workCenter      WorkCenter     @relation(fields: [workCenterId], references: [id], onUpdate: NoAction, map: "machine_stops_workcenter_fkey")

  @@index([workCenterId])
  @@index([startTime])
  @@index([stopType])
  @@index([productionLogId], map: "idx_machine_stops_productionlog")
  @@index([workCenterId], map: "idx_machine_stops_workcenter")
  @@map("machine_stops")
}

model OeeTarget {
  id                 String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId          String?     @db.Uuid
  workCenterId       String?     @db.Uuid
  year               Int
  month              Int?
  availabilityTarget Float       @default(90)
  performanceTarget  Float       @default(95)
  qualityTarget      Float       @default(99)
  oeeTarget          Float       @default(85)
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @default(now()) @updatedAt
  company            Company?    @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "oee_targets_company_fkey")
  workCenter         WorkCenter? @relation(fields: [workCenterId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "oee_targets_workcenter_fkey")

  @@index([companyId])
  @@index([workCenterId])
  @@index([year, month])
  @@index([workCenterId], map: "idx_oee_targets_workcenter")
  @@map("oee_targets")
}

model Lead {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code              String
  companyId         String?        @db.Uuid
  customerId        String?        @db.Uuid
  companyName       String
  contactName       String?
  email             String?
  phone             String?
  source            LeadSource     @default(OTHER)
  status            LeadStatus     @default(NEW)
  estimatedValue    Float?
  probability       Int?           @default(50)
  expectedCloseDate DateTime?
  description       String?
  notes             String?
  assignedTo        String?        @db.Uuid
  lastContactAt     DateTime?
  wonAt             DateTime?
  lostAt            DateTime?
  lostReason        String?
  createdBy         String?        @db.Uuid
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @default(now()) @updatedAt
  activities        LeadActivity[]
  assignedUser      User?          @relation(fields: [assignedTo], references: [id], onUpdate: NoAction, map: "leads_assigned_fkey")
  company           Company?       @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "leads_company_fkey")
  customer          Customer?      @relation(fields: [customerId], references: [id], onUpdate: NoAction, map: "leads_customer_fkey")
  salesQuotes       SalesQuote[]

  @@unique([code, companyId])
  @@index([companyId])
  @@index([customerId])
  @@index([status])
  @@index([assignedTo])
  @@index([assignedTo], map: "idx_leads_assignedto")
  @@map("leads")
}

model LeadActivity {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  leadId      String    @db.Uuid
  type        String
  subject     String
  description String?
  scheduledAt DateTime?
  completedAt DateTime?
  createdBy   String?   @db.Uuid
  createdAt   DateTime  @default(now())
  lead        Lead      @relation(fields: [leadId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "lead_activities_lead_fkey")

  @@index([leadId])
  @@index([leadId], map: "idx_lead_activities_lead")
  @@map("lead_activities")
}

model SalesQuote {
  id                                              String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                                            Int
  companyId                                       String?          @db.Uuid
  customerId                                      String           @db.Uuid
  leadId                                          String?          @db.Uuid
  status                                          SalesQuoteStatus @default(DRAFT)
  issueDate                                       DateTime         @default(now())
  validUntil                                      DateTime?
  deliveryDays                                    Int?
  paymentTerms                                    String?
  shippingMethod                                  String?
  subtotal                                        Float            @default(0)
  discountPercent                                 Float            @default(0)
  discountValue                                   Float            @default(0)
  shippingValue                                   Float            @default(0)
  taxValue                                        Float            @default(0)
  totalValue                                      Float            @default(0)
  notes                                           String?
  internalNotes                                   String?
  sentAt                                          DateTime?
  viewedAt                                        DateTime?
  acceptedAt                                      DateTime?
  rejectedAt                                      DateTime?
  rejectionReason                                 String?
  convertedToOrderId                              String?          @db.Uuid
  createdBy                                       String?          @db.Uuid
  createdAt                                       DateTime         @default(now())
  updatedAt                                       DateTime         @default(now()) @updatedAt
  sales_orders_sales_orders_quoteIdTosales_quotes SalesOrder[]     @relation("sales_orders_quoteIdTosales_quotes")
  items                                           SalesQuoteItem[]
  company                                         Company?         @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "sales_quotes_company_fkey")
  customer                                        Customer         @relation(fields: [customerId], references: [id], onUpdate: NoAction, map: "sales_quotes_customer_fkey")
  lead                                            Lead?            @relation(fields: [leadId], references: [id], onUpdate: NoAction, map: "sales_quotes_lead_fkey")
  convertedToOrder                                SalesOrder?      @relation("QuoteToOrder", fields: [convertedToOrderId], references: [id], onUpdate: NoAction, map: "sales_quotes_order_fkey")

  @@unique([code, companyId])
  @@index([companyId])
  @@index([customerId])
  @@index([status])
  @@index([convertedToOrderId], map: "idx_sales_quotes_converted_order")
  @@index([leadId], map: "idx_sales_quotes_lead")
  @@map("sales_quotes")
}

model SalesQuoteItem {
  id              String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  quoteId         String     @db.Uuid
  materialId      String     @db.Uuid
  description     String?
  quantity        Float
  unit            String     @default("UN")
  unitPrice       Float
  discountPercent Float      @default(0)
  totalPrice      Float
  sequence        Int        @default(0)
  notes           String?
  createdAt       DateTime   @default(now())
  material        Material   @relation(fields: [materialId], references: [id], onUpdate: NoAction, map: "sales_quote_items_material_fkey")
  quote           SalesQuote @relation(fields: [quoteId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "sales_quote_items_quote_fkey")

  @@index([quoteId])
  @@index([materialId], map: "idx_sales_quote_items_material")
  @@map("sales_quote_items")
}

model SalesOrder {
  id                                              String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                                            Int
  companyId                                       String?          @db.Uuid
  customerId                                      String           @db.Uuid
  quoteId                                         String?          @db.Uuid
  status                                          SalesOrderStatus @default(PENDING)
  orderDate                                       DateTime         @default(now())
  deliveryDate                                    DateTime?
  shippedAt                                       DateTime?
  deliveredAt                                     DateTime?
  paymentTerms                                    String?
  shippingMethod                                  String?
  shippingAddress                                 String?
  subtotal                                        Float            @default(0)
  discountPercent                                 Float            @default(0)
  discountValue                                   Float            @default(0)
  shippingValue                                   Float            @default(0)
  taxValue                                        Float            @default(0)
  totalValue                                      Float            @default(0)
  notes                                           String?
  internalNotes                                   String?
  invoiceNumber                                   String?
  invoiceDate                                     DateTime?
  trackingCode                                    String?
  cancelledAt                                     DateTime?
  cancellationReason                              String?
  createdBy                                       String?          @db.Uuid
  createdAt                                       DateTime         @default(now())
  updatedAt                                       DateTime         @default(now()) @updatedAt
  issuedInvoices                                  IssuedInvoice[]  @relation("IssuedInvoiceOrder")
  items                                           SalesOrderItem[]
  company                                         Company?         @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "sales_orders_company_fkey")
  customer                                        Customer         @relation(fields: [customerId], references: [id], onUpdate: NoAction, map: "sales_orders_customer_fkey")
  sales_quotes_sales_orders_quoteIdTosales_quotes SalesQuote?      @relation("sales_orders_quoteIdTosales_quotes", fields: [quoteId], references: [id], onUpdate: NoAction, map: "sales_orders_quote_fkey")
  sourceQuote                                     SalesQuote[]     @relation("QuoteToOrder")

  @@unique([code, companyId])
  @@index([companyId])
  @@index([customerId])
  @@index([status])
  @@index([quoteId], map: "idx_sales_orders_quote")
  @@map("sales_orders")
}

model SalesOrderItem {
  id                String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderId           String           @db.Uuid
  materialId        String           @db.Uuid
  description       String?
  quantity          Float
  deliveredQty      Float            @default(0)
  unit              String           @default("UN")
  unitPrice         Float
  discountPercent   Float            @default(0)
  totalPrice        Float
  sequence          Int              @default(0)
  productionOrderId String?          @db.Uuid
  notes             String?
  createdAt         DateTime         @default(now())
  material          Material         @relation(fields: [materialId], references: [id], onUpdate: NoAction, map: "sales_order_items_material_fkey")
  order             SalesOrder       @relation(fields: [orderId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "sales_order_items_order_fkey")
  productionOrder   ProductionOrder? @relation(fields: [productionOrderId], references: [id], onUpdate: NoAction, map: "sales_order_items_production_fkey")

  @@index([orderId])
  @@index([materialId], map: "idx_sales_order_items_material")
  @@index([productionOrderId], map: "idx_sales_order_items_production")
  @@map("sales_order_items")
}

model StockLocation {
  id                  String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                String
  name                String
  description         String?
  type                LocationType            @default(WAREHOUSE)
  parentId            String?                 @db.Uuid
  companyId           String?                 @db.Uuid
  address             String?
  isActive            Boolean                 @default(true)
  isDefault           Boolean                 @default(false)
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @default(now()) @updatedAt
  inventoryCounts     InventoryCount[]
  locationInventory   LocationInventory[]
  receivingItems      MaterialReceivingItem[]
  materialReceivings  MaterialReceiving[]
  physicalInventories PhysicalInventory[]
  pickingListItems    PickingListItem[]
  company             Company?                @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "stock_locations_company_fkey")
  parent              StockLocation?          @relation("LocationHierarchy", fields: [parentId], references: [id], onUpdate: NoAction, map: "stock_locations_parent_fkey")
  children            StockLocation[]         @relation("LocationHierarchy")
  transfersFrom       StockTransfer[]         @relation("TransferFrom")
  transfersTo         StockTransfer[]         @relation("TransferTo")
  supplierReturnItems SupplierReturnItem[]

  @@unique([code, companyId])
  @@index([companyId])
  @@index([type])
  @@index([parentId], map: "idx_stock_locations_parent")
  @@map("stock_locations")
}

model LocationInventory {
  id             String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  locationId     String        @db.Uuid
  materialId     String        @db.Uuid
  quantity       Float         @default(0)
  reservedQty    Float         @default(0)
  minQuantity    Float         @default(0)
  maxQuantity    Float?
  lastMovementAt DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @default(now()) @updatedAt
  location       StockLocation @relation(fields: [locationId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "location_inventory_location_fkey")
  material       Material      @relation(fields: [materialId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "location_inventory_material_fkey")

  @@unique([locationId, materialId], map: "location_inventory_location_material_key")
  @@index([locationId])
  @@index([materialId])
  @@index([locationId], map: "idx_location_inventory_location")
  @@index([materialId], map: "idx_location_inventory_material")
  @@map("location_inventory")
}

model StockTransfer {
  id                 String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code               Int
  companyId          String?             @db.Uuid
  fromLocationId     String              @db.Uuid
  toLocationId       String              @db.Uuid
  status             TransferStatus      @default(PENDING)
  requestedAt        DateTime            @default(now())
  requestedBy        String?             @db.Uuid
  approvedAt         DateTime?
  approvedBy         String?             @db.Uuid
  shippedAt          DateTime?
  shippedBy          String?             @db.Uuid
  receivedAt         DateTime?
  receivedBy         String?             @db.Uuid
  cancelledAt        DateTime?
  cancelledBy        String?             @db.Uuid
  cancellationReason String?
  notes              String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @default(now()) @updatedAt
  items              StockTransferItem[]
  approvedByUser     User?               @relation("TransferApproved", fields: [approvedBy], references: [id], onUpdate: NoAction)
  company            Company?            @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "stock_transfers_company_fkey")
  fromLocation       StockLocation       @relation("TransferFrom", fields: [fromLocationId], references: [id], onUpdate: NoAction, map: "stock_transfers_from_fkey")
  receivedByUser     User?               @relation("TransferReceived", fields: [receivedBy], references: [id], onUpdate: NoAction)
  requestedByUser    User?               @relation("TransferRequested", fields: [requestedBy], references: [id], onUpdate: NoAction)
  shippedByUser      User?               @relation("TransferShipped", fields: [shippedBy], references: [id], onUpdate: NoAction)
  toLocation         StockLocation       @relation("TransferTo", fields: [toLocationId], references: [id], onUpdate: NoAction, map: "stock_transfers_to_fkey")

  @@unique([code, companyId])
  @@index([companyId])
  @@index([status])
  @@index([fromLocationId])
  @@index([toLocationId])
  @@index([approvedBy], map: "idx_stock_transfers_approved_by")
  @@index([fromLocationId], map: "idx_stock_transfers_from_location")
  @@index([receivedBy], map: "idx_stock_transfers_received_by")
  @@index([requestedBy], map: "idx_stock_transfers_requested_by")
  @@index([shippedBy], map: "idx_stock_transfers_shipped_by")
  @@index([toLocationId], map: "idx_stock_transfers_to_location")
  @@map("stock_transfers")
}

model StockTransferItem {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  transferId   String        @db.Uuid
  materialId   String        @db.Uuid
  requestedQty Float
  shippedQty   Float         @default(0)
  receivedQty  Float         @default(0)
  unit         String        @default("UN")
  notes        String?
  createdAt    DateTime      @default(now())
  material     Material      @relation(fields: [materialId], references: [id], onUpdate: NoAction, map: "stock_transfer_items_material_fkey")
  transfer     StockTransfer @relation(fields: [transferId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "stock_transfer_items_transfer_fkey")

  @@index([transferId])
  @@index([materialId], map: "idx_stock_transfer_items_material")
  @@map("stock_transfer_items")
}

model RequisitionApproval {
  id            String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  requisitionId String              @db.Uuid
  level         Int                 @default(1)
  approverId    String              @db.Uuid
  status        ApprovalStatus      @default(PENDING)
  approvedAt    DateTime?
  rejectedAt    DateTime?
  comments      String?
  createdAt     DateTime            @default(now())
  approver      User                @relation(fields: [approverId], references: [id], onUpdate: NoAction, map: "requisition_approvals_approver_fkey")
  requisition   MaterialRequisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "requisition_approvals_requisition_fkey")

  @@index([requisitionId])
  @@index([approverId])
  @@index([status])
  @@map("requisition_approvals")
}

model PhysicalInventory {
  id          String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code        Int
  companyId   String?          @db.Uuid
  locationId  String?          @db.Uuid
  name        String
  description String?
  startDate   DateTime
  endDate     DateTime?
  status      String           @default("OPEN")
  createdBy   String?          @db.Uuid
  closedBy    String?          @db.Uuid
  closedAt    DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @default(now()) @updatedAt
  counts      InventoryCount[]
  company     Company?         @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "physical_inventories_company_fkey")
  location    StockLocation?   @relation(fields: [locationId], references: [id], onUpdate: NoAction, map: "physical_inventories_location_fkey")

  @@unique([code, companyId])
  @@index([companyId])
  @@index([status])
  @@index([locationId], map: "idx_physical_inventories_location")
  @@map("physical_inventories")
}

model InventoryCount {
  id          String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  inventoryId String            @db.Uuid
  materialId  String            @db.Uuid
  locationId  String?           @db.Uuid
  systemQty   Float             @default(0)
  countedQty  Float?
  difference  Float?
  countedBy   String?           @db.Uuid
  countedAt   DateTime?
  verified    Boolean           @default(false)
  verifiedBy  String?           @db.Uuid
  verifiedAt  DateTime?
  notes       String?
  createdAt   DateTime          @default(now())
  inventory   PhysicalInventory @relation(fields: [inventoryId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "inventory_counts_inventory_fkey")
  location    StockLocation?    @relation(fields: [locationId], references: [id], onUpdate: NoAction, map: "inventory_counts_location_fkey")
  material    Material          @relation(fields: [materialId], references: [id], onUpdate: NoAction, map: "inventory_counts_material_fkey")

  @@index([inventoryId])
  @@index([materialId])
  @@index([locationId], map: "idx_inventory_counts_location")
  @@map("inventory_counts")
}

model Department {
  id             String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code           String
  name           String
  description    String?
  managerId      String?         @db.Uuid
  parentId       String?         @db.Uuid
  companyId      String?         @db.Uuid
  costCenterId   String?         @db.Uuid
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @default(now()) @updatedAt
  company        Company?        @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "departments_company_fkey")
  costCenter     CostCenter?     @relation(fields: [costCenterId], references: [id], onUpdate: NoAction, map: "departments_costCenter_fkey")
  parent         Department?     @relation("DepartmentHierarchy", fields: [parentId], references: [id], onUpdate: NoAction, map: "departments_parent_fkey")
  children       Department[]    @relation("DepartmentHierarchy")
  employees      Employee[]
  positions      JobPosition[]
  notifications  Notification[]
  strategicGoals StrategicGoal[]
  tasks          Task[]          @relation("TaskTargetDepartment")

  @@unique([code, companyId])
  @@index([companyId], map: "idx_departments_companyId")
  @@index([costCenterId], map: "idx_departments_costcenter")
  @@index([parentId], map: "idx_departments_parent")
  @@map("departments")
}

model JobPosition {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code         String
  name         String
  description  String?
  departmentId String?     @db.Uuid
  companyId    String?     @db.Uuid
  baseSalary   Float?
  level        Int?        @default(1)
  isActive     Boolean     @default(true)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @default(now()) @updatedAt
  employees    Employee[]
  company      Company?    @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "job_positions_company_fkey")
  department   Department? @relation(fields: [departmentId], references: [id], onUpdate: NoAction, map: "job_positions_department_fkey")

  @@unique([code, companyId])
  @@index([companyId], map: "idx_job_positions_companyId")
  @@index([departmentId], map: "idx_job_positions_department")
  @@index([departmentId], map: "idx_job_positions_departmentId")
  @@map("job_positions")
}

model Employee {
  id                  String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                Int
  companyId           String?            @db.Uuid
  userId              String?            @db.Uuid
  name                String
  cpf                 String?
  rg                  String?
  birthDate           DateTime?          @db.Date
  gender              String?
  maritalStatus       String?
  email               String?
  phone               String?
  mobile              String?
  address             String?
  addressNumber       String?
  addressComplement   String?
  addressNeighborhood String?
  addressCity         String?
  addressState        String?
  addressZipCode      String?
  departmentId        String?            @db.Uuid
  positionId          String?            @db.Uuid
  managerId           String?            @db.Uuid
  contractType        ContractType       @default(CLT)
  status              EmployeeStatus     @default(ACTIVE)
  hireDate            DateTime           @db.Date
  terminationDate     DateTime?          @db.Date
  salary              Float              @default(0)
  workHoursPerDay     Float              @default(8)
  workDaysPerWeek     Int                @default(5)
  bankName            String?
  bankBranch          String?
  bankAccount         String?
  bankAccountType     String?
  pixKey              String?
  pis                 String?
  ctps                String?
  voterRegistration   String?
  militaryService     String?
  notes               String?
  photo               String?
  createdBy           String?            @db.Uuid
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @default(now()) @updatedAt
  insalubrityDegree   String?            @map("insalubrity_degree")
  hasDangerousness    Boolean?           @default(false) @map("has_dangerousness")
  dependentsCount     Int?               @default(0) @map("dependents_count")
  bankCode            String?            @map("bank_code")
  bankAgency          String?            @map("bank_agency")
  bankAccountDigit    String?            @map("bank_account_digit")
  employee_benefits   EmployeeBenefit[]
  employee_trainings  EmployeeTraining[]
  company             Company?           @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "employees_company_fkey")
  department          Department?        @relation(fields: [departmentId], references: [id], onUpdate: NoAction, map: "employees_department_fkey")
  manager             Employee?          @relation("EmployeeManager", fields: [managerId], references: [id], onUpdate: NoAction, map: "employees_manager_fkey")
  subordinates        Employee[]         @relation("EmployeeManager")
  position            JobPosition?       @relation(fields: [positionId], references: [id], onUpdate: NoAction, map: "employees_position_fkey")
  user                User?              @relation(fields: [userId], references: [id], onUpdate: NoAction, map: "employees_user_fkey")
  payrollItems        PayrollItem[]
  skill_matrix        SkillMatrix[]
  terminations        Termination[]
  thirteenthSalaries  ThirteenthSalary[]
  timeClockEntries    TimeClockEntry[]
  timesheetDays       TimesheetDay[]
  transport_vouchers  TransportVoucher[]
  vacations           Vacation[]

  @@unique([code, companyId])
  @@index([companyId], map: "idx_employees_companyId")
  @@index([departmentId], map: "idx_employees_departmentId")
  @@index([managerId], map: "idx_employees_manager")
  @@index([positionId], map: "idx_employees_position")
  @@index([userId], map: "idx_employees_user")
  @@map("employees")
}

model TimeClockEntry {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employeeId    String        @db.Uuid
  type          TimeClockType
  timestamp     DateTime
  location      String?
  latitude      Float?
  longitude     Float?
  deviceId      String?
  ipAddress     String?
  isManual      Boolean       @default(false)
  justification String?
  approvedBy    String?       @db.Uuid
  approvedAt    DateTime?
  createdAt     DateTime      @default(now())
  users         User?         @relation(fields: [approvedBy], references: [id], onUpdate: NoAction)
  employee      Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "time_clock_entries_employee_fkey")

  @@index([employeeId])
  @@index([timestamp])
  @@index([approvedBy], map: "idx_time_clock_entries_approved_by")
  @@index([employeeId], map: "idx_time_clock_entries_employee")
  @@map("time_clock_entries")
}

model TimesheetDay {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employeeId     String    @db.Uuid
  date           DateTime  @db.Date
  scheduledHours Float     @default(8)
  workedHours    Float     @default(0)
  overtimeHours  Float     @default(0)
  nightHours     Float     @default(0)
  absenceHours   Float     @default(0)
  isHoliday      Boolean   @default(false)
  isWeekend      Boolean   @default(false)
  status         String    @default("PENDING")
  notes          String?
  approvedBy     String?   @db.Uuid
  approvedAt     DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @default(now()) @updatedAt
  overtime50     Float?    @default(0) @map("overtime_50")
  overtime100    Float?    @default(0) @map("overtime_100")
  employee       Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "timesheet_days_employee_fkey")

  @@unique([employeeId, date], map: "timesheet_days_employee_date_key")
  @@index([employeeId])
  @@index([date])
  @@index([employeeId], map: "idx_timesheet_days_employee")
  @@map("timesheet_days")
}

model WorkSchedule {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId        String?            @db.Uuid
  name             String
  code             String?
  type             WorkScheduleType   @default(FIXED)
  description      String?
  weeklyHours      Float              @default(44)
  dailyHours       Float              @default(8)
  toleranceMinutes Int                @default(10)
  isActive         Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @default(now()) @updatedAt
  employees        EmployeeSchedule[]
  company          Company?           @relation(fields: [companyId], references: [id])
  shifts           WorkShift[]

  @@unique([companyId, code])
  @@index([companyId], map: "idx_work_schedules_companyId")
  @@map("work_schedules")
}

model WorkShift {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  scheduleId     String       @db.Uuid
  dayOfWeek      Int
  startTime      String
  endTime        String
  breakStartTime String?
  breakEndTime   String?
  breakDuration  Int          @default(60)
  isWorkDay      Boolean      @default(true)
  schedule       WorkSchedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@unique([scheduleId, dayOfWeek])
  @@map("work_shifts")
}

model EmployeeSchedule {
  id         String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employeeId String       @db.Uuid
  scheduleId String       @db.Uuid
  startDate  DateTime     @db.Date
  endDate    DateTime?    @db.Date
  isActive   Boolean      @default(true)
  createdAt  DateTime     @default(now())
  schedule   WorkSchedule @relation(fields: [scheduleId], references: [id])

  @@index([scheduleId], map: "idx_employee_schedules_scheduleId")
  @@map("employee_schedules")
}

model HoursBank {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId   String?       @db.Uuid
  employeeId  String        @db.Uuid
  type        HoursBankType
  date        DateTime      @db.Date
  hours       Float
  balance     Float
  referenceId String?       @db.Uuid
  description String?
  expiresAt   DateTime?     @db.Date
  approvedBy  String?       @db.Uuid
  approvedAt  DateTime?
  createdAt   DateTime      @default(now())

  @@index([companyId], map: "idx_hours_bank_companyId")
  @@index([employeeId], map: "idx_hours_bank_employeeId")
  @@map("hours_bank")
}

model TimeClockAdjustment {
  id              String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId       String?                   @db.Uuid
  employeeId      String                    @db.Uuid
  date            DateTime                  @db.Date
  originalEntryId String?                   @db.Uuid
  adjustmentType  String
  clockType       TimeClockType
  originalTime    DateTime?
  newTime         DateTime?
  reason          String
  status          TimeClockAdjustmentStatus @default(PENDING)
  requestedBy     String?                   @db.Uuid
  requestedAt     DateTime                  @default(now())
  reviewedBy      String?                   @db.Uuid
  reviewedAt      DateTime?
  reviewNotes     String?

  @@index([companyId], map: "idx_time_clock_adjustments_companyId")
  @@index([employeeId], map: "idx_time_clock_adjustments_employeeId")
  @@map("time_clock_adjustments")
}

model Holiday {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId  String?  @db.Uuid
  date       DateTime @db.Date
  name       String
  type       String   @default("NATIONAL")
  isOptional Boolean  @default(false)
  createdAt  DateTime @default(now())
  company    Company? @relation(fields: [companyId], references: [id])

  @@unique([companyId, date])
  @@index([companyId], map: "idx_holidays_companyId")
  @@map("holidays")
}

model Payroll {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code            Int
  companyId       String?       @db.Uuid
  referenceMonth  Int
  referenceYear   Int
  status          String        @default("DRAFT")
  totalGross      Float         @default(0)
  totalDeductions Float         @default(0)
  totalNet        Float         @default(0)
  employeeCount   Int           @default(0)
  processedAt     DateTime?
  processedBy     String?       @db.Uuid
  approvedAt      DateTime?
  approvedBy      String?       @db.Uuid
  paidAt          DateTime?
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @default(now()) @updatedAt
  items           PayrollItem[]
  company         Company?      @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "payrolls_company_fkey")

  @@unique([code, companyId])
  @@unique([companyId, referenceMonth, referenceYear], map: "payrolls_company_month_year_key")
  @@index([companyId])
  @@map("payrolls")
}

model PayrollItem {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  payrollId       String         @db.Uuid
  employeeId      String         @db.Uuid
  baseSalary      Float          @default(0)
  workedDays      Int            @default(0)
  workedHours     Float          @default(0)
  overtimeHours   Float          @default(0)
  nightHours      Float          @default(0)
  absenceDays     Int            @default(0)
  grossSalary     Float          @default(0)
  totalDeductions Float          @default(0)
  netSalary       Float          @default(0)
  inss            Float          @default(0)
  irrf            Float          @default(0)
  fgts            Float          @default(0)
  notes           String?
  createdAt       DateTime       @default(now())
  events          PayrollEvent[]
  employee        Employee       @relation(fields: [employeeId], references: [id], onUpdate: NoAction, map: "payroll_items_employee_fkey")
  payroll         Payroll        @relation(fields: [payrollId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "payroll_items_payroll_fkey")

  @@unique([payrollId, employeeId], map: "payroll_items_payroll_employee_key")
  @@index([payrollId])
  @@index([employeeId], map: "idx_payroll_items_employeeId")
  @@map("payroll_items")
}

model PayrollEvent {
  id            String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  payrollItemId String           @db.Uuid
  type          PayrollEventType
  code          String
  description   String
  reference     Float?
  value         Float
  isDeduction   Boolean          @default(false)
  createdAt     DateTime         @default(now())
  payrollItem   PayrollItem      @relation(fields: [payrollItemId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "payroll_events_item_fkey")

  @@index([payrollItemId])
  @@map("payroll_events")
}

model Vacation {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId         String?         @db.Uuid
  employeeId        String          @db.Uuid
  acquisitionStart  DateTime        @db.Date
  acquisitionEnd    DateTime        @db.Date
  startDate         DateTime        @db.Date
  endDate           DateTime        @db.Date
  totalDays         Int?            @default(30)
  soldDays          Int?            @default(0)
  enjoyedDays       Int?            @default(30)
  status            VacationStatus? @default(SCHEDULED)
  baseSalary        Float?          @default(0)
  vacationPay       Float?          @default(0)
  oneThirdBonus     Float?          @default(0)
  soldDaysValue     Float?          @default(0)
  totalGross        Float?          @default(0)
  inssDeduction     Float?          @default(0)
  irrfDeduction     Float?          @default(0)
  otherDeductions   Float?          @default(0)
  totalNet          Float?          @default(0)
  paymentDate       DateTime?       @db.Date
  noticeDate        DateTime?       @db.Date
  isCollective      Boolean?        @default(false)
  collectiveGroupId String?         @db.Uuid
  notes             String?
  approvedBy        String?         @db.Uuid
  approvedAt        DateTime?
  createdBy         String?         @db.Uuid
  createdAt         DateTime?       @default(now())
  updatedAt         DateTime?       @default(now()) @updatedAt
  company           Company?        @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employee          Employee        @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([startDate])
  @@index([companyId], map: "idx_vacations_companyId")
  @@index([employeeId], map: "idx_vacations_employeeId")
  @@map("vacations")
}

model ThirteenthSalary {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId       String?           @db.Uuid
  employeeId      String            @db.Uuid
  year            Int
  type            ThirteenthType
  status          ThirteenthStatus? @default(PENDING)
  monthsWorked    Int?              @default(12)
  baseSalary      Float?            @default(0)
  averageVariable Float?            @default(0)
  grossValue      Float?            @default(0)
  inssDeduction   Float?            @default(0)
  irrfDeduction   Float?            @default(0)
  otherDeductions Float?            @default(0)
  netValue        Float?            @default(0)
  paymentDate     DateTime?         @db.Date
  notes           String?
  createdBy       String?           @db.Uuid
  createdAt       DateTime?         @default(now())
  updatedAt       DateTime?         @default(now()) @updatedAt
  company         Company?          @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employee        Employee          @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([employeeId, year, type])
  @@index([companyId], map: "idx_thirteenth_salaries_companyId")
  @@index([employeeId], map: "idx_thirteenth_salaries_employeeId")
  @@map("thirteenth_salaries")
}

model Termination {
  id                      String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId               String?            @db.Uuid
  employeeId              String             @db.Uuid
  type                    TerminationType
  status                  TerminationStatus? @default(DRAFT)
  noticeDate              DateTime?          @db.Date
  terminationDate         DateTime           @db.Date
  lastWorkDay             DateTime?          @db.Date
  noticePeriodDays        Int?               @default(30)
  noticePeriodWorked      Boolean?           @default(false)
  noticePeriodIndemnity   Boolean?           @default(false)
  baseSalary              Float?             @default(0)
  salaryBalance           Float?             @default(0)
  noticePeriodValue       Float?             @default(0)
  vacationBalance         Float?             @default(0)
  vacationProportional    Float?             @default(0)
  vacationOneThird        Float?             @default(0)
  thirteenthProportional  Float?             @default(0)
  fgtsBalance             Float?             @default(0)
  fgtsFine                Float?             @default(0)
  otherEarnings           Float?             @default(0)
  totalGross              Float?             @default(0)
  inssDeduction           Float?             @default(0)
  irrfDeduction           Float?             @default(0)
  advanceDeduction        Float?             @default(0)
  otherDeductions         Float?             @default(0)
  totalDeductions         Float?             @default(0)
  totalNet                Float?             @default(0)
  paymentDate             DateTime?          @db.Date
  homologationDate        DateTime?          @db.Date
  trctNumber              String?            @db.VarChar(50)
  grffGenerated           Boolean?           @default(false)
  grffDate                DateTime?          @db.Date
  eligibleForUnemployment Boolean?           @default(false)
  unemploymentGuides      Int?               @default(0)
  notes                   String?
  reason                  String?
  approvedBy              String?            @db.Uuid
  approvedAt              DateTime?
  createdBy               String?            @db.Uuid
  createdAt               DateTime?          @default(now())
  updatedAt               DateTime?          @default(now()) @updatedAt
  company                 Company?           @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employee                Employee           @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([companyId], map: "idx_terminations_companyId")
  @@index([employeeId], map: "idx_terminations_employeeId")
  @@map("terminations")
}

model MaterialReceiving {
  id              String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code            Int
  companyId       String?                 @db.Uuid
  supplierId      String                  @db.Uuid
  purchaseOrderId String?                 @db.Uuid
  invoiceId       String?                 @db.Uuid
  status          ReceivingStatus         @default(PENDING)
  receivingDate   DateTime                @default(now())
  expectedDate    DateTime?
  nfeNumber       String?
  nfeSeries       String?
  nfeKey          String?
  nfeXml          String?
  nfeIssueDate    DateTime?
  totalValue      Float                   @default(0)
  freightValue    Float                   @default(0)
  insuranceValue  Float                   @default(0)
  discountValue   Float                   @default(0)
  otherExpenses   Float                   @default(0)
  locationId      String?                 @db.Uuid
  notes           String?
  internalNotes   String?
  conferredBy     String?                 @db.Uuid
  conferredAt     DateTime?
  approvedBy      String?                 @db.Uuid
  approvedAt      DateTime?
  rejectedBy      String?                 @db.Uuid
  rejectedAt      DateTime?
  rejectionReason String?
  createdBy       String?                 @db.Uuid
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @default(now()) @updatedAt
  items           MaterialReceivingItem[]
  company         Company?                @relation(fields: [companyId], references: [id], onUpdate: NoAction, map: "material_receivings_company_fkey")
  invoice         ReceivedInvoice?        @relation(fields: [invoiceId], references: [id], onUpdate: NoAction, map: "material_receivings_invoice_fkey")
  location        StockLocation?          @relation(fields: [locationId], references: [id], onUpdate: NoAction, map: "material_receivings_location_fkey")
  purchaseOrder   PurchaseOrder?          @relation(fields: [purchaseOrderId], references: [id], onUpdate: NoAction, map: "material_receivings_po_fkey")
  supplier        Supplier                @relation(fields: [supplierId], references: [id], onUpdate: NoAction, map: "material_receivings_supplier_fkey")

  @@unique([code, companyId])
  @@index([supplierId])
  @@index([status])
  @@index([receivingDate])
  @@index([companyId], map: "idx_material_receivings_companyId")
  @@index([invoiceId], map: "idx_material_receivings_invoice")
  @@index([locationId], map: "idx_material_receivings_location")
  @@index([purchaseOrderId], map: "idx_material_receivings_purchaseorder")
  @@index([supplierId], map: "idx_material_receivings_supplier")
  @@map("material_receivings")
}

model MaterialReceivingItem {
  id                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  receivingId         String                @db.Uuid
  materialId          String                @db.Uuid
  purchaseOrderItemId String?               @db.Uuid
  nfeItemNumber       Int?
  description         String?
  unit                String                @default("UN")
  nfeQuantity         Float
  receivedQuantity    Float                 @default(0)
  approvedQuantity    Float                 @default(0)
  rejectedQuantity    Float                 @default(0)
  unitPrice           Float
  totalPrice          Float
  icmsBase            Float                 @default(0)
  icmsValue           Float                 @default(0)
  ipiBase             Float                 @default(0)
  ipiValue            Float                 @default(0)
  status              ReceivingItemStatus   @default(PENDING)
  rejectionReason     String?
  batchNumber         String?
  expirationDate      DateTime?
  certificateNumber   String?
  qualityStatus       String?
  qualityNotes        String?
  locationId          String?               @db.Uuid
  conferredBy         String?               @db.Uuid
  conferredAt         DateTime?
  notes               String?
  createdAt           DateTime              @default(now())
  location            StockLocation?        @relation(fields: [locationId], references: [id], onUpdate: NoAction, map: "material_receiving_items_location_fkey")
  material            Material              @relation(fields: [materialId], references: [id], onUpdate: NoAction, map: "material_receiving_items_material_fkey")
  purchaseOrderItem   PurchaseOrderItem?    @relation(fields: [purchaseOrderItemId], references: [id], onUpdate: NoAction, map: "material_receiving_items_poItem_fkey")
  receiving           MaterialReceiving     @relation(fields: [receivingId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "material_receiving_items_receiving_fkey")
  certificates        QualityCertificate[]
  divergences         ReceivingDivergence[]

  @@index([receivingId])
  @@index([materialId])
  @@index([status])
  @@index([locationId], map: "idx_material_receiving_items_location")
  @@index([materialId], map: "idx_material_receiving_items_material")
  @@index([purchaseOrderItemId], map: "idx_material_receiving_items_purchaseorderitem")
  @@index([receivingId], map: "idx_material_receiving_items_receiving")
  @@map("material_receiving_items")
}

model ReceivingDivergence {
  id              String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  receivingItemId String                @db.Uuid
  type            String
  expectedValue   String?
  receivedValue   String?
  description     String
  resolution      String?
  resolvedBy      String?               @db.Uuid
  resolvedAt      DateTime?
  createdAt       DateTime              @default(now())
  receivingItem   MaterialReceivingItem @relation(fields: [receivingItemId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "receiving_divergences_item_fkey")

  @@index([receivingItemId])
  @@map("receiving_divergences")
}

model QualityCertificate {
  id                String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  receivingItemId   String                @db.Uuid
  certificateNumber String
  issueDate         DateTime?
  expirationDate    DateTime?
  issuer            String?
  fileUrl           String?
  notes             String?
  createdAt         DateTime              @default(now())
  receivingItem     MaterialReceivingItem @relation(fields: [receivingItemId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "quality_certificates_item_fkey")

  @@index([receivingItemId])
  @@map("quality_certificates")
}

model Tutorial {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  slug        String    @unique @db.VarChar(100)
  title       String    @db.VarChar(255)
  description String?
  content     String
  module      String?   @db.VarChar(50)
  category    String?   @db.VarChar(50)
  icon        String?   @db.VarChar(50)
  orderIndex  Int?      @default(0) @map("order_index")
  isPublished Boolean?  @default(true) @map("is_published")
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  createdBy   String?   @map("created_by") @db.Uuid
  creator     User?     @relation(fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([category], map: "idx_tutorials_category")
  @@index([createdBy], map: "idx_tutorials_created_by")
  @@index([module], map: "idx_tutorials_module")
  @@index([slug], map: "idx_tutorials_slug")
  @@map("tutorials")
}

model Notification {
  id                                         String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId                                     String?            @map("user_id") @db.Uuid
  companyId                                  String?            @map("company_id") @db.Uuid
  type                                       String             @db.VarChar(50)
  category                                   String             @db.VarChar(50)
  title                                      String             @db.VarChar(255)
  message                                    String?
  link                                       String?            @db.VarChar(500)
  metadata                                   Json?              @default("{}")
  isRead                                     Boolean?           @default(false) @map("is_read")
  readAt                                     DateTime?          @map("read_at") @db.Timestamptz(6)
  createdAt                                  DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  departmentId                               String?            @map("department_id") @db.Uuid
  groupId                                    String?            @map("group_id") @db.Uuid
  targetPermission                           String?            @map("target_permission") @db.VarChar(100)
  isTask                                     Boolean?           @default(false) @map("is_task")
  taskId                                     String?            @map("task_id") @db.Uuid
  company                                    Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  department                                 Department?        @relation(fields: [departmentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  group                                      NotificationGroup? @relation(fields: [groupId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  task                                       Task?              @relation(fields: [taskId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user                                       User?              @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tasks_tasks_notification_idTonotifications Task[]             @relation("tasks_notification_idTonotifications")

  @@index([category], map: "idx_notifications_category")
  @@index([companyId], map: "idx_notifications_company_id")
  @@index([createdAt(sort: Desc)], map: "idx_notifications_created_at")
  @@index([departmentId], map: "idx_notifications_department")
  @@index([groupId], map: "idx_notifications_group")
  @@index([isRead], map: "idx_notifications_is_read")
  @@index([taskId], map: "idx_notifications_task")
  @@index([type], map: "idx_notifications_type")
  @@index([userId], map: "idx_notifications_user_id")
  @@map("notifications")
}

model NotificationPreference {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId       String    @map("user_id") @db.Uuid
  category     String    @db.VarChar(50)
  emailEnabled Boolean?  @default(true) @map("email_enabled")
  pushEnabled  Boolean?  @default(true) @map("push_enabled")
  inAppEnabled Boolean?  @default(true) @map("in_app_enabled")
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userId, category])
  @@index([userId], map: "idx_notification_preferences_user")
  @@map("notification_preferences")
}

model SystemLog {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  level      String    @db.VarChar(10)
  message    String
  context    Json?     @default("{}")
  stack      String?
  userId     String?   @map("user_id") @db.Uuid
  companyId  String?   @map("company_id") @db.Uuid
  requestId  String?   @map("request_id") @db.VarChar(100)
  source     String?   @db.VarChar(100)
  durationMs Int?      @map("duration_ms")
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  company    Company?  @relation(fields: [companyId], references: [id], onUpdate: NoAction)
  user       User?     @relation(fields: [userId], references: [id], onUpdate: NoAction)

  @@index([companyId], map: "idx_system_logs_company_id")
  @@index([createdAt(sort: Desc)], map: "idx_system_logs_created_at")
  @@index([level], map: "idx_system_logs_level")
  @@index([source], map: "idx_system_logs_source")
  @@index([userId], map: "idx_system_logs_user_id")
  @@map("system_logs")
}

model NotificationGroup {
  id            String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code          String                    @db.VarChar(50)
  name          String                    @db.VarChar(255)
  description   String?
  companyId     String?                   @map("company_id") @db.Uuid
  isActive      Boolean?                  @default(true) @map("is_active")
  createdAt     DateTime?                 @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime?                 @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  members       NotificationGroupMember[]
  company       Company?                  @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  notifications Notification[]
  tasks         Task[]

  @@unique([code, companyId])
  @@index([companyId], map: "idx_notification_groups_company")
  @@map("notification_groups")
}

model NotificationGroupMember {
  id        String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  groupId   String            @map("group_id") @db.Uuid
  userId    String            @map("user_id") @db.Uuid
  addedAt   DateTime?         @default(now()) @map("added_at") @db.Timestamptz(6)
  addedById String?           @map("added_by") @db.Uuid
  addedBy   User?             @relation("GroupMemberAddedBy", fields: [addedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  group     NotificationGroup @relation(fields: [groupId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user      User              @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([groupId, userId])
  @@index([addedById], map: "idx_notification_group_members_added_by")
  @@index([groupId], map: "idx_notification_group_members_group")
  @@index([userId], map: "idx_notification_group_members_user")
  @@map("notification_group_members")
}

model Task {
  id                                                 String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                                               Int                @default(autoincrement())
  companyId                                          String?            @map("company_id") @db.Uuid
  title                                              String             @db.VarChar(500)
  description                                        String?
  priority                                           TaskPriority?      @default(NORMAL)
  status                                             TaskStatus?        @default(PENDING)
  targetType                                         String             @map("target_type") @db.VarChar(50)
  targetUserId                                       String?            @map("target_user_id") @db.Uuid
  targetDepartmentId                                 String?            @map("target_department_id") @db.Uuid
  targetGroupId                                      String?            @map("target_group_id") @db.Uuid
  targetPermission                                   String?            @map("target_permission") @db.VarChar(100)
  ownerId                                            String?            @map("owner_id") @db.Uuid
  acceptedAt                                         DateTime?          @map("accepted_at") @db.Timestamptz(6)
  deadline                                           DateTime?          @db.Timestamptz(6)
  slaAcceptHours                                     Int?               @default(24) @map("sla_accept_hours")
  slaResolveHours                                    Int?               @default(72) @map("sla_resolve_hours")
  entityType                                         TaskEntityType?    @map("entity_type")
  entityId                                           String?            @map("entity_id") @db.Uuid
  notificationId                                     String?            @map("notification_id") @db.Uuid
  resolution                                         String?
  completedAt                                        DateTime?          @map("completed_at") @db.Timestamptz(6)
  createdById                                        String?            @map("created_by") @db.Uuid
  createdAt                                          DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                                          DateTime?          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  notifications                                      Notification[]
  attachments                                        TaskAttachment[]
  history                                            TaskHistory[]
  company                                            Company?           @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  createdBy                                          User?              @relation("TaskCreatedBy", fields: [createdById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  notifications_tasks_notification_idTonotifications Notification?      @relation("tasks_notification_idTonotifications", fields: [notificationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  owner                                              User?              @relation("TaskOwner", fields: [ownerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  targetDepartment                                   Department?        @relation("TaskTargetDepartment", fields: [targetDepartmentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  targetGroup                                        NotificationGroup? @relation(fields: [targetGroupId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  targetUser                                         User?              @relation("TaskTargetUser", fields: [targetUserId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([code, companyId])
  @@index([companyId], map: "idx_tasks_company")
  @@index([createdById], map: "idx_tasks_created_by")
  @@index([deadline], map: "idx_tasks_deadline")
  @@index([entityType, entityId], map: "idx_tasks_entity")
  @@index([notificationId], map: "idx_tasks_notification")
  @@index([ownerId], map: "idx_tasks_owner")
  @@index([status], map: "idx_tasks_status")
  @@index([targetDepartmentId], map: "idx_tasks_target_department")
  @@index([targetGroupId], map: "idx_tasks_target_group")
  @@index([targetUserId], map: "idx_tasks_target_user")
  @@map("tasks")
}

model TaskHistory {
  id                                     String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  taskId                                 String      @map("task_id") @db.Uuid
  userId                                 String?     @map("user_id") @db.Uuid
  action                                 String      @db.VarChar(50)
  oldStatus                              TaskStatus? @map("old_status")
  newStatus                              TaskStatus? @map("new_status")
  oldOwnerId                             String?     @map("old_owner_id") @db.Uuid
  newOwnerId                             String?     @map("new_owner_id") @db.Uuid
  comment                                String?
  metadata                               Json?       @default("{}")
  createdAt                              DateTime?   @default(now()) @map("created_at") @db.Timestamptz(6)
  users_task_history_new_owner_idTousers User?       @relation("task_history_new_owner_idTousers", fields: [newOwnerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_task_history_old_owner_idTousers User?       @relation("task_history_old_owner_idTousers", fields: [oldOwnerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  task                                   Task        @relation(fields: [taskId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user                                   User?       @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([newOwnerId], map: "idx_task_history_new_owner")
  @@index([oldOwnerId], map: "idx_task_history_old_owner")
  @@index([taskId], map: "idx_task_history_task")
  @@index([userId], map: "idx_task_history_user")
  @@map("task_history")
}

model TaskAttachment {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  taskId      String    @map("task_id") @db.Uuid
  fileName    String    @map("file_name") @db.VarChar(255)
  fileType    String    @map("file_type") @db.VarChar(100)
  fileSize    Int       @map("file_size")
  fileUrl     String    @map("file_url")
  description String?
  uploadedBy  String?   @map("uploaded_by") @db.Uuid
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  task        Task      @relation(fields: [taskId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([taskId], map: "idx_task_attachments_task_id")
  @@map("task_attachments")
}

model IssuedInvoice {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code               Int
  invoiceNumber      String               @db.VarChar(20)
  series             String               @default("1") @db.VarChar(5)
  model              String               @default("55") @db.VarChar(5)
  accessKey          String?              @db.VarChar(50)
  protocolNumber     String?              @db.VarChar(20)
  companyId          String?              @db.Uuid
  customerId         String               @db.Uuid
  salesOrderId       String?              @db.Uuid
  issueDate          DateTime             @default(now())
  operationType      String               @default("SALE") @db.VarChar(20)
  status             String               @default("DRAFT") @db.VarChar(20)
  subtotal           Decimal              @default(0) @db.Decimal(15, 2)
  discountValue      Decimal              @default(0) @db.Decimal(15, 2)
  shippingValue      Decimal              @default(0) @db.Decimal(15, 2)
  icmsBase           Decimal?             @default(0) @db.Decimal(15, 2)
  icmsValue          Decimal?             @default(0) @db.Decimal(15, 2)
  ipiValue           Decimal?             @default(0) @db.Decimal(15, 2)
  pisValue           Decimal?             @default(0) @db.Decimal(15, 2)
  cofinsValue        Decimal?             @default(0) @db.Decimal(15, 2)
  totalValue         Decimal              @default(0) @db.Decimal(15, 2)
  paymentTerms       String?
  notes              String?
  xmlContent         String?
  authorizedAt       DateTime?
  cancelledAt        DateTime?
  cancellationReason String?
  correctionSeq      Int?                 @default(0)
  lastCorrection     String?
  lastCorrectionAt   DateTime?
  createdBy          String?              @db.Uuid
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @default(now()) @updatedAt
  receivables        AccountsReceivable[]
  items              IssuedInvoiceItem[]
  customer           Customer             @relation(fields: [customerId], references: [id])
  salesOrder         SalesOrder?          @relation("IssuedInvoiceOrder", fields: [salesOrderId], references: [id])
  nfe_queue_jobs     nfe_queue_jobs[]

  @@index([salesOrderId])
  @@index([issueDate])
  @@index([companyId], map: "idx_issued_invoices_companyId")
  @@index([customerId], map: "idx_issued_invoices_customerId")
  @@map("issued_invoices")
}

model IssuedInvoiceItem {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  invoiceId       String        @db.Uuid
  materialId      String        @db.Uuid
  description     String?
  quantity        Decimal       @db.Decimal(15, 4)
  unit            String        @default("UN") @db.VarChar(10)
  unitPrice       Decimal       @db.Decimal(15, 4)
  discountPercent Decimal?      @default(0) @db.Decimal(5, 2)
  totalPrice      Decimal       @db.Decimal(15, 2)
  sequence        Int           @default(0)
  cfop            String?       @db.VarChar(10)
  ncm             String?       @db.VarChar(20)
  icmsBase        Decimal?      @default(0) @db.Decimal(15, 2)
  icmsRate        Decimal?      @default(0) @db.Decimal(5, 2)
  icmsValue       Decimal?      @default(0) @db.Decimal(15, 2)
  ipiBase         Decimal?      @default(0) @db.Decimal(15, 2)
  ipiRate         Decimal?      @default(0) @db.Decimal(5, 2)
  ipiValue        Decimal?      @default(0) @db.Decimal(15, 2)
  createdAt       DateTime      @default(now())
  invoice         IssuedInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  material        Material      @relation(fields: [materialId], references: [id])

  @@index([invoiceId], map: "idx_issued_invoice_items_invoiceId")
  @@index([materialId], map: "idx_issued_invoice_items_material")
  @@map("issued_invoice_items")
}

model Dashboard {
  id          String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId   String            @db.Uuid
  name        String            @db.VarChar(255)
  description String?
  isDefault   Boolean           @default(false)
  isPublic    Boolean           @default(false)
  layout      Json?             @default("[]")
  filters     Json?             @default("{}")
  createdBy   String?           @db.Uuid
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @default(now()) @updatedAt
  widgets     DashboardWidget[]
  company     Company           @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  creator     User?             @relation(fields: [createdBy], references: [id], onUpdate: NoAction)

  @@index([companyId])
  @@index([createdBy])
  @@map("dashboards")
}

model Kpi {
  id             String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId      String            @db.Uuid
  code           String            @db.VarChar(50)
  name           String            @db.VarChar(255)
  description    String?
  category       String            @db.VarChar(50)
  unit           String?           @db.VarChar(20)
  formula        String?
  targetMin      Decimal?          @db.Decimal(15, 2)
  targetExpected Decimal?          @db.Decimal(15, 2)
  targetMax      Decimal?          @db.Decimal(15, 2)
  polarity       String            @default("HIGHER") @db.VarChar(10)
  frequency      String            @default("DAILY") @db.VarChar(20)
  isActive       Boolean           @default(true)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now()) @updatedAt
  widgets        DashboardWidget[]
  values         KpiValue[]
  company        Company           @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([code, companyId])
  @@index([companyId])
  @@index([category])
  @@map("kpis")
}

model KpiValue {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  kpiId     String   @db.Uuid
  companyId String   @db.Uuid
  period    DateTime @db.Date
  value     Decimal  @db.Decimal(15, 4)
  target    Decimal? @db.Decimal(15, 4)
  status    String   @default("ON_TARGET") @db.VarChar(20)
  metadata  Json?    @default("{}")
  createdAt DateTime @default(now())
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  kpi       Kpi      @relation(fields: [kpiId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([kpiId, period])
  @@index([kpiId])
  @@index([period])
  @@index([companyId])
  @@map("kpi_values")
}

model DashboardWidget {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  dashboardId String    @db.Uuid
  type        String    @db.VarChar(50)
  title       String    @db.VarChar(255)
  config      Json      @default("{}")
  position    Json      @default("{\"h\": 2, \"w\": 4, \"x\": 0, \"y\": 0}")
  kpiId       String?   @db.Uuid
  dataSource  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now()) @updatedAt
  dashboard   Dashboard @relation(fields: [dashboardId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  kpi         Kpi?      @relation(fields: [kpiId], references: [id], onUpdate: NoAction)

  @@index([dashboardId])
  @@index([kpiId])
  @@map("dashboard_widgets")
}

model StrategicGoal {
  id           String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId    String          @db.Uuid
  year         Int
  title        String          @db.VarChar(255)
  description  String?
  category     String          @db.VarChar(50)
  targetValue  Decimal?        @db.Decimal(15, 2)
  unit         String?         @db.VarChar(20)
  weight       Decimal?        @default(1.0) @db.Decimal(5, 2)
  status       String          @default("ACTIVE") @db.VarChar(20)
  ownerId      String?         @db.Uuid
  departmentId String?         @db.Uuid
  parentId     String?         @db.Uuid
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @default(now()) @updatedAt
  actionPlans  ActionPlan[]
  indicators   GoalIndicator[]
  company      Company         @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  department   Department?     @relation(fields: [departmentId], references: [id], onUpdate: NoAction)
  owner        User?           @relation(fields: [ownerId], references: [id], onUpdate: NoAction)
  parent       StrategicGoal?  @relation("GoalHierarchy", fields: [parentId], references: [id], onUpdate: NoAction)
  children     StrategicGoal[] @relation("GoalHierarchy")

  @@index([companyId])
  @@index([year])
  @@index([parentId])
  @@index([departmentId])
  @@index([ownerId])
  @@map("strategic_goals")
}

model GoalIndicator {
  id             String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  goalId         String             @db.Uuid
  companyId      String             @db.Uuid
  name           String             @db.VarChar(255)
  description    String?
  formula        String?
  unit           String?            @db.VarChar(20)
  polarity       String             @default("HIGHER") @db.VarChar(10)
  frequency      String             @default("MONTHLY") @db.VarChar(20)
  targetMin      Decimal?           @db.Decimal(15, 2)
  targetExpected Decimal?           @db.Decimal(15, 2)
  targetMax      Decimal?           @db.Decimal(15, 2)
  currentValue   Decimal?           @db.Decimal(15, 2)
  lastUpdated    DateTime?
  dataSource     String?            @db.VarChar(100)
  isActive       Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @default(now()) @updatedAt
  actionPlans    ActionPlan[]
  company        Company            @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  goal           StrategicGoal      @relation(fields: [goalId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  history        IndicatorHistory[]

  @@index([goalId])
  @@index([companyId])
  @@map("goal_indicators")
}

model IndicatorHistory {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  indicatorId String        @db.Uuid
  period      DateTime      @db.Date
  value       Decimal       @db.Decimal(15, 4)
  target      Decimal?      @db.Decimal(15, 4)
  status      String        @default("ON_TARGET") @db.VarChar(20)
  notes       String?
  createdAt   DateTime      @default(now())
  indicator   GoalIndicator @relation(fields: [indicatorId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([indicatorId, period])
  @@index([indicatorId])
  @@index([period])
  @@map("indicator_history")
}

model ActionPlan {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId      String           @db.Uuid
  goalId         String?          @db.Uuid
  indicatorId    String?          @db.Uuid
  title          String           @db.VarChar(255)
  description    String?
  type           String           @default("CORRECTIVE") @db.VarChar(20)
  priority       Int              @default(3)
  status         String           @default("PENDING") @db.VarChar(20)
  responsibleId  String?          @db.Uuid
  dueDate        DateTime?        @db.Date
  completedAt    DateTime?
  progress       Int?             @default(0)
  rootCause      String?
  expectedResult String?
  actualResult   String?
  createdBy      String?          @db.Uuid
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @default(now()) @updatedAt
  tasks          ActionPlanTask[]
  company        Company          @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  creator        User?            @relation("ActionPlanCreator", fields: [createdBy], references: [id], onUpdate: NoAction)
  goal           StrategicGoal?   @relation(fields: [goalId], references: [id], onUpdate: NoAction)
  indicator      GoalIndicator?   @relation(fields: [indicatorId], references: [id], onUpdate: NoAction)
  responsible    User?            @relation("ActionPlanResponsible", fields: [responsibleId], references: [id], onUpdate: NoAction)

  @@index([companyId])
  @@index([goalId])
  @@index([status])
  @@index([createdBy])
  @@index([indicatorId])
  @@index([responsibleId])
  @@map("action_plans")
}

model ActionPlanTask {
  id            String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  actionPlanId  String     @db.Uuid
  title         String     @db.VarChar(255)
  description   String?
  responsibleId String?    @db.Uuid
  dueDate       DateTime?  @db.Date
  completedAt   DateTime?
  status        String     @default("PENDING") @db.VarChar(20)
  sequence      Int?       @default(0)
  createdAt     DateTime   @default(now())
  actionPlan    ActionPlan @relation(fields: [actionPlanId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  responsible   User?      @relation(fields: [responsibleId], references: [id], onUpdate: NoAction)

  @@index([actionPlanId])
  @@index([responsibleId])
  @@map("action_plan_tasks")
}

model BudgetAccount {
  id          String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId   String          @db.Uuid
  code        String          @db.VarChar(20)
  name        String          @db.VarChar(255)
  description String?
  type        String          @default("EXPENSE") @db.VarChar(20)
  parentId    String?         @db.Uuid
  level       Int             @default(1)
  isActive    Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @default(now()) @updatedAt
  company     Company         @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  parent      BudgetAccount?  @relation("BudgetAccountHierarchy", fields: [parentId], references: [id], onUpdate: NoAction)
  children    BudgetAccount[] @relation("BudgetAccountHierarchy")
  actuals     BudgetActual[]
  alerts      BudgetAlert[]
  entries     BudgetEntry[]

  @@unique([companyId, code])
  @@index([companyId])
  @@index([parentId])
  @@map("budget_accounts")
}

model BudgetVersion {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId   String        @db.Uuid
  year        Int
  name        String        @db.VarChar(100)
  type        String        @default("ORIGINAL") @db.VarChar(20)
  status      String        @default("DRAFT") @db.VarChar(20)
  description String?
  approvedBy  String?       @db.Uuid
  approvedAt  DateTime?
  createdBy   String?       @db.Uuid
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @default(now()) @updatedAt
  alerts      BudgetAlert[]
  entries     BudgetEntry[]
  approver    User?         @relation("BudgetApprover", fields: [approvedBy], references: [id], onUpdate: NoAction)
  company     Company       @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  creator     User?         @relation("BudgetCreator", fields: [createdBy], references: [id], onUpdate: NoAction)

  @@index([companyId, year])
  @@index([approvedBy])
  @@index([createdBy])
  @@map("budget_versions")
}

model BudgetEntry {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  versionId    String        @db.Uuid
  accountId    String        @db.Uuid
  costCenterId String?       @db.Uuid
  month        Int
  amount       Decimal       @default(0) @db.Decimal(15, 2)
  notes        String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now()) @updatedAt
  account      BudgetAccount @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  costCenter   CostCenter?   @relation(fields: [costCenterId], references: [id], onUpdate: NoAction)
  version      BudgetVersion @relation(fields: [versionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([versionId, accountId, costCenterId, month], map: "budget_entries_unique")
  @@index([versionId])
  @@index([accountId])
  @@index([costCenterId])
  @@map("budget_entries")
}

model BudgetActual {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId    String        @db.Uuid
  accountId    String        @db.Uuid
  costCenterId String?       @db.Uuid
  date         DateTime      @db.Date
  amount       Decimal       @db.Decimal(15, 2)
  description  String?
  documentType String?       @db.VarChar(50)
  documentId   String?       @db.Uuid
  createdAt    DateTime      @default(now())
  account      BudgetAccount @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  company      Company       @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  costCenter   CostCenter?   @relation(fields: [costCenterId], references: [id], onUpdate: NoAction)

  @@index([companyId, date])
  @@index([accountId])
  @@index([costCenterId])
  @@map("budget_actuals")
}

model BudgetAlert {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId       String        @db.Uuid
  versionId       String        @db.Uuid
  accountId       String        @db.Uuid
  costCenterId    String?       @db.Uuid
  month           Int
  type            String        @db.VarChar(20)
  budgetAmount    Decimal       @db.Decimal(15, 2)
  actualAmount    Decimal       @db.Decimal(15, 2)
  variance        Decimal       @db.Decimal(15, 2)
  variancePercent Decimal       @db.Decimal(5, 2)
  isResolved      Boolean       @default(false)
  resolvedBy      String?       @db.Uuid
  resolvedAt      DateTime?
  notes           String?
  createdAt       DateTime      @default(now())
  account         BudgetAccount @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  company         Company       @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  costCenter      CostCenter?   @relation(fields: [costCenterId], references: [id], onUpdate: NoAction)
  resolver        User?         @relation(fields: [resolvedBy], references: [id], onUpdate: NoAction)
  version         BudgetVersion @relation(fields: [versionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([companyId])
  @@index([isResolved])
  @@index([accountId])
  @@index([costCenterId])
  @@index([resolvedBy])
  @@index([versionId])
  @@map("budget_alerts")
}

model WorkflowDefinition {
  id            String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId     String               @db.Uuid
  code          String               @db.VarChar(50)
  name          String               @db.VarChar(255)
  description   String?
  category      String               @db.VarChar(50)
  triggerType   String               @db.VarChar(50)
  triggerConfig Json?                @default("{}")
  isActive      Boolean              @default(true)
  version       Int                  @default(1)
  createdBy     String?              @db.Uuid
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @default(now()) @updatedAt
  canvasLayout  Json?
  formSchema    Json?
  variables     Json?                @default("[]")
  company       Company              @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  creator       User?                @relation(fields: [createdBy], references: [id], onUpdate: NoAction)
  instances     WorkflowInstance[]
  steps         WorkflowStep[]
  transitions   WorkflowTransition[]

  @@unique([companyId, code])
  @@index([companyId])
  @@index([category])
  @@index([createdBy])
  @@map("workflow_definitions")
}

model WorkflowStep {
  id                 String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  definitionId       String                @db.Uuid
  code               String                @db.VarChar(50)
  name               String                @db.VarChar(255)
  type               String                @db.VarChar(50)
  sequence           Int                   @default(0)
  config             Json?                 @default("{}")
  assigneeType       String?               @db.VarChar(50)
  assigneeId         String?               @db.Uuid
  assigneeExpression String?
  slaHours           Int?
  escalationUserId   String?               @db.Uuid
  isRequired         Boolean               @default(true)
  createdAt          DateTime              @default(now())
  positionX          Float?                @default(0)
  positionY          Float?                @default(0)
  width              Float?
  height             Float?
  style              Json?
  formFields         Json?
  validationRules    Json?
  scriptCode         String?
  serviceEndpoint    String?
  serviceMethod      String?               @db.VarChar(10)
  currentInstances   WorkflowInstance[]
  stepHistory        WorkflowStepHistory[]
  definition         WorkflowDefinition    @relation(fields: [definitionId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  escalationUser     User?                 @relation("StepEscalation", fields: [escalationUserId], references: [id], onUpdate: NoAction)
  transitionsFrom    WorkflowTransition[]  @relation("TransitionFrom")
  transitionsTo      WorkflowTransition[]  @relation("TransitionTo")

  @@index([definitionId])
  @@index([escalationUserId])
  @@map("workflow_steps")
}

model WorkflowTransition {
  id            String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  definitionId  String             @db.Uuid
  fromStepId    String             @db.Uuid
  toStepId      String             @db.Uuid
  condition     String?
  conditionType String?            @default("ALWAYS") @db.VarChar(50)
  label         String?            @db.VarChar(100)
  createdAt     DateTime           @default(now())
  conditionJson Json?
  sourceHandle  String?            @db.VarChar(50)
  targetHandle  String?            @db.VarChar(50)
  edgeType      String?            @default("default") @db.VarChar(50)
  edgeStyle     Json?
  labelPosition Float?             @default(0.5)
  isDefault     Boolean?           @default(false)
  priority      Int?               @default(0)
  definition    WorkflowDefinition @relation(fields: [definitionId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  fromStep      WorkflowStep       @relation("TransitionFrom", fields: [fromStepId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  toStep        WorkflowStep       @relation("TransitionTo", fields: [toStepId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([definitionId])
  @@index([fromStepId])
  @@index([toStepId])
  @@map("workflow_transitions")
}

model WorkflowInstance {
  id                 String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  definitionId       String                @db.Uuid
  companyId          String                @db.Uuid
  code               String                @db.VarChar(50)
  status             String                @default("PENDING") @db.VarChar(50)
  currentStepId      String?               @db.Uuid
  entityType         String?               @db.VarChar(100)
  entityId           String?               @db.Uuid
  data               Json?                 @default("{}")
  startedBy          String?               @db.Uuid
  startedAt          DateTime              @default(now())
  completedAt        DateTime?
  cancelledAt        DateTime?
  cancelledBy        String?               @db.Uuid
  cancellationReason String?
  context            Json?                 @default("{}")
  variables          Json?                 @default("{}")
  activeTokens       Json?                 @default("[]")
  priority           Int?                  @default(0)
  dueDate            DateTime?             @db.Timestamptz(6)
  canceller          User?                 @relation("WorkflowCanceller", fields: [cancelledBy], references: [id], onUpdate: NoAction)
  company            Company               @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  currentStep        WorkflowStep?         @relation(fields: [currentStepId], references: [id], onUpdate: NoAction)
  definition         WorkflowDefinition    @relation(fields: [definitionId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  starter            User?                 @relation("WorkflowStarter", fields: [startedBy], references: [id], onUpdate: NoAction)
  stepHistory        WorkflowStepHistory[]

  @@index([companyId])
  @@index([status])
  @@index([entityType, entityId])
  @@index([cancelledBy])
  @@index([currentStepId])
  @@index([definitionId])
  @@index([startedBy])
  @@map("workflow_instances")
}

model WorkflowStepHistory {
  id          String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  instanceId  String           @db.Uuid
  stepId      String           @db.Uuid
  status      String           @default("PENDING") @db.VarChar(50)
  action      String?          @db.VarChar(50)
  assignedTo  String?          @db.Uuid
  completedBy String?          @db.Uuid
  startedAt   DateTime         @default(now())
  completedAt DateTime?
  dueAt       DateTime?
  comments    String?
  data        Json?            @default("{}")
  assignee    User?            @relation("StepAssignee", fields: [assignedTo], references: [id], onUpdate: NoAction)
  completer   User?            @relation("StepCompleter", fields: [completedBy], references: [id], onUpdate: NoAction)
  instance    WorkflowInstance @relation(fields: [instanceId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  step        WorkflowStep     @relation(fields: [stepId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([instanceId])
  @@index([assignedTo])
  @@index([completedBy])
  @@index([stepId])
  @@map("workflow_step_history")
}

model PickingList {
  id            String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId     String                @db.Uuid
  code          String                @db.VarChar(50)
  status        String                @default("PENDING") @db.VarChar(20)
  priority      String                @default("NORMAL") @db.VarChar(20)
  type          String                @default("REQUISITION") @db.VarChar(50)
  sourceId      String?               @db.Uuid
  sourceType    String?               @db.VarChar(50)
  assignedTo    String?               @db.Uuid
  startedAt     DateTime?
  completedAt   DateTime?
  notes         String?
  createdBy     String?               @db.Uuid
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @default(now()) @updatedAt
  items         PickingListItem[]
  assignee      User?                 @relation("PickingAssignee", fields: [assignedTo], references: [id], onUpdate: NoAction)
  company       Company               @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  creator       User?                 @relation("PickingCreator", fields: [createdBy], references: [id], onUpdate: NoAction)
  verifications PickingVerification[]

  @@unique([companyId, code])
  @@index([companyId])
  @@index([status])
  @@index([assignedTo])
  @@index([sourceId])
  @@index([createdBy])
  @@map("picking_lists")
}

model PickingListItem {
  id             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pickingListId  String         @db.Uuid
  materialId     String         @db.Uuid
  locationId     String?        @db.Uuid
  requestedQty   Decimal        @db.Decimal(15, 4)
  pickedQty      Decimal        @default(0) @db.Decimal(15, 4)
  status         String         @default("PENDING") @db.VarChar(20)
  sequence       Int            @default(0)
  lotNumber      String?        @db.VarChar(100)
  serialNumber   String?        @db.VarChar(100)
  expirationDate DateTime?      @db.Date
  notes          String?
  pickedAt       DateTime?
  pickedBy       String?        @db.Uuid
  location       StockLocation? @relation(fields: [locationId], references: [id], onUpdate: NoAction)
  material       Material       @relation(fields: [materialId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  picker         User?          @relation(fields: [pickedBy], references: [id], onUpdate: NoAction)
  pickingList    PickingList    @relation(fields: [pickingListId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([pickingListId])
  @@index([materialId])
  @@index([locationId])
  @@index([pickedBy])
  @@map("picking_list_items")
}

model PickingVerification {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pickingListId String      @db.Uuid
  verifiedBy    String      @db.Uuid
  verifiedAt    DateTime    @default(now())
  status        String      @db.VarChar(20)
  discrepancies Json?       @default("[]")
  notes         String?
  pickingList   PickingList @relation(fields: [pickingListId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  verifier      User        @relation(fields: [verifiedBy], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([pickingListId])
  @@index([verifiedBy])
  @@map("picking_verifications")
}

model ApprovalLevel {
  id                   String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId            String                  @db.Uuid
  code                 String                  @db.VarChar(50)
  name                 String                  @db.VarChar(100)
  description          String?
  minValue             Decimal                 @default(0) @db.Decimal(15, 2)
  maxValue             Decimal?                @db.Decimal(15, 2)
  requiresAllApprovers Boolean                 @default(false)
  sequence             Int                     @default(0)
  isActive             Boolean                 @default(true)
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @default(now()) @updatedAt
  approvers            ApprovalLevelApprover[]
  company              Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  paymentApprovals     PaymentApproval[]
  paymentRequests      PaymentRequest[]        @relation("CurrentLevel")

  @@unique([companyId, code])
  @@index([companyId])
  @@map("approval_levels")
}

model ApprovalLevelApprover {
  id         String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  levelId    String        @db.Uuid
  userId     String        @db.Uuid
  canApprove Boolean       @default(true)
  canReject  Boolean       @default(true)
  sequence   Int           @default(0)
  createdAt  DateTime      @default(now())
  level      ApprovalLevel @relation(fields: [levelId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([levelId, userId])
  @@index([levelId])
  @@index([userId])
  @@map("approval_level_approvers")
}

model PaymentRequest {
  id             String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId      String               @db.Uuid
  code           String               @db.VarChar(50)
  payableId      String               @db.Uuid
  amount         Decimal              @db.Decimal(15, 2)
  dueDate        DateTime             @db.Date
  status         PaymentRequestStatus @default(PENDING)
  currentLevelId String?              @db.Uuid
  requestedBy    String               @db.Uuid
  requestedAt    DateTime             @default(now())
  justification  String?
  urgency        String               @default("NORMAL") @db.VarChar(20)
  completedAt    DateTime?
  notes          String?
  approvals      PaymentApproval[]
  company        Company              @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  currentLevel   ApprovalLevel?       @relation("CurrentLevel", fields: [currentLevelId], references: [id], onUpdate: NoAction)
  payable        AccountsPayable      @relation(fields: [payableId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  requester      User                 @relation("PaymentRequester", fields: [requestedBy], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([companyId, code])
  @@index([companyId])
  @@index([status])
  @@index([payableId])
  @@index([requestedBy])
  @@index([currentLevelId])
  @@map("payment_requests")
}

model PaymentApproval {
  id          String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  requestId   String         @db.Uuid
  levelId     String         @db.Uuid
  approverId  String         @db.Uuid
  action      String         @db.VarChar(20)
  comments    String?
  delegatedTo String?        @db.Uuid
  actionAt    DateTime       @default(now())
  approver    User           @relation("PaymentApprover", fields: [approverId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  delegate    User?          @relation("PaymentDelegate", fields: [delegatedTo], references: [id], onUpdate: NoAction)
  level       ApprovalLevel  @relation(fields: [levelId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  request     PaymentRequest @relation(fields: [requestId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([requestId])
  @@index([approverId])
  @@index([delegatedTo])
  @@index([levelId])
  @@map("payment_approvals")
}

model SefazSyncConfig {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId      String    @unique @db.Uuid
  isEnabled      Boolean   @default(false)
  syncInterval   Int       @default(60)
  lastSyncAt     DateTime?
  nextSyncAt     DateTime?
  autoManifest   Boolean   @default(false)
  manifestType   String?   @default("CIENCIA") @db.VarChar(20)
  notifyOnNewNfe Boolean   @default(true)
  notifyEmail    String?   @db.VarChar(255)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @default(now()) @updatedAt
  company        Company   @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([companyId])
  @@map("sefaz_sync_configs")
}

model SefazSyncLog {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId    String    @db.Uuid
  syncType     String    @db.VarChar(20)
  status       String    @db.VarChar(20)
  startedAt    DateTime  @default(now())
  completedAt  DateTime?
  nfesFound    Int?      @default(0)
  nfesImported Int?      @default(0)
  nfesSkipped  Int?      @default(0)
  nfesError    Int?      @default(0)
  errorMessage String?
  details      Json?     @default("{}")
  company      Company   @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([companyId])
  @@index([status])
  @@index([startedAt])
  @@map("sefaz_sync_logs")
}

model SefazPendingNfe {
  id                String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId         String                 @db.Uuid
  chaveAcesso       String                 @db.VarChar(44)
  cnpjEmitente      String                 @db.VarChar(14)
  nomeEmitente      String?                @db.VarChar(255)
  dataEmissao       DateTime?              @db.Date
  valorTotal        Decimal?               @db.Decimal(15, 2)
  situacao          String                 @default("PENDENTE") @db.VarChar(20)
  manifestacao      String?                @db.VarChar(20)
  manifestadaEm     DateTime?
  xmlContent        String?
  errorMessage      String?
  receivedInvoiceId String?                @db.Uuid
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @default(now()) @updatedAt
  manifestacoes     SefazManifestacaoLog[]
  company           Company                @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  receivedInvoice   ReceivedInvoice?       @relation(fields: [receivedInvoiceId], references: [id], onUpdate: NoAction)

  @@unique([companyId, chaveAcesso])
  @@index([situacao])
  @@index([chaveAcesso])
  @@index([companyId], map: "idx_sefaz_pending_nfes_companyId")
  @@index([receivedInvoiceId])
  @@map("sefaz_pending_nfes")
}

model SefazManifestacaoLog {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId        String           @db.Uuid
  chaveAcesso      String           @db.VarChar(44)
  tipo             String           @db.VarChar(20)
  justificativa    String?          @db.VarChar(255)
  protocolo        String?          @db.VarChar(50)
  dataManifestacao DateTime?        @default(now()) @db.Timestamptz(6)
  status           String           @db.VarChar(20)
  errorMessage     String?
  pendingNfeId     String?          @db.Uuid
  userId           String?          @db.Uuid
  createdAt        DateTime?        @default(now()) @db.Timestamptz(6)
  pendingNfe       SefazPendingNfe? @relation(fields: [pendingNfeId], references: [id], onUpdate: NoAction, map: "fk_manifestacao_pending_nfe")

  @@index([chaveAcesso], map: "idx_sefaz_manifestacao_logs_chave")
  @@index([companyId], map: "idx_sefaz_manifestacao_logs_company")
  @@index([dataManifestacao], map: "idx_sefaz_manifestacao_logs_data")
  @@index([pendingNfeId], map: "idx_sefaz_manifestacao_logs_pendingNfeId")
  @@index([tipo], map: "idx_sefaz_manifestacao_logs_tipo")
  @@map("sefaz_manifestacao_logs")
}

model DdaBoleto {
  id                  String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId           String           @map("company_id") @db.Uuid
  codigoBarras        String?          @map("codigo_barras") @db.VarChar(48)
  linhaDigitavel      String?          @map("linha_digitavel") @db.VarChar(54)
  nossoNumero         String?          @map("nosso_numero") @db.VarChar(20)
  seuNumero           String?          @map("seu_numero") @db.VarChar(20)
  valorOriginal       Decimal          @map("valor_original") @db.Decimal(15, 2)
  valorDesconto       Decimal?         @default(0) @map("valor_desconto") @db.Decimal(15, 2)
  valorJuros          Decimal?         @default(0) @map("valor_juros") @db.Decimal(15, 2)
  valorMulta          Decimal?         @default(0) @map("valor_multa") @db.Decimal(15, 2)
  valorFinal          Decimal          @map("valor_final") @db.Decimal(15, 2)
  dataEmissao         DateTime?        @map("data_emissao") @db.Date
  dataVencimento      DateTime         @map("data_vencimento") @db.Date
  dataLimitePagamento DateTime?        @map("data_limite_pagamento") @db.Date
  cedenteCnpj         String?          @map("cedente_cnpj") @db.VarChar(18)
  cedenteNome         String?          @map("cedente_nome") @db.VarChar(200)
  cedenteBanco        String?          @map("cedente_banco") @db.VarChar(3)
  cedenteAgencia      String?          @map("cedente_agencia") @db.VarChar(10)
  cedenteConta        String?          @map("cedente_conta") @db.VarChar(20)
  sacadoCnpj          String?          @map("sacado_cnpj") @db.VarChar(18)
  sacadoNome          String?          @map("sacado_nome") @db.VarChar(200)
  status              String?          @default("PENDENTE") @db.VarChar(20)
  origem              String?          @default("DDA") @db.VarChar(20)
  accountsPayableId   String?          @map("accounts_payable_id") @db.Uuid
  supplierId          String?          @map("supplier_id") @db.Uuid
  aprovadoPor         String?          @map("aprovado_por") @db.Uuid
  aprovadoEm          DateTime?        @map("aprovado_em") @db.Timestamp(6)
  motivoRejeicao      String?          @map("motivo_rejeicao")
  pagoEm              DateTime?        @map("pago_em") @db.Timestamp(6)
  comprovanteUrl      String?          @map("comprovante_url")
  createdAt           DateTime?        @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt           DateTime?        @default(now()) @map("updated_at") @db.Timestamp(6)
  createdBy           String?          @map("created_by") @db.Uuid
  accountsPayable     AccountsPayable? @relation(fields: [accountsPayableId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  approvedByUser      User?            @relation("dda_boletos_aprovado_porTousers", fields: [aprovadoPor], references: [id], onDelete: NoAction, onUpdate: NoAction)
  company             Company          @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  createdByUser       User?            @relation("dda_boletos_created_byTousers", fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  supplier            Supplier?        @relation(fields: [supplierId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([accountsPayableId], map: "idx_dda_boletos_accounts_payable_id")
  @@index([aprovadoPor], map: "idx_dda_boletos_aprovado_por")
  @@index([cedenteCnpj], map: "idx_dda_boletos_cedente")
  @@index([codigoBarras], map: "idx_dda_boletos_codigo_barras")
  @@index([companyId], map: "idx_dda_boletos_company")
  @@index([createdBy], map: "idx_dda_boletos_created_by")
  @@index([status], map: "idx_dda_boletos_status")
  @@index([supplierId], map: "idx_dda_boletos_supplier_id")
  @@index([dataVencimento], map: "idx_dda_boletos_vencimento")
  @@map("dda_boletos")
}

model DdaConfig {
  id                 String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId          String       @map("company_id") @db.Uuid
  bancoCodigo        String       @map("banco_codigo") @db.VarChar(3)
  bancoNome          String?      @map("banco_nome") @db.VarChar(100)
  agencia            String?      @db.VarChar(10)
  conta              String?      @db.VarChar(20)
  convenio           String?      @db.VarChar(20)
  ambiente           String?      @default("HOMOLOGACAO") @db.VarChar(10)
  clientId           String?      @map("client_id")
  clientSecret       String?      @map("client_secret")
  certificadoId      String?      @map("certificado_id")
  ativo              Boolean?     @default(true)
  autoAprovarAte     Decimal?     @default(0) @map("auto_aprovar_ate") @db.Decimal(15, 2)
  notificarNovos     Boolean?     @default(true) @map("notificar_novos")
  emailNotificacao   String?      @map("email_notificacao") @db.VarChar(200)
  ultimaSincronizacao DateTime?   @map("ultima_sincronizacao") @db.Timestamp(6)
  createdAt          DateTime?    @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt          DateTime?    @default(now()) @map("updated_at") @db.Timestamp(6)
  company            Company      @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ddaSyncLogs        DdaSyncLog[]

  @@unique([companyId, bancoCodigo])
  @@map("dda_config")
}

model DdaSyncLog {
  id                 String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId          String     @map("company_id") @db.Uuid
  configId           String?    @map("config_id") @db.Uuid
  tipo               String     @db.VarChar(20)
  status             String     @db.VarChar(20)
  boletosEncontrados Int?       @default(0) @map("boletos_encontrados")
  boletosNovos       Int?       @default(0) @map("boletos_novos")
  boletosAtualizados Int?       @default(0) @map("boletos_atualizados")
  erroMensagem       String?    @map("erro_mensagem")
  iniciadoEm         DateTime?  @default(now()) @map("iniciado_em") @db.Timestamp(6)
  finalizadoEm       DateTime?  @map("finalizado_em") @db.Timestamp(6)
  company            Company    @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ddaConfig          DdaConfig? @relation(fields: [configId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([companyId], map: "idx_dda_sync_log_company_id")
  @@index([configId], map: "idx_dda_sync_log_config_id")
  @@map("dda_sync_log")
}

model SavedReport {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String   @db.Uuid
  companyId   String   @db.Uuid
  reportType  String
  name        String
  description String?
  filters     Json     @default("{}")
  isDefault   Boolean  @default(false)
  isShared    Boolean  @default(false)
  isFavorite  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([companyId], map: "idx_saved_reports_companyId")
  @@index([reportType], map: "idx_saved_reports_reportType")
  @@index([userId], map: "idx_saved_reports_userId")
  @@map("saved_reports")
}

model CollectionRule {
  id          String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId   String?              @map("company_id") @db.Uuid
  name        String               @db.VarChar(100)
  description String?
  isActive    Boolean?             @default(true) @map("is_active")
  isDefault   Boolean?             @default(false) @map("is_default")
  createdBy   String?              @map("created_by") @db.Uuid
  createdAt   DateTime?            @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime?            @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  actions     CollectionAction[]
  steps       CollectionRuleStep[]
  company     Company?             @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([isActive], map: "idx_collection_rules_active")
  @@index([companyId], map: "idx_collection_rules_company")
  @@map("collection_rules")
}

model CollectionRuleStep {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  collectionRuleId String             @map("collection_rule_id") @db.Uuid
  stepOrder        Int                @map("step_order")
  name             String             @db.VarChar(100)
  daysOffset       Int                @map("days_offset")
  actionType       String             @map("action_type") @db.VarChar(50)
  templateSubject  String?            @map("template_subject") @db.VarChar(255)
  templateBody     String?            @map("template_body")
  isActive         Boolean?           @default(true) @map("is_active")
  createdAt        DateTime?          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime?          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  actions          CollectionAction[]
  collectionRule   CollectionRule     @relation(fields: [collectionRuleId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([collectionRuleId, stepOrder])
  @@index([collectionRuleId], map: "idx_collection_rule_steps_rule")
  @@map("collection_rule_steps")
}

model CollectionAction {
  id               String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  receivableId     String              @map("receivable_id") @db.Uuid
  collectionRuleId String?             @map("collection_rule_id") @db.Uuid
  stepId           String?             @map("step_id") @db.Uuid
  actionType       String              @map("action_type") @db.VarChar(50)
  actionDate       DateTime?           @default(now()) @map("action_date") @db.Timestamptz(6)
  status           String              @default("PENDING") @db.VarChar(20)
  contactInfo      String?             @map("contact_info") @db.VarChar(255)
  messageContent   String?             @map("message_content")
  responseContent  String?             @map("response_content")
  responseDate     DateTime?           @map("response_date") @db.Timestamptz(6)
  notes            String?
  createdBy        String?             @map("created_by") @db.Uuid
  createdAt        DateTime?           @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime?           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  collectionRule   CollectionRule?     @relation(fields: [collectionRuleId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  receivable       AccountsReceivable  @relation(fields: [receivableId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  step             CollectionRuleStep? @relation(fields: [stepId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([actionDate], map: "idx_collection_actions_date")
  @@index([receivableId], map: "idx_collection_actions_receivable")
  @@index([collectionRuleId], map: "idx_collection_actions_rule")
  @@index([status], map: "idx_collection_actions_status")
  @@index([stepId], map: "idx_collection_actions_step")
  @@map("collection_actions")
}

model SupplierReturn {
  id                  String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  returnNumber        Int                  @default(autoincrement())
  status              SupplierReturnStatus @default(DRAFT)
  supplierId          String               @db.Uuid
  receivedInvoiceId   String?              @db.Uuid
  totalValue          Float                @default(0)
  returnDate          DateTime             @default(now())
  approvedAt          DateTime?
  approvedBy          String?              @db.Uuid
  invoicedAt          DateTime?
  completedAt         DateTime?
  cancelledAt         DateTime?
  cancelledBy         String?              @db.Uuid
  cancellationReason  String?
  returnInvoiceId     String?              @db.Uuid
  returnInvoiceNumber Int?
  returnInvoiceKey    String?              @db.VarChar(44)
  notes               String?
  companyId           String?              @db.Uuid
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @default(now()) @updatedAt
  createdBy           String?              @db.Uuid
  items               SupplierReturnItem[]
  company             Company?             @relation(fields: [companyId], references: [id], onUpdate: NoAction)
  receivedInvoice     ReceivedInvoice?     @relation(fields: [receivedInvoiceId], references: [id], onUpdate: NoAction)
  supplier            Supplier             @relation(fields: [supplierId], references: [id], onUpdate: NoAction)

  @@index([companyId], map: "idx_supplier_returns_company")
  @@index([returnDate], map: "idx_supplier_returns_date")
  @@index([receivedInvoiceId], map: "idx_supplier_returns_receivedinvoiceid")
  @@index([status], map: "idx_supplier_returns_status")
  @@index([supplierId], map: "idx_supplier_returns_supplier")
  @@map("supplier_returns")
}

model SupplierReturnItem {
  id                     String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  returnId               String               @db.Uuid
  materialId             String               @db.Uuid
  receivedInvoiceItemId  String?              @db.Uuid
  quantity               Float
  unitPrice              Float
  totalPrice             Float
  reason                 ReturnReason         @default(OTHER)
  reasonNotes            String?
  stockLocationId        String?              @db.Uuid
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @default(now()) @updatedAt
  material               Material             @relation(fields: [materialId], references: [id], onUpdate: NoAction)
  received_invoice_items ReceivedInvoiceItem? @relation(fields: [receivedInvoiceItemId], references: [id], onUpdate: NoAction)
  return                 SupplierReturn       @relation(fields: [returnId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  stockLocation          StockLocation?       @relation(fields: [stockLocationId], references: [id], onUpdate: NoAction)

  @@index([materialId], map: "idx_supplier_return_items_material")
  @@index([receivedInvoiceItemId], map: "idx_supplier_return_items_receivedinvoiceitemid")
  @@index([returnId], map: "idx_supplier_return_items_return")
  @@index([stockLocationId], map: "idx_supplier_return_items_stocklocationid")
  @@map("supplier_return_items")
}

model QualityInspection {
  id                String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code              Int
  companyId         String?                 @map("company_id") @db.Uuid
  type              String                  @default("RECEIVING")
  status            String                  @default("PENDING")
  materialId        String?                 @map("material_id") @db.Uuid
  productionOrderId String?                 @map("production_order_id") @db.Uuid
  receivedInvoiceId String?                 @map("received_invoice_id") @db.Uuid
  lotNumber         String?                 @map("lot_number")
  quantity          Float                   @default(0)
  sampleSize        Int?                    @map("sample_size")
  approvedQty       Float?                  @default(0) @map("approved_qty")
  rejectedQty       Float?                  @default(0) @map("rejected_qty")
  inspectionDate    DateTime                @default(now()) @map("inspection_date")
  completedAt       DateTime?               @map("completed_at")
  inspectorId       String?                 @map("inspector_id") @db.Uuid
  notes             String?
  createdAt         DateTime                @default(now()) @map("created_at")
  updatedAt         DateTime                @default(now()) @map("updated_at")
  items             QualityInspectionItem[]
  material          Material?               @relation(fields: [materialId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  productionOrder   ProductionOrder?        @relation(fields: [productionOrderId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  nonConformities   NonConformity[]

  @@index([companyId], map: "idx_quality_inspections_company_id")
  @@index([materialId], map: "idx_quality_inspections_material_id")
  @@index([status], map: "idx_quality_inspections_status")
  @@map("quality_inspections")
}

model QualityInspectionItem {
  id            String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  inspectionId  String            @map("inspection_id") @db.Uuid
  characteristic String
  specification String?
  toleranceMin  Float?            @map("tolerance_min")
  toleranceMax  Float?            @map("tolerance_max")
  measuredValue Float?            @map("measured_value")
  result        String?           @default("PENDING")
  notes         String?
  createdAt     DateTime          @default(now()) @map("created_at")
  inspection    QualityInspection @relation(fields: [inspectionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([inspectionId], map: "idx_quality_inspection_items_inspection_id")
  @@map("quality_inspection_items")
}

model NonConformity {
  id                String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code              Int
  companyId         String?            @map("company_id") @db.Uuid
  type              String             @default("INTERNAL")
  status            String             @default("OPEN")
  severity          String             @default("MINOR")
  inspectionId      String?            @map("inspection_id") @db.Uuid
  productionOrderId String?            @map("production_order_id") @db.Uuid
  materialId        String?            @map("material_id") @db.Uuid
  lotNumber         String?            @map("lot_number")
  quantity          Float?             @default(0)
  description       String
  rootCause         String?            @map("root_cause")
  immediateAction   String?            @map("immediate_action")
  correctiveAction  String?            @map("corrective_action")
  preventiveAction  String?            @map("preventive_action")
  responsibleId     String?            @map("responsible_id") @db.Uuid
  dueDate           DateTime?          @map("due_date")
  closedAt          DateTime?          @map("closed_at")
  closedBy          String?            @map("closed_by") @db.Uuid
  createdBy         String?            @map("created_by") @db.Uuid
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @default(now()) @map("updated_at")
  inspection        QualityInspection? @relation(fields: [inspectionId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  material          Material?          @relation(fields: [materialId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  productionOrder   ProductionOrder?   @relation(fields: [productionOrderId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([companyId], map: "idx_non_conformities_company_id")
  @@index([status], map: "idx_non_conformities_status")
  @@map("non_conformities")
}

model ProductionCost {
  id                String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productionOrderId String                   @map("production_order_id") @db.Uuid
  companyId         String?                  @map("company_id") @db.Uuid
  status            String                   @default("DRAFT")
  materialCost      Float                    @default(0) @map("material_cost")
  materialCostStd   Float?                   @default(0) @map("material_cost_std")
  materialVariance  Float?                   @default(0) @map("material_variance")
  laborCost         Float                    @default(0) @map("labor_cost")
  laborCostStd      Float?                   @default(0) @map("labor_cost_std")
  laborVariance     Float?                   @default(0) @map("labor_variance")
  laborHours        Float?                   @default(0) @map("labor_hours")
  laborHoursStd     Float?                   @default(0) @map("labor_hours_std")
  overheadCost      Float                    @default(0) @map("overhead_cost")
  overheadCostStd   Float?                   @default(0) @map("overhead_cost_std")
  overheadVariance  Float?                   @default(0) @map("overhead_variance")
  totalCost         Float                    @default(0) @map("total_cost")
  totalCostStd      Float?                   @default(0) @map("total_cost_std")
  totalVariance     Float?                   @default(0) @map("total_variance")
  unitCost          Float?                   @default(0) @map("unit_cost")
  unitCostStd       Float?                   @default(0) @map("unit_cost_std")
  quantityProduced  Float?                   @default(0) @map("quantity_produced")
  calculatedAt      DateTime?                @map("calculated_at")
  closedAt          DateTime?                @map("closed_at")
  createdAt         DateTime                 @default(now()) @map("created_at")
  updatedAt         DateTime                 @default(now()) @map("updated_at")
  laborItems        ProductionCostLabor[]
  materialItems     ProductionCostMaterial[]
  productionOrder   ProductionOrder          @relation(fields: [productionOrderId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([companyId], map: "idx_production_costs_company_id")
  @@index([productionOrderId], map: "idx_production_costs_production_order_id")
  @@index([status], map: "idx_production_costs_status")
  @@map("production_costs")
}

model ProductionCostMaterial {
  id               String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productionCostId String         @map("production_cost_id") @db.Uuid
  materialId       String         @map("material_id") @db.Uuid
  quantityStd      Float?         @default(0) @map("quantity_std")
  quantityActual   Float?         @default(0) @map("quantity_actual")
  unitCost         Float?         @default(0) @map("unit_cost")
  totalCostStd     Float?         @default(0) @map("total_cost_std")
  totalCostActual  Float?         @default(0) @map("total_cost_actual")
  variance         Float?         @default(0)
  createdAt        DateTime       @default(now()) @map("created_at")
  productionCost   ProductionCost @relation(fields: [productionCostId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([productionCostId], map: "idx_production_cost_materials_production_cost_id")
  @@map("production_cost_materials")
}

model ProductionCostLabor {
  id               String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productionCostId String         @map("production_cost_id") @db.Uuid
  workCenterId     String?        @map("work_center_id") @db.Uuid
  operationId      String?        @map("operation_id") @db.Uuid
  hoursStd         Float?         @default(0) @map("hours_std")
  hoursActual      Float?         @default(0) @map("hours_actual")
  hourlyRate       Float?         @default(0) @map("hourly_rate")
  totalCostStd     Float?         @default(0) @map("total_cost_std")
  totalCostActual  Float?         @default(0) @map("total_cost_actual")
  variance         Float?         @default(0)
  createdAt        DateTime       @default(now()) @map("created_at")
  productionCost   ProductionCost @relation(fields: [productionCostId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([productionCostId], map: "idx_production_cost_labor_production_cost_id")
  @@map("production_cost_labor")
}

model MaterialStandardCost {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  materialId    String   @map("material_id") @db.Uuid
  companyId     String?  @map("company_id") @db.Uuid
  effectiveDate DateTime @default(now()) @map("effective_date")
  materialCost  Float    @default(0) @map("material_cost")
  laborCost     Float?   @default(0) @map("labor_cost")
  overheadCost  Float?   @default(0) @map("overhead_cost")
  totalCost     Float    @default(0) @map("total_cost")
  notes         String?
  createdBy     String?  @map("created_by") @db.Uuid
  createdAt     DateTime @default(now()) @map("created_at")

  @@index([companyId], map: "idx_material_standard_costs_company_id")
  @@index([materialId], map: "idx_material_standard_costs_material_id")
  @@map("material_standard_costs")
}

model BenefitType {
  id                      String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                    String
  name                    String
  description             String?
  companyId               String?           @map("company_id") @db.Uuid
  category                String            @default("OTHER")
  calculationType         String            @default("FIXED") @map("calculation_type")
  defaultValue            Float?            @default(0) @map("default_value")
  defaultPercentage       Float?            @default(0) @map("default_percentage")
  employeeDiscountPercent Float?            @default(0) @map("employee_discount_percent")
  isTaxable               Boolean?          @default(false) @map("is_taxable")
  affectsInss             Boolean?          @default(false) @map("affects_inss")
  affectsIrrf             Boolean?          @default(false) @map("affects_irrf")
  affectsFgts             Boolean?          @default(false) @map("affects_fgts")
  isActive                Boolean?          @default(true) @map("is_active")
  createdAt               DateTime          @default(now()) @map("created_at")
  updatedAt               DateTime          @default(now()) @map("updated_at")
  employeeBenefits        EmployeeBenefit[]

  @@index([companyId], map: "idx_benefit_types_company_id")
  @@map("benefit_types")
}

model EmployeeBenefit {
  id                  String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employeeId          String      @map("employee_id") @db.Uuid
  benefitTypeId       String      @map("benefit_type_id") @db.Uuid
  companyId           String?     @map("company_id") @db.Uuid
  status              String      @default("ACTIVE")
  startDate           DateTime    @default(now()) @map("start_date")
  endDate             DateTime?   @map("end_date")
  value               Float?      @default(0)
  employeeDiscount    Float?      @default(0) @map("employee_discount")
  companyContribution Float?      @default(0) @map("company_contribution")
  quantity            Float?      @default(1)
  notes               String?
  createdAt           DateTime    @default(now()) @map("created_at")
  updatedAt           DateTime    @default(now()) @map("updated_at")
  benefitType         BenefitType @relation(fields: [benefitTypeId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  employee            Employee    @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([benefitTypeId], map: "idx_employee_benefits_benefit_type_id")
  @@index([employeeId], map: "idx_employee_benefits_employee_id")
  @@map("employee_benefits")
}

model TransportVoucher {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employeeId     String   @map("employee_id") @db.Uuid
  companyId      String?  @map("company_id") @db.Uuid
  lineType       String   @default("BUS") @map("line_type")
  lineName       String   @map("line_name")
  fareValue      Float    @default(0) @map("fare_value")
  quantityPerDay Int?     @default(2) @map("quantity_per_day")
  workingDays    Int?     @default(22) @map("working_days")
  isActive       Boolean? @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @default(now()) @map("updated_at")
  employee       Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([employeeId], map: "idx_transport_vouchers_employee_id")
  @@map("transport_vouchers")
}

model Training {
  id                String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code              String
  name              String
  description       String?
  companyId         String?            @map("company_id") @db.Uuid
  category          String?
  durationHours     Int?               @default(0) @map("duration_hours")
  instructor        String?
  provider          String?
  cost              Float?             @default(0)
  isMandatory       Boolean?           @default(false) @map("is_mandatory")
  validityMonths    Int?               @map("validity_months")
  isActive          Boolean?           @default(true) @map("is_active")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @default(now()) @map("updated_at")
  employeeTrainings EmployeeTraining[]

  @@index([companyId], map: "idx_trainings_company_id")
  @@map("trainings")
}

model EmployeeTraining {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employeeId     String    @map("employee_id") @db.Uuid
  trainingId     String    @map("training_id") @db.Uuid
  companyId      String?   @map("company_id") @db.Uuid
  status         String    @default("SCHEDULED")
  scheduledDate  DateTime? @map("scheduled_date")
  completionDate DateTime? @map("completion_date")
  expirationDate DateTime? @map("expiration_date")
  score          Float?
  certificateUrl String?   @map("certificate_url")
  notes          String?
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @default(now()) @map("updated_at")
  employee       Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  training       Training  @relation(fields: [trainingId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([employeeId], map: "idx_employee_trainings_employee_id")
  @@index([trainingId], map: "idx_employee_trainings_training_id")
  @@map("employee_trainings")
}

model SkillMatrix {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employeeId     String    @map("employee_id") @db.Uuid
  skillName      String    @map("skill_name")
  companyId      String?   @map("company_id") @db.Uuid
  category       String?
  level          Int       @default(0)
  maxLevel       Int?      @default(4) @map("max_level")
  certifiedAt    DateTime? @map("certified_at")
  certifiedBy    String?   @map("certified_by") @db.Uuid
  expirationDate DateTime? @map("expiration_date")
  notes          String?
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @default(now()) @map("updated_at")
  employee       Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([employeeId], map: "idx_skill_matrix_employee_id")
  @@map("skill_matrix")
}

model AdmissionProcess {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code              Int                 @default(autoincrement())
  companyId         String?             @map("company_id") @db.Uuid
  candidateName     String              @map("candidate_name")
  candidateEmail    String?             @map("candidate_email")
  candidatePhone    String?             @map("candidate_phone")
  candidateCpf      String?             @map("candidate_cpf")
  positionId        String?             @map("position_id") @db.Uuid
  departmentId      String?             @map("department_id") @db.Uuid
  proposedSalary    Float?              @map("proposed_salary")
  proposedStartDate DateTime?           @map("proposed_start_date")
  status            String              @default("DRAFT")
  currentStep       Int?                @default(1) @map("current_step")
  totalSteps        Int?                @default(5) @map("total_steps")
  recruiterId       String?             @map("recruiter_id") @db.Uuid
  managerId         String?             @map("manager_id") @db.Uuid
  notes             String?
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @default(now()) @map("updated_at")
  completedAt       DateTime?           @map("completed_at")
  admission_documents AdmissionDocument[]
  admission_exams     AdmissionExam[]
  admission_steps     AdmissionStep[]

  @@index([companyId], map: "idx_admission_processes_company_id")
  @@index([status], map: "idx_admission_processes_status")
  @@map("admission_processes")
}

model AdmissionStep {
  id                String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  admissionId       String           @map("admission_id") @db.Uuid
  stepNumber        Int              @map("step_number")
  stepName          String           @map("step_name")
  stepType          String           @default("DOCUMENT") @map("step_type")
  status            String           @default("PENDING")
  assignedTo        String?          @map("assigned_to") @db.Uuid
  dueDate           DateTime?        @map("due_date")
  completedAt       DateTime?        @map("completed_at")
  completedBy       String?          @map("completed_by") @db.Uuid
  notes             String?
  createdAt         DateTime         @default(now()) @map("created_at")
  admissionProcess  AdmissionProcess @relation(fields: [admissionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([admissionId], map: "idx_admission_steps_admission_id")
  @@map("admission_steps")
}

model AdmissionDocument {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  admissionId      String           @map("admission_id") @db.Uuid
  documentType     String           @map("document_type")
  documentName     String           @map("document_name")
  fileUrl          String?          @map("file_url")
  status           String           @default("PENDING")
  isRequired       Boolean?         @default(true) @map("is_required")
  uploadedAt       DateTime?        @map("uploaded_at")
  verifiedAt       DateTime?        @map("verified_at")
  verifiedBy       String?          @map("verified_by") @db.Uuid
  rejectionReason  String?          @map("rejection_reason")
  createdAt        DateTime         @default(now()) @map("created_at")
  admissionProcess AdmissionProcess @relation(fields: [admissionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([admissionId], map: "idx_admission_documents_admission_id")
  @@map("admission_documents")
}

model AdmissionExam {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  admissionId      String           @map("admission_id") @db.Uuid
  examType         String           @default("ADMISSIONAL") @map("exam_type")
  clinicName       String?          @map("clinic_name")
  scheduledDate    DateTime?        @map("scheduled_date")
  completedDate    DateTime?        @map("completed_date")
  result           String?
  asoNumber        String?          @map("aso_number")
  asoUrl           String?          @map("aso_url")
  validUntil       DateTime?        @map("valid_until")
  notes            String?
  createdAt        DateTime         @default(now()) @map("created_at")
  admissionProcess AdmissionProcess @relation(fields: [admissionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([admissionId], map: "idx_admission_exams_admission_id")
  @@map("admission_exams")
}

model GedDocument {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code              Int               @default(autoincrement())
  companyId         String?           @db.Uuid
  title             String
  description       String?
  fileName          String
  fileType          String
  fileSize          Int
  fileUrl           String
  filePath          String
  categoryId        String?           @db.Uuid
  tags              String[]          @default([])
  entityType        GedEntityType?
  entityId          String?           @db.Uuid
  version           Int               @default(1)
  parentId          String?           @db.Uuid
  isLatestVersion   Boolean           @default(true)
  status            GedDocumentStatus @default(ACTIVE)
  isShared          Boolean           @default(false)
  requiresSignature Boolean           @default(false)
  signedAt          DateTime?
  signedBy          String?           @db.Uuid
  signatureId       String?
  createdBy         String?           @db.Uuid
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @default(now()) @updatedAt
  deletedAt         DateTime?
  metadata          Json?
  accessLogs        GedAccessLog[]
  category          GedCategory?      @relation(fields: [categoryId], references: [id])
  parent            GedDocument?      @relation("DocumentVersions", fields: [parentId], references: [id])
  versions          GedDocument[]     @relation("DocumentVersions")

  @@index([companyId])
  @@index([categoryId])
  @@index([entityType, entityId])
  @@index([status])
  @@index([parentId])
  @@index([tags], type: Gin)
  @@map("ged_documents")
}

model GedCategory {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId   String?       @db.Uuid
  name        String
  description String?
  color       String?
  icon        String?
  parentId    String?       @db.Uuid
  isActive    Boolean       @default(true)
  isShared    Boolean       @default(false)
  sortOrder   Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @default(now()) @updatedAt
  parent      GedCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    GedCategory[] @relation("CategoryHierarchy")
  documents   GedDocument[]

  @@unique([companyId, name])
  @@index([companyId])
  @@index([parentId])
  @@map("ged_categories")
}

model GedAccessLog {
  id         String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  documentId String      @db.Uuid
  userId     String?     @db.Uuid
  action     String
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime    @default(now())
  document   GedDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([userId])
  @@index([createdAt])
  @@map("ged_access_logs")
}

model Port {
  id                                                           String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                                                         String          @unique
  name                                                         String
  country                                                      String
  type                                                         PortType
  companyId                                                    String?         @db.Uuid
  isShared                                                     Boolean         @default(true)
  isActive                                                     Boolean         @default(true)
  createdAt                                                    DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt                                                    DateTime        @default(now()) @updatedAt @db.Timestamptz(6)
  import_processes_import_processes_destination_port_idToports ImportProcess[] @relation("import_processes_destination_port_idToports")
  import_processes_import_processes_origin_port_idToports      ImportProcess[] @relation("import_processes_origin_port_idToports")

  @@index([companyId], map: "idx_ports_company")
  @@index([country], map: "idx_ports_country")
  @@index([type], map: "idx_ports_type")
  @@map("ports")
}

model CustomsBroker {
  id               String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code             Int             @default(autoincrement())
  name             String
  cnpj             String          @unique
  email            String?
  phone            String?
  address          String?
  city             String?
  state            String?
  companyId        String?         @db.Uuid
  isActive         Boolean         @default(true)
  createdAt        DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @db.Timestamptz(6)
  import_processes ImportProcess[]

  @@index([companyId], map: "idx_customs_brokers_company")
  @@map("customs_brokers")
}

model CargoType {
  id               String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code             String          @unique
  name             String
  description      String?
  isShared         Boolean         @default(true)
  isActive         Boolean         @default(true)
  createdAt        DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @db.Timestamptz(6)
  import_processes ImportProcess[]

  @@map("cargo_types")
}

model Incoterm {
  id               String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code             String          @unique
  name             String
  description      String?
  isShared         Boolean         @default(true)
  isActive         Boolean         @default(true)
  createdAt        DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @db.Timestamptz(6)
  import_processes ImportProcess[]

  @@map("incoterms")
}

model ImportProcess {
  id                 String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  processNumber      String              @map("process_number") @db.VarChar(50)
  reference          String?             @db.VarChar(100)
  supplierId         String?             @map("supplier_id") @db.Uuid
  brokerId           String?             @map("broker_id") @db.Uuid
  incotermId         String?             @map("incoterm_id") @db.Uuid
  cargoTypeId        String?             @map("cargo_type_id") @db.Uuid
  originPortId       String?             @map("origin_port_id") @db.Uuid
  destinationPortId  String?             @map("destination_port_id") @db.Uuid
  status             ImportStatus        @default(DRAFT)
  orderDate          DateTime?           @map("order_date") @db.Date
  etd                DateTime?           @db.Date
  eta                DateTime?           @db.Date
  actualDeparture    DateTime?           @map("actual_departure") @db.Date
  actualArrival      DateTime?           @map("actual_arrival") @db.Date
  clearanceDate      DateTime?           @map("clearance_date") @db.Date
  deliveryDate       DateTime?           @map("delivery_date") @db.Date
  vesselName         String?             @map("vessel_name") @db.VarChar(200)
  voyageNumber       String?             @map("voyage_number") @db.VarChar(50)
  blNumber           String?             @map("bl_number") @db.VarChar(100)
  containerNumbers   String?             @map("container_numbers")
  currency           String?             @default("USD") @db.VarChar(3)
  fobValue           Decimal?            @default(0) @map("fob_value") @db.Decimal(18, 2)
  freightValue       Decimal?            @default(0) @map("freight_value") @db.Decimal(18, 2)
  insuranceValue     Decimal?            @default(0) @map("insurance_value") @db.Decimal(18, 2)
  cifValue           Decimal?            @default(0) @map("cif_value") @db.Decimal(18, 2)
  customsFees        Decimal?            @default(0) @map("customs_fees") @db.Decimal(18, 2)
  storageFees        Decimal?            @default(0) @map("storage_fees") @db.Decimal(18, 2)
  otherCosts         Decimal?            @default(0) @map("other_costs") @db.Decimal(18, 2)
  totalCostBrl       Decimal?            @default(0) @map("total_cost_brl") @db.Decimal(18, 2)
  diNumber           String?             @map("di_number") @db.VarChar(50)
  diDate             DateTime?           @map("di_date") @db.Date
  notes              String?
  companyId          String?             @map("company_id") @db.Uuid
  createdAt          DateTime            @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime            @default(now()) @map("updated_at") @db.Timestamptz(6)
  exchangeContracts   ExchangeContract[]
  importDocuments     import_documents[]
  importProcessItems  ImportProcessItem[]
  importProcessEvents ImportProcessEvent[]
  importProcessCosts  ImportProcessCost[]
  customsBroker       CustomsBroker?      @relation(fields: [brokerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  cargoType          CargoType?          @relation(fields: [cargoTypeId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  destinationPort    Port?               @relation("import_processes_destination_port_idToports", fields: [destinationPortId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  incoterm           Incoterm?           @relation(fields: [incotermId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  originPort         Port?               @relation("import_processes_origin_port_idToports", fields: [originPortId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  supplier           Supplier?           @relation(fields: [supplierId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([processNumber, companyId], map: "unique_process_number")
  @@index([brokerId], map: "idx_import_processes_broker")
  @@index([cargoTypeId], map: "idx_import_processes_cargo_type")
  @@index([companyId], map: "idx_import_processes_company")
  @@index([eta, etd], map: "idx_import_processes_dates")
  @@index([destinationPortId], map: "idx_import_processes_dest_port")
  @@index([incotermId], map: "idx_import_processes_incoterm")
  @@index([originPortId], map: "idx_import_processes_origin_port")
  @@index([status], map: "idx_import_processes_status")
  @@index([supplierId], map: "idx_import_processes_supplier")
  @@map("import_processes")
}

model ImportProcessItem {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  importProcessId String         @map("import_process_id") @db.Uuid
  materialId      String?        @map("material_id") @db.Uuid
  purchaseOrderId String?        @map("purchase_order_id") @db.Uuid
  description     String?        @db.VarChar(500)
  ncmCode         String?        @map("ncm_code") @db.VarChar(10)
  quantity        Decimal        @default(0) @db.Decimal(18, 4)
  unit            String?        @db.VarChar(10)
  unitPrice       Decimal?       @default(0) @map("unit_price") @db.Decimal(18, 6)
  totalPrice      Decimal?       @default(0) @map("total_price") @db.Decimal(18, 2)
  iiPercent       Decimal?       @default(0) @map("ii_percent") @db.Decimal(5, 2)
  iiValue         Decimal?       @default(0) @map("ii_value") @db.Decimal(18, 2)
  ipiPercent      Decimal?       @default(0) @map("ipi_percent") @db.Decimal(5, 2)
  ipiValue        Decimal?       @default(0) @map("ipi_value") @db.Decimal(18, 2)
  pisPercent      Decimal?       @default(0) @map("pis_percent") @db.Decimal(5, 2)
  pisValue        Decimal?       @default(0) @map("pis_value") @db.Decimal(18, 2)
  cofinsPercent   Decimal?       @default(0) @map("cofins_percent") @db.Decimal(5, 2)
  cofinsValue     Decimal?       @default(0) @map("cofins_value") @db.Decimal(18, 2)
  icmsPercent     Decimal?       @default(0) @map("icms_percent") @db.Decimal(5, 2)
  icmsValue       Decimal?       @default(0) @map("icms_value") @db.Decimal(18, 2)
  totalTaxes      Decimal?       @default(0) @map("total_taxes") @db.Decimal(18, 2)
  landedCost      Decimal?       @default(0) @map("landed_cost") @db.Decimal(18, 2)
  createdAt       DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime       @default(now()) @map("updated_at") @db.Timestamptz(6)
  importProcess   ImportProcess  @relation(fields: [importProcessId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  material        Material?      @relation(fields: [materialId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  purchaseOrder   PurchaseOrder? @relation(fields: [purchaseOrderId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([materialId], map: "idx_import_process_items_material")
  @@index([importProcessId], map: "idx_import_process_items_process")
  @@index([purchaseOrderId], map: "idx_import_process_items_purchase_order")
  @@map("import_process_items")
}

model ImportProcessEvent {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  importProcessId String        @map("import_process_id") @db.Uuid
  eventType       String        @map("event_type") @db.VarChar(50)
  eventDate       DateTime      @map("event_date") @db.Timestamptz(6)
  description     String?
  userId          String?       @map("user_id") @db.Uuid
  createdAt       DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  importProcess   ImportProcess @relation(fields: [importProcessId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([importProcessId], map: "idx_import_process_events_process")
  @@index([eventDate], map: "idx_import_process_events_date")
  @@map("import_process_events")
}

model ImportProcessCost {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  importProcessId String        @map("import_process_id") @db.Uuid
  costType        String        @map("cost_type") @db.VarChar(50)
  description     String
  value           Decimal       @db.Decimal(15, 2)
  currency        String        @default("BRL") @db.VarChar(3)
  isEstimated     Boolean       @default(true) @map("is_estimated")
  createdAt       DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime      @default(now()) @map("updated_at") @db.Timestamptz(6)
  importProcess   ImportProcess @relation(fields: [importProcessId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([importProcessId], map: "idx_import_process_costs_process")
  @@map("import_process_costs")
}

model ExchangeContract {
  id                   String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contractNumber       String                @map("contract_number") @db.VarChar(100)
  bankAccountId        String                @map("bank_account_id") @db.Uuid
  processId            String?               @map("process_id") @db.Uuid
  foreignValue         Decimal               @map("foreign_value") @db.Decimal(15, 2)
  foreignCurrency      String                @default("USD") @map("foreign_currency") @db.VarChar(3)
  contractRate         Decimal               @map("contract_rate") @db.Decimal(10, 6)
  brlValue             Decimal               @map("brl_value") @db.Decimal(15, 2)
  contractDate         DateTime              @map("contract_date") @db.Date
  maturityDate         DateTime              @map("maturity_date") @db.Date
  liquidationDate      DateTime?             @map("liquidation_date") @db.Date
  liquidatedValue      Decimal?              @map("liquidated_value") @db.Decimal(15, 2)
  liquidationRate      Decimal?              @map("liquidation_rate") @db.Decimal(10, 6)
  exchangeVariation    Decimal?              @map("exchange_variation") @db.Decimal(15, 2)
  status               ExchangeStatus        @default(OPEN)
  notes                String?
  companyId            String                @map("company_id") @db.Uuid
  createdAt            DateTime              @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime              @default(now()) @map("updated_at") @db.Timestamptz(6)
  bankAccount          BankAccount           @relation(fields: [bankAccountId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  importProcess        ImportProcess?        @relation(fields: [processId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  exchangeLiquidations ExchangeLiquidation[]

  @@unique([contractNumber, companyId], map: "unique_contract_number_company")
  @@index([bankAccountId], map: "idx_exchange_contracts_bank")
  @@index([companyId], map: "idx_exchange_contracts_company")
  @@index([maturityDate], map: "idx_exchange_contracts_maturity")
  @@index([processId], map: "idx_exchange_contracts_process")
  @@index([status], map: "idx_exchange_contracts_status")
  @@map("exchange_contracts")
}

model ExchangeLiquidation {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contractId       String           @map("contract_id") @db.Uuid
  foreignValue     Decimal          @map("foreign_value") @db.Decimal(15, 2)
  liquidationRate  Decimal          @map("liquidation_rate") @db.Decimal(10, 6)
  brlValue         Decimal          @map("brl_value") @db.Decimal(15, 2)
  variation        Decimal          @db.Decimal(15, 2)
  liquidationDate  DateTime         @map("liquidation_date") @db.Date
  notes            String?
  createdAt        DateTime         @default(now()) @map("created_at") @db.Timestamptz(6)
  exchangeContract ExchangeContract @relation(fields: [contractId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([contractId], map: "idx_exchange_liquidations_contract")
  @@index([liquidationDate], map: "idx_exchange_liquidations_date")
  @@map("exchange_liquidations")
}

model ProductCategory {
  id          String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String
  slug        String            @unique
  description String?
  imageUrl    String?           @map("image_url")
  parentId    String?           @map("parent_id") @db.Uuid
  order       Int?              @default(0)
  isActive    Boolean?          @default(true) @map("is_active")
  companyId   String?           @map("company_id") @db.Uuid
  isShared    Boolean?          @default(false) @map("is_shared")
  createdAt   DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  parent      ProductCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children    ProductCategory[] @relation("CategoryHierarchy")
  products    Product[]

  @@index([companyId], map: "idx_product_categories_company")
  @@index([parentId], map: "idx_product_categories_parent")
  @@index([slug], map: "idx_product_categories_slug")
  @@map("product_categories")
}

model Product {
  id               String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code             String              @unique
  materialId       String?             @map("material_id") @db.Uuid
  name             String
  shortDescription String?             @map("short_description")
  description      String?
  specifications   Json?
  slug             String              @unique
  metaTitle        String?             @map("meta_title")
  metaDescription  String?             @map("meta_description")
  listPrice        Decimal?            @map("list_price") @db.Decimal(15, 2)
  salePrice        Decimal?            @map("sale_price") @db.Decimal(15, 2)
  categoryId       String?             @map("category_id") @db.Uuid
  tags             String[]            @default([])
  status           ProductStatus?      @default(DRAFT)
  isPublished      Boolean?            @default(false) @map("is_published")
  publishedAt      DateTime?           @map("published_at") @db.Timestamptz(6)
  featuredOrder    Int?                @map("featured_order")
  companyId        String?             @map("company_id") @db.Uuid
  isShared         Boolean?            @default(false) @map("is_shared")
  createdAt        DateTime?           @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime?           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  attachments      ProductAttachment[]
  images           ProductImage[]
  videos           ProductVideo[]
  category         ProductCategory?    @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  company          Company?            @relation(fields: [companyId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  material         Material?           @relation(fields: [materialId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([categoryId], map: "idx_products_category")
  @@index([companyId], map: "idx_products_company")
  @@index([materialId], map: "idx_products_material")
  @@index([isPublished], map: "idx_products_published")
  @@index([slug], map: "idx_products_slug")
  @@index([status], map: "idx_products_status")
  @@map("products")
}

model ProductImage {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId    String    @map("product_id") @db.Uuid
  url          String
  thumbnailUrl String?   @map("thumbnail_url")
  alt          String?
  caption      String?
  order        Int?      @default(0)
  isPrimary    Boolean?  @default(false) @map("is_primary")
  width        Int?
  height       Int?
  sizeBytes    Int?      @map("size_bytes")
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  product      Product   @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([isPrimary], map: "idx_product_images_primary")
  @@index([productId], map: "idx_product_images_product")
  @@map("product_images")
}

model ProductVideo {
  id           String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId    String            @map("product_id") @db.Uuid
  url          String
  thumbnailUrl String?           @map("thumbnail_url")
  title        String
  description  String?
  type         ProductVideoType? @default(DEMO)
  duration     Int?
  order        Int?              @default(0)
  createdAt    DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  product      Product           @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([productId], map: "idx_product_videos_product")
  @@index([type], map: "idx_product_videos_type")
  @@map("product_videos")
}

model ProductAttachment {
  id        String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId String                 @map("product_id") @db.Uuid
  url       String
  fileName  String                 @map("file_name")
  fileType  String                 @map("file_type")
  sizeBytes Int?                   @map("size_bytes")
  type      ProductAttachmentType? @default(DATASHEET)
  order     Int?                   @default(0)
  createdAt DateTime?              @default(now()) @map("created_at") @db.Timestamptz(6)
  product   Product                @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([productId], map: "idx_product_attachments_product")
  @@index([type], map: "idx_product_attachments_type")
  @@map("product_attachments")
}

model AiUsageLog {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId     String   @map("company_id") @db.Uuid
  provider      String
  model         String
  taskType      String   @map("task_type")
  inputTokens   Int      @default(0) @map("input_tokens")
  outputTokens  Int      @default(0) @map("output_tokens")
  totalTokens   Int      @default(0) @map("total_tokens")
  latencyMs     Int      @default(0) @map("latency_ms")
  estimatedCost Float    @default(0) @map("estimated_cost")
  success       Boolean  @default(true)
  errorMessage  String?  @map("error_message")
  wasFallback   Boolean  @default(false) @map("was_fallback")
  fallbackFrom  String?  @map("fallback_from")
  userId        String?  @map("user_id") @db.Uuid
  requestId     String?  @map("request_id")
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  company       Company  @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([companyId, createdAt(sort: Desc)], map: "idx_ai_usage_logs_company_created")
  @@index([provider, model], map: "idx_ai_usage_logs_provider_model")
  @@index([taskType], map: "idx_ai_usage_logs_task_type")
  @@map("ai_usage_logs")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model import_documents {
  id                String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  import_process_id String        @db.Uuid
  document_type     String        @db.VarChar(50)
  document_number   String?       @db.VarChar(100)
  issue_date        DateTime?     @db.Date
  file_name         String?       @db.VarChar(255)
  file_path         String?       @db.VarChar(500)
  notes             String?
  created_at        DateTime      @default(now()) @db.Timestamptz(6)
  updated_at        DateTime      @default(now()) @db.Timestamptz(6)
  import_processes  ImportProcess @relation(fields: [import_process_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([import_process_id], map: "idx_import_documents_process")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model nfe_queue_jobs {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nfe_id          String        @db.Uuid
  company_id      String        @db.Uuid
  status          String        @default("pending")
  attempts        Int           @default(0)
  max_attempts    Int           @default(3)
  last_error      String?
  created_at      DateTime      @default(now()) @db.Timestamptz(6)
  updated_at      DateTime      @default(now()) @db.Timestamptz(6)
  completed_at    DateTime?     @db.Timestamptz(6)
  next_retry_at   DateTime?     @db.Timestamptz(6)
  message_id      BigInt?
  issued_invoices IssuedInvoice @relation(fields: [nfe_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_nfe")

  @@index([company_id], map: "idx_nfe_queue_jobs_company_id")
  @@index([nfe_id], map: "idx_nfe_queue_jobs_nfe_id")
  @@index([status], map: "idx_nfe_queue_jobs_status")
}

enum MaterialStatus {
  ACTIVE
  INACTIVE
  BLOCKED
}

enum SupplierStatus {
  ACTIVE
  INACTIVE
  BLOCKED
}

enum MovementType {
  ENTRY
  EXIT
  TRANSFER
  ADJUSTMENT
  RETURN
  PRODUCTION
}

enum InventoryType {
  RAW_MATERIAL
  SEMI_FINISHED
  FINISHED
  CRITICAL
  DEAD
  SCRAP
}

enum QuoteStatus {
  DRAFT
  PENDING
  SENT
  RECEIVED
  APPROVED
  REJECTED
  CANCELLED
}

enum PayableStatus {
  PENDING
  PARTIAL
  PAID
  OVERDUE
  CANCELLED
}

enum PayableType {
  INVOICE
  SERVICE
  TAX
  OTHER
}

enum PermissionLevel {
  NONE
  VIEW
  EDIT
  FULL
}

enum SystemModule {
  MATERIALS
  SUPPLIERS
  QUOTES
  RECEIVING
  MATERIAL_OUT
  INVENTORY
  REPORTS
  SETTINGS
}

enum PurchaseOrderStatus {
  DRAFT
  PENDING
  APPROVED
  SENT
  PARTIAL
  COMPLETED
  CANCELLED
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  VIEW
  LOGIN
  LOGOUT
  EXPORT
  IMPORT
}

enum RequisitionStatus {
  DRAFT
  PENDING
  APPROVED
  IN_SEPARATION
  PARTIAL
  COMPLETED
  CANCELLED
}

enum RequisitionType {
  PRODUCTION
  MAINTENANCE
  ADMINISTRATIVE
  PROJECT
  OTHER
}

enum ProductionOrderStatus {
  PLANNED
  RELEASED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum BankAccountType {
  CHECKING
  SAVINGS
  INVESTMENT
  CASH
}

enum ReceivableStatus {
  PENDING
  PARTIAL
  PAID
  OVERDUE
  CANCELLED
  WRITTEN_OFF
}

enum ReceivableType {
  INVOICE
  SERVICE
  CONTRACT
  OTHER
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum BankTransactionType {
  CREDIT
  DEBIT
  TRANSFER_IN
  TRANSFER_OUT
  FEE
  INTEREST
  ADJUSTMENT
}

enum MrpSuggestionType {
  PRODUCTION
  PURCHASE
  RESCHEDULE
  CANCEL
}

enum MrpSuggestionStatus {
  PENDING
  APPROVED
  REJECTED
  CONVERTED
}

enum StopType {
  PLANNED
  UNPLANNED
  SETUP
  MAINTENANCE
  QUALITY
  MATERIAL
  OTHER
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  PROPOSAL
  NEGOTIATION
  WON
  LOST
}

enum LeadSource {
  WEBSITE
  REFERRAL
  COLD_CALL
  TRADE_SHOW
  SOCIAL_MEDIA
  EMAIL
  OTHER
}

enum SalesQuoteStatus {
  DRAFT
  SENT
  VIEWED
  ACCEPTED
  REJECTED
  EXPIRED
  CONVERTED
}

enum SalesOrderStatus {
  PENDING
  CONFIRMED
  IN_PRODUCTION
  READY
  SHIPPED
  DELIVERED
  CANCELLED
}

enum TransferStatus {
  PENDING
  IN_TRANSIT
  RECEIVED
  CANCELLED
}

enum LocationType {
  WAREHOUSE
  PRODUCTION
  QUALITY
  SHIPPING
  RECEIVING
  EXTERNAL
}

enum ContractType {
  CLT
  PJ
  TEMPORARY
  INTERN
  APPRENTICE
}

enum EmployeeStatus {
  ACTIVE
  VACATION
  LEAVE
  SUSPENDED
  TERMINATED
}

enum TimeClockType {
  CLOCK_IN
  CLOCK_OUT
  BREAK_START
  BREAK_END
}

enum PayrollEventType {
  SALARY
  OVERTIME
  BONUS
  COMMISSION
  ALLOWANCE
  DEDUCTION
  TAX
  BENEFIT
}

enum WorkScheduleType {
  FIXED
  ROTATING
  FLEXIBLE
  SHIFT
}

enum HoursBankType {
  CREDIT
  DEBIT
  COMPENSATION
  EXPIRATION
  ADJUSTMENT
}

enum TimeClockAdjustmentStatus {
  PENDING
  APPROVED
  REJECTED
}

enum VacationStatus {
  SCHEDULED
  APPROVED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ThirteenthType {
  FIRST_INSTALLMENT
  SECOND_INSTALLMENT
  FULL
  PROPORTIONAL
}

enum ThirteenthStatus {
  PENDING
  CALCULATED
  PAID
  CANCELLED
}

enum TerminationType {
  RESIGNATION
  DISMISSAL_WITH_CAUSE
  DISMISSAL_NO_CAUSE
  MUTUAL_AGREEMENT
  CONTRACT_END
  RETIREMENT
  DEATH
}

enum TerminationStatus {
  DRAFT
  CALCULATED
  APPROVED
  PAID
  HOMOLOGATED
  CANCELLED
}

enum ReceivingStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  REJECTED
  PARTIAL
  CANCELLED
}

enum ReceivingItemStatus {
  PENDING
  APPROVED
  REJECTED
  PARTIAL
}

enum TaskStatus {
  PENDING
  ACCEPTED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED

  @@map("task_status")
}

enum TaskPriority {
  URGENT
  HIGH
  NORMAL
  LOW

  @@map("task_priority")
}

enum TaskEntityType {
  NFE
  REQUISITION
  PURCHASE_ORDER
  QUOTE
  PAYABLE
  RECEIVABLE
  PRODUCTION_ORDER
  OTHER

  @@map("task_entity_type")
}

enum WorkflowCategory {
  APPROVAL
  PROCESS
  NOTIFICATION
  INTEGRATION
}

enum WorkflowTriggerType {
  MANUAL
  AUTOMATIC
  SCHEDULED
  EVENT
}

enum WorkflowStepType {
  START
  APPROVAL
  TASK
  DECISION
  NOTIFICATION
  END
  USER_TASK
  SERVICE_TASK
  SCRIPT_TASK
  GATEWAY_EXCLUSIVE
  GATEWAY_PARALLEL
  GATEWAY_INCLUSIVE
  SUBPROCESS
  TIMER_EVENT
  MESSAGE_EVENT
  SIGNAL_EVENT
}

enum WorkflowAssigneeType {
  USER
  ROLE
  DEPARTMENT
  DYNAMIC
}

enum WorkflowInstanceStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REJECTED
}

enum WorkflowStepAction {
  APPROVED
  REJECTED
  COMPLETED
  DELEGATED
  SKIPPED
}

enum PaymentRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum SefazManifestacao {
  CIENCIA
  CONFIRMACAO
  DESCONHECIMENTO
  NAO_REALIZADA

  @@map("sefaz_manifestacao")
}

enum SupplierReturnStatus {
  DRAFT
  PENDING
  APPROVED
  INVOICED
  COMPLETED
  CANCELLED
}

enum ReturnReason {
  QUALITY_ISSUE
  WRONG_PRODUCT
  WRONG_QUANTITY
  DAMAGED
  EXPIRED
  NOT_ORDERED
  PRICE_DIFFERENCE
  OTHER
}

enum GedDocumentStatus {
  DRAFT
  ACTIVE
  ARCHIVED
  DELETED
}

enum GedEntityType {
  SUPPLIER
  CUSTOMER
  EMPLOYEE
  CONTRACT
  PURCHASE_ORDER
  SALES_ORDER
  INVOICE
  MATERIAL
  PROJECT
  GENERAL
}

enum PortType {
  MARITIME
  AIRPORT
  BORDER

  @@map("port_type")
}

enum ImportStatus {
  DRAFT
  PENDING_SHIPMENT
  IN_TRANSIT
  ARRIVED
  IN_CLEARANCE
  CLEARED
  DELIVERED
  CANCELLED

  @@map("import_status")
}

enum ExchangeStatus {
  OPEN
  PARTIALLY_LIQUIDATED
  LIQUIDATED
  CANCELLED

  @@map("exchange_status")
}

enum ProductStatus {
  DRAFT        @map("draft")
  ACTIVE       @map("active")
  INACTIVE     @map("inactive")
  DISCONTINUED @map("discontinued")

  @@map("product_status")
}

enum ProductVideoType {
  TRAINING     @map("training")
  DEMO         @map("demo")
  TESTIMONIAL  @map("testimonial")
  UNBOXING     @map("unboxing")
  INSTALLATION @map("installation")

  @@map("product_video_type")
}

enum ProductAttachmentType {
  DATASHEET   @map("datasheet")
  MANUAL      @map("manual")
  CERTIFICATE @map("certificate")
  BROCHURE    @map("brochure")
  WARRANTY    @map("warranty")

  @@map("product_attachment_type")
}

enum collection_action_status {
  PENDING
  SENT
  DELIVERED
  FAILED
  RESPONDED
}

enum collection_action_type {
  EMAIL
  SMS
  WHATSAPP
  PHONE
  LETTER
  NEGATIVATION
  PROTEST
}

enum contract_type {
  PURCHASE
  FINANCIAL
  PRESUMED
}

enum freight_type {
  CIF
  FOB
  PICKUP
}

enum invoice_status {
  PENDING
  VALIDATED
  APPROVED
  REJECTED
}

enum operation_nature {
  INDUSTRIALIZATION
  RESALE
  CONSUMPTION
  SERVICES
  RAW_MATERIAL
  SECONDARY
  PACKAGING
  FIXED_ASSET
}

enum payable_contract_type {
  PURCHASE
  FINANCIAL
  PRESUMED
}

enum production_delivery_type {
  ASSEMBLED
  LOOSE
}

enum production_execution_type {
  MANUFACTURE
  ALTER
}

enum production_request_type {
  SALES
  STOCK
  EXPORT
  NORMAL
  REWORK
}

enum raw_material_origin {
  INDUSTRIALIZED_STOCK
  RAW_MATERIAL
  FOUNDRY
}

enum supplier_certification_type {
  UNDEFINED
  ISO_RBS
  INITIAL_EVAL
  STRATEGIC
}

enum supplier_iqf_status {
  NEW
  APPROVED
  REJECTED
}
